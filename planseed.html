<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan Maestro Operacional: Rodando a Gas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f7f4;
            color: #1f2937;
        }
        .chart-container {
            position: relative;
            width: 100%;
            height: 400px;
        }
        .nav-link {
            transition: color 0.3s, border-color 0.3s;
        }
        .nav-link:hover, .nav-link.active {
            color: #c2410c;
            border-bottom-color: #c2410c;
        }
        .kpi-card {
            background-color: #ffffff;
            border-left: 5px solid #0d9488;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .agent-card {
            transition: all 0.3s ease;
        }
        .agent-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 10px 10px -5px rgb(0 0 0 / 0.04);
        }
        /* Tab styling for weekly timeline */
        .tab-button {
            transition: all 0.3s;
        }
        .tab-button.active {
            background-color: #0d9488;
            color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        /* Tooltip styles */
        [data-tooltip] {
            position: relative;
            cursor: pointer;
        }
        [data-tooltip]::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-8px);
            background-color: #1f2937;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s, visibility 0.2s;
            z-index: 10;
        }
        [data-tooltip]:hover::after {
            opacity: 1;
            visibility: visible;
        }
        /* Responsive styles */
        @media (max-width: 768px) {
            #hr-table { font-size: 0.75rem; }
            .chart-container { height: 300px; }
        }

        /* AGREGAR: Loading States y Premium Animations */
        .loading-skeleton {
          background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
          background-size: 200% 100%;
          animation: loading 1.5s infinite;
        }

        @keyframes loading {
          0% { background-position: 200% 0; }
          100% { background-position: -200% 0; }
        }

        .fade-in-up {
          opacity: 0;
          transform: translateY(30px);
          transition: all 0.6s ease;
        }

        .fade-in-up.visible {
          opacity: 1;
          transform: translateY(0);
        }

        .chart-loading {
          position: relative;
        }

        .chart-loading::before {
          content: 'Cargando datos...';
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: rgba(255,255,255,0.9);
          padding: 20px;
          border-radius: 8px;
          z-index: 10;
          font-size: 14px;
          color: #374151;
        }

        /* Enhanced Hover Effects */
        .agent-card {
          transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .agent-card:hover {
          transform: translateY(-8px) scale(1.02);
          box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .kpi-card {
          transition: all 0.3s ease;
        }

        .kpi-card:hover {
          transform: translateY(-4px);
          box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        /* Interactive Elements */
        .interactive-element {
          position: relative;
          overflow: hidden;
        }

        .interactive-element::before {
          content: '';
          position: absolute;
          top: 0;
          left: -100%;
          width: 100%;
          height: 100%;
          background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
          transition: left 0.5s;
        }

        .interactive-element:hover::before {
          left: 100%;
        }

        /* Section Highlighting */
        .section-highlight {
          background: linear-gradient(45deg, rgba(13, 148, 136, 0.1), rgba(16, 185, 129, 0.1));
          border-radius: 8px;
          animation: section-glow 2s ease-in-out;
        }

        @keyframes section-glow {
          0%, 100% { box-shadow: 0 0 0 rgba(13, 148, 136, 0.4); }
          50% { box-shadow: 0 0 20px rgba(13, 148, 136, 0.4); }
        }

        .cross-ref-highlight {
          background: rgba(245, 158, 11, 0.2);
          border-radius: 4px;
          animation: cross-ref-pulse 1.5s ease-in-out;
        }

        @keyframes cross-ref-pulse {
          0%, 100% { background: rgba(245, 158, 11, 0.2); }
          50% { background: rgba(245, 158, 11, 0.4); }
        }

        /* Button Enhancements */
        .btn-primary {
          background: linear-gradient(135deg, #0d9488, #06b6d4);
          color: white;
          padding: 12px 24px;
          border-radius: 8px;
          font-weight: 600;
          transition: all 0.3s ease;
          border: none;
          cursor: pointer;
        }

        .btn-primary:hover {
          background: linear-gradient(135deg, #0f766e, #0891b2);
          transform: translateY(-1px);
          box-shadow: 0 4px 12px rgba(13, 148, 136, 0.4);
        }

        .btn-secondary {
          background: transparent;
          color: #0d9488;
          border: 2px solid #0d9488;
          padding: 10px 22px;
          border-radius: 8px;
          font-weight: 600;
          transition: all 0.3s ease;
          cursor: pointer;
        }

        .btn-secondary:hover {
          background: #0d9488;
          color: white;
          transform: translateY(-1px);
        }

        /* Phase and Role Buttons */
        .phase-btn, .role-btn {
          padding: 8px 16px;
          border-radius: 6px;
          border: 2px solid transparent;
          background: #f8fafc;
          color: #64748b;
          font-weight: 500;
          transition: all 0.3s ease;
          cursor: pointer;
          display: inline-flex;
          align-items: center;
          gap: 8px;
        }

        .phase-btn:hover, .role-btn:hover {
          background: #e2e8f0;
          color: #475569;
          transform: translateY(-1px);
        }

        .phase-btn.active, .role-btn.active {
          background: #0d9488;
          color: white;
          border-color: #0d9488;
          box-shadow: 0 2px 8px rgba(13, 148, 136, 0.3);
        }

        .phase-indicator {
          width: 8px;
          height: 8px;
          border-radius: 50%;
          display: inline-block;
        }

        /* Mobile-First Responsive Enhancements */
        @media (max-width: 768px) {
          /* Hero Section Mobile */
          #hero {
            min-height: 80vh;
            padding: 40px 16px 60px;
          }
          
          #hero h1 {
            font-size: 2.5rem;
            line-height: 1.1;
            margin-bottom: 1rem;
          }
          
          #hero p {
            font-size: 1rem;
            line-height: 1.4;
            margin-bottom: 2rem;
          }
          
          #hero .grid {
            grid-template-columns: 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
          }
          
          /* Navigation Mobile */
          .nav-mobile-active {
            padding-bottom: 80px; /* Space for fixed mobile nav */
          }
          
          .mobile-nav-link {
            color: #64748b;
            transition: all 0.2s ease;
          }
          
          .mobile-nav-link.active,
          .mobile-nav-link:hover {
            background-color: #0d9488;
            color: white;
          }
          
          /* Cards and Components Mobile */
          .kpi-card,
          .agent-card,
          .milestone-card {
            margin-bottom: 1rem;
            padding: 1rem;
          }
          
          .agent-card h3 {
            font-size: 1rem;
          }
          
          /* Charts Mobile */
          .chart-container {
            height: 250px;
            margin: 1rem 0;
          }
          
          /* Tables Mobile */
          #hr-table {
            font-size: 0.75rem;
          }
          
          #hr-table th,
          #hr-table td {
            padding: 0.5rem 0.25rem;
          }
          
          /* Filters Mobile */
          .phase-btn,
          .role-btn {
            font-size: 0.75rem;
            padding: 0.5rem 0.75rem;
            margin: 0.25rem;
          }
          
          /* Modal Mobile */
          .fixed.inset-0 .bg-white {
            margin: 1rem;
            max-height: calc(100vh - 2rem);
          }
          
          /* Timeline Mobile */
          .timeline-item {
            padding: 0.75rem;
            margin: 0.5rem 0;
          }
          
          /* Progress Mobile */
          .milestone-card {
            padding: 1rem;
          }
          
          .milestone-card h4 {
            font-size: 0.9rem;
          }
          
          /* Scenario Calculator Mobile */
          #scenario-calculator .grid {
            grid-template-columns: 1fr;
            gap: 1rem;
          }
          
          /* Buttons Mobile */
          .btn-primary,
          .btn-secondary {
            padding: 12px 16px;
            font-size: 14px;
            width: 100%;
            margin-bottom: 0.5rem;
          }
          
          #hero .btn-primary,
          #hero .btn-secondary {
            width: auto;
            margin: 0.25rem;
          }
        }

        @media (max-width: 640px) {
          /* Extra small screens */
          .container {
            padding-left: 1rem;
            padding-right: 1rem;
          }
          
          #hero h1 {
            font-size: 2rem;
          }
          
          .text-3xl {
            font-size: 1.5rem;
          }
          
          .text-2xl {
            font-size: 1.25rem;
          }
          
          .text-xl {
            font-size: 1.125rem;
          }
          
          /* Grid layouts become single column */
          .grid-cols-2,
          .grid-cols-3,
          .grid-cols-4,
          .md\\:grid-cols-2,
          .md\\:grid-cols-3,
          .md\\:grid-cols-4,
          .lg\\:grid-cols-3,
          .lg\\:grid-cols-4 {
            grid-template-columns: 1fr !important;
          }
          
          /* Spacing adjustments */
          .mb-16 {
            margin-bottom: 2rem;
          }
          
          .mb-12 {
            margin-bottom: 1.5rem;
          }
          
          .mb-8 {
            margin-bottom: 1rem;
          }
          
          .p-6 {
            padding: 1rem;
          }
          
          .p-8 {
            padding: 1rem;
          }
        }

        /* Touch-friendly improvements */
        @media (hover: none) and (pointer: coarse) {
          .agent-card,
          .kpi-card,
          .milestone-card,
          .phase-btn,
          .role-btn {
            min-height: 44px; /* Minimum touch target size */
          }
          
          button,
          .btn-primary,
          .btn-secondary {
            min-height: 44px;
            min-width: 44px;
          }
          
          /* Remove hover effects on touch devices */
          .agent-card:hover,
          .kpi-card:hover {
            transform: none;
            box-shadow: inherit;
          }
        }

        /* Animation keyframes */
        @keyframes bounce {
          0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }
          40%, 43% { transform: translate3d(0,-30px,0); }
          70% { transform: translate3d(0,-15px,0); }
          90% { transform: translate3d(0,-4px,0); }
        }

        @keyframes pulse {
          0%, 100% { transform: scale(1); opacity: 1; }
          50% { transform: scale(1.05); opacity: 0.8; }
        }

        @keyframes shake {
          0%, 100% { transform: translateX(0); }
          10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
          20%, 40%, 60%, 80% { transform: translateX(10px); }
        }

        /* Scroll Progress Indicator */
        .scroll-progress {
          position: fixed;
          top: 0;
          left: 0;
          width: 0%;
          height: 3px;
          background: linear-gradient(90deg, #0d9488, #06b6d4);
          z-index: 1000;
          transition: width 0.1s ease;
        }

        .milestone-card {
          transition: all 0.3s ease;
        }

        .milestone-card:hover {
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .celebration-pulse {
          animation: celebration-pulse 1s ease-in-out infinite;
        }

        @keyframes celebration-pulse {
          0%, 100% { transform: scale(1); }
          50% { transform: scale(1.05); }
        }

        @keyframes confetti-fall {
          0% { transform: translateY(-10px) rotate(0deg); opacity: 1; }
          100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }

        /* Role highlighting CSS */
        .role-highlight-element {
          box-shadow: 0 0 0 3px rgba(194, 65, 12, 0.3) !important;
          border-radius: 8px;
          transition: box-shadow 0.3s ease;
        }

        .role-hint {
          animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
          from { transform: translateX(100%); }
          to { transform: translateX(0); }
        }

        /* AGREGAR: Cross-Reference Highlighting Styles */
        .cross-ref-link {
          transition: all 0.2s ease;
          font-size: 0.75rem;
          text-decoration: underline;
          cursor: pointer;
          margin-left: 8px;
        }

        .cross-ref-link:hover {
          background-color: rgba(13, 148, 136, 0.1);
          padding: 2px 4px;
          border-radius: 3px;
        }

        .section-highlight {
          background: linear-gradient(45deg, rgba(13, 148, 136, 0.1), rgba(16, 185, 129, 0.1));
          border-radius: 8px;
          animation: section-glow 2s ease-in-out;
        }

        @keyframes section-glow {
          0%, 100% { box-shadow: 0 0 0 rgba(13, 148, 136, 0.4); }
          50% { box-shadow: 0 0 20px rgba(13, 148, 136, 0.4); }
        }

        .cross-ref-highlight {
          background: rgba(245, 158, 11, 0.2);
          border-radius: 4px;
          animation: cross-ref-pulse 1.5s ease-in-out;
        }

        @keyframes cross-ref-pulse {
          0%, 100% { background: rgba(245, 158, 11, 0.2); }
          50% { background: rgba(245, 158, 11, 0.4); }
        }

        /* Validation Badge Styles */
        #validation-badge {
          transform: translateY(100px);
          transition: transform 0.3s ease-out;
        }

        #validation-badge:hover {
          transform: translateY(0) scale(1.05);
        }

        /* Modal Enhancement */
        #validation-modal {
          backdrop-filter: blur(4px);
        }

        #validation-modal .bg-white {
          box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        /* Test Results Styling */
        .test-results-modal {
          animation: slideInLeft 0.3s ease-out;
        }

        @keyframes slideInLeft {
          from { transform: translateX(-100%); }
          to { transform: translateX(0); }
        }

        /* Enhanced Tooltips for Cross-References */
        .cross-ref-link[title] {
          position: relative;
        }

        .cross-ref-link[title]:hover::after {
          content: attr(title);
          position: absolute;
          bottom: 100%;
          left: 50%;
          transform: translateX(-50%);
          background: rgba(0, 0, 0, 0.9);
          color: white;
          padding: 6px 12px;
          border-radius: 6px;
          font-size: 12px;
          white-space: nowrap;
          z-index: 1000;
          opacity: 1;
          animation: tooltipFadeIn 0.2s ease-out;
        }

        @keyframes tooltipFadeIn {
          from { opacity: 0; transform: translateX(-50%) translateY(4px); }
          to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }
    </style>
</head>
<body class="antialiased">
    <!-- Header & Navigation -->
    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <span class="font-bold text-xl text-slate-800">Rodando a Gas</span>
                    <span class="ml-2 text-sm font-medium text-slate-500">Blueprint Operacional</span>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#tesis" class="nav-link text-gray-700 px-3 py-2 rounded-md text-sm font-medium border-b-2 border-transparent">Tesis</a>
                        <a href="#financiero" class="nav-link text-gray-700 px-3 py-2 rounded-md text-sm font-medium border-b-2 border-transparent">Financiero</a>
                        <a href="#tecnologia" class="nav-link text-gray-700 px-3 py-2 rounded-md text-sm font-medium border-b-2 border-transparent">Tecnolog√≠a</a>
                        <a href="#ejecucion" class="nav-link text-gray-700 px-3 py-2 rounded-md text-sm font-medium border-b-2 border-transparent">Ejecuci√≥n</a>
                        <a href="#equipo" class="nav-link text-gray-700 px-3 py-2 rounded-md text-sm font-medium border-b-2 border-transparent">Equipo</a>
                        <a href="#progreso" class="nav-link text-gray-700 px-3 py-2 rounded-md text-sm font-medium border-b-2 border-transparent">Progreso</a>
                    </div>
                </div>
                <!-- AGREGAR en navbar existente despu√©s de los links actuales -->
                <div class="ml-8 relative">
                  <select id="role-selector" onchange="switchRole(this.value)" 
                          class="bg-white border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-teal-500">
                    <option value="general">Vista General</option>
                    <option value="investor">Inversionista üîç</option>
                    <option value="cto">CTO üíª</option>
                    <option value="coo">COO üìä</option>
                    <option value="cfo">CFO üí∞</option>
                  </select>
                </div>
            </div>
        </nav>
    </header>

    <!-- AGREGAR: Mobile Navigation -->
    <div class="md:hidden fixed bottom-0 left-0 right-0 bg-white shadow-lg border-t z-50" id="mobile-nav">
      <div class="grid grid-cols-5 gap-1 p-2">
        <a href="#hero" class="mobile-nav-link text-center py-2 px-1 rounded text-xs">
          <div class="text-lg mb-1">üè†</div>
          <div>Inicio</div>
        </a>
        <a href="#financiero" class="mobile-nav-link text-center py-2 px-1 rounded text-xs">
          <div class="text-lg mb-1">üí∞</div>
          <div>Financiero</div>
        </a>
        <a href="#tecnologia" class="mobile-nav-link text-center py-2 px-1 rounded text-xs">
          <div class="text-lg mb-1">ü§ñ</div>
          <div>Tech</div>
        </a>
        <a href="#ejecucion" class="mobile-nav-link text-center py-2 px-1 rounded text-xs">
          <div class="text-lg mb-1">üìä</div>
          <div>Plan</div>
        </a>
        <a href="#progreso" class="mobile-nav-link text-center py-2 px-1 rounded text-xs">
          <div class="text-lg mb-1">üéØ</div>
          <div>Progreso</div>
        </a>
      </div>
    </div>

    <!-- AGREGAR: Hero Section Completa -->
    <section id="hero" class="min-h-screen bg-gradient-to-br from-teal-900 via-teal-800 to-slate-900 relative overflow-hidden">
      <!-- Animated Background Pattern -->
      <div class="absolute inset-0 opacity-10">
        <svg class="w-full h-full" viewBox="0 0 100 100">
          <defs>
            <pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse">
              <path d="M 10 0 L 0 0 0 10" fill="none" stroke="white" stroke-width="0.5"/>
            </pattern>
          </defs>
          <rect width="100" height="100" fill="url(#grid)"/>
        </svg>
      </div>
      
      <!-- Content Container -->
      <div class="relative z-10 container mx-auto px-4 pt-20 pb-16">
        <!-- Problem Statement -->
        <div class="text-center mb-16">
          <h1 class="text-5xl md:text-7xl font-bold text-white mb-6">
            <span class="text-orange-400">15,000</span> Vagonetas Obsoletas
          </h1>
          <p class="text-xl md:text-2xl text-teal-100 max-w-4xl mx-auto mb-8">
            Miles de operadores atrapados en ciclos de deuda por prestamistas predatorios. 
            <strong class="text-orange-300">RAG los convierte en socios, no deudores.</strong>
          </p>
        </div>

        <!-- TAM/SAM/SOM Section -->
        <div class="grid md:grid-cols-3 gap-8 mb-16">
          <div class="bg-white/10 backdrop-blur-lg p-6 rounded-lg border border-white/20 text-center">
            <div class="text-3xl font-bold text-orange-400 mb-2">$10.9B MXN</div>
            <h3 class="text-lg font-semibold text-white mb-2">TAM - Mercado Total</h3>
            <p class="text-teal-100 text-sm">Renovaci√≥n vagonetas nivel nacional</p>
          </div>
          <div class="bg-white/10 backdrop-blur-lg p-6 rounded-lg border border-white/20 text-center">
            <div class="text-3xl font-bold text-teal-400 mb-2">$4.3B MXN</div>
            <h3 class="text-lg font-semibold text-white mb-2">SAM - Mercado Servible</h3>
            <p class="text-teal-100 text-sm">Zonas metro con infraestructura GNV</p>
          </div>
          <div class="bg-white/10 backdrop-blur-lg p-6 rounded-lg border border-white/20 text-center">
            <div class="text-3xl font-bold text-green-400 mb-2">$1.1B MXN</div>
            <h3 class="text-lg font-semibold text-white mb-2">SOM - Mercado Obtenible</h3>
            <p class="text-teal-100 text-sm">Cuota realista 3-5 a√±os</p>
          </div>
        </div>

        <!-- Solution Overview -->
        <div class="grid md:grid-cols-3 gap-8 mb-16">
          <div class="text-center">
            <div class="w-16 h-16 bg-orange-500 rounded-full flex items-center justify-center mx-auto mb-4">
              <span class="text-2xl">ü§ù</span>
            </div>
            <h3 class="text-xl font-bold text-white mb-2">Socios, No Acreedores</h3>
            <p class="text-teal-100">Financiamiento justo + flexibilidad real</p>
          </div>
          <div class="text-center">
            <div class="w-16 h-16 bg-teal-500 rounded-full flex items-center justify-center mx-auto mb-4">
              <span class="text-2xl">üß†</span>
            </div>
            <h3 class="text-xl font-bold text-white mb-2">IA Propietaria</h3>
            <p class="text-teal-100">4 agentes inteligentes √∫nicos</p>
          </div>
          <div class="text-center">
            <div class="w-16 h-16 bg-purple-500 rounded-full flex items-center justify-center mx-auto mb-4">
              <span class="text-2xl">üìà</span>
            </div>
            <h3 class="text-xl font-bold text-white mb-2">ROI 557%</h3>
            <p class="text-teal-100">Proyecci√≥n 5 a√±os validada</p>
          </div>
        </div>

        <!-- CTA Buttons -->
        <div class="text-center">
          <button onclick="document.getElementById('financiero').scrollIntoView({behavior: 'smooth'})" 
                  class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-4 px-8 rounded-lg mr-4 transition-colors">
            üìä Ver Financiero
          </button>
          <button onclick="document.getElementById('tecnologia').scrollIntoView({behavior: 'smooth'})" 
                  class="border-2 border-white text-white hover:bg-white hover:text-teal-900 font-bold py-4 px-8 rounded-lg transition-colors">
            üî¨ Explorar Tecnolog√≠a
          </button>
        </div>
      </div>
    </section>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
        
        <!-- 1. Tesis de Inversi√≥n y Diferenciadores -->
        <section id="tesis" class="mb-16 scroll-mt-16">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900 mb-2">Tesis de Inversi√≥n</h1>
            <p class="text-lg text-slate-600 mb-8">Un blueprint para construir un foso competitivo inexpugnable en Mobility Tech.</p>
            
            <div class="bg-white p-6 rounded-lg shadow-md mb-12">
                <h3 class="font-bold text-xl mb-4 text-teal-800">Resumen Estrat√©gico</h3>
                <p class="text-slate-700 leading-relaxed">
                    La inversi√≥n de <strong>$7,665,000 MXN</strong> financia la creaci√≥n de un ecosistema de agentes de IA y diferenciadores √∫nicos que transforman los costos variables de una financiera tradicional en una inversi√≥n de capital fija. El objetivo es construir un activo tecnol√≥gico con un payback de 20 meses y un ROI proyectado de 557% a 5 a√±os, basado en la automatizaci√≥n y la creaci√≥n de un colateral social propietario.
                </p>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                <div class="kpi-card p-4 rounded-lg shadow-sm" data-tooltip="$2.265M en 5 agentes de IA" data-ref="core-ia-budget">
                    <p class="text-sm font-medium text-slate-500">Core IA Investment</p>
                    <p class="text-2xl font-bold text-slate-800">$2.27M</p>
                    <p class="text-xs text-green-600">29.5% del total</p>
                </div>
                <div class="kpi-card p-4 rounded-lg shadow-sm" data-tooltip="HASE: 1,584h | PIA: 576h | Super-PMA: 768h | Asistente: 480h | RAG-DNA: 432h">
                    <p class="text-sm font-medium text-slate-500">Horas Desarrollo</p>
                    <p class="text-2xl font-bold text-slate-800">7,760h</p>
                    <p class="text-xs text-amber-600">52.4% ESOP Core</p>
                </div>
                <div class="kpi-card p-4 rounded-lg shadow-sm" data-tooltip="STP + Oxxo + PLD: 70% no-bancarizado accesible">
                    <p class="text-sm font-medium text-slate-500">Stack Pagos Inclusivo</p>
                    <p class="text-2xl font-bold text-slate-800">$75K</p>
                    <p class="text-xs text-teal-600">TAM $10.9B vs $3B</p>
                </div>
                <div class="kpi-card p-4 rounded-lg shadow-sm" data-tooltip="3 vagonetas √ó $876,667 cada una" data-ref="capex-breakdown">
                    <p class="text-sm font-medium text-slate-500">CAPEX Piloto</p>
                    <p class="text-2xl font-bold text-slate-800">$2.63M</p>
                    <p class="text-xs text-orange-600">3 unidades validaci√≥n</p>
                    <button onclick="document.getElementById('capex-modal').style.display='flex'" class="text-xs text-blue-600 underline mt-1">Ver desglose ‚Üí</button>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-md mb-12">
                <h3 class="font-bold text-xl mb-4 text-teal-800">Diferenciadores Estrat√©gicos Clave</h3>
                <div id="diferenciadores-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Los diferenciadores se insertar√°n aqu√≠ por JS -->
                </div>
            </div>
            
            <!-- AGREGAR: Competitive Moat Section -->
            <div class="bg-white p-6 rounded-lg shadow-md mb-12">
              <h3 class="font-bold text-xl mb-4 text-teal-800">Ventaja Competitiva Inexpugnable: 4 Fosos Interconectados</h3>
              
              <!-- Interactive Moat Visualization -->
              <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="moat-card bg-blue-50 p-6 rounded-lg border-l-4 border-blue-500 cursor-pointer hover:shadow-lg transition-shadow" 
                     data-moat="datos" onclick="showMoatDetails('datos')">
                  <div class="flex items-center mb-4">
                    <span class="text-3xl mr-3">üóÉÔ∏è</span>
                    <h4 class="font-bold text-blue-800">Foso de Datos</h4>
                  </div>
                  <p class="text-sm text-blue-700 mb-3">Carta Aval de Ruta: colateral social √∫nico de 20+ a√±os</p>
                  <div class="text-xs text-blue-600 font-semibold">‚Üí Imposible replicar por competidores</div>
                </div>
                
                <div class="moat-card bg-green-50 p-6 rounded-lg border-l-4 border-green-500 cursor-pointer hover:shadow-lg transition-shadow" 
                     data-moat="tech" onclick="showMoatDetails('tech')">
                  <div class="flex items-center mb-4">
                    <span class="text-3xl mr-3">üß†</span>
                    <h4 class="font-bold text-green-800">Foso Tecnol√≥gico</h4>
                  </div>
                  <p class="text-sm text-green-700 mb-3">4 agentes IA sin√©rgicos: HASE, PIA, Super-PMA, Asistente</p>
                  <div class="text-xs text-green-600 font-semibold">‚Üí Arquitectura multi-agente √∫nica</div>
                </div>
                
                <div class="moat-card bg-purple-50 p-6 rounded-lg border-l-4 border-purple-500 cursor-pointer hover:shadow-lg transition-shadow" 
                     data-moat="ops" onclick="showMoatDetails('ops')">
                  <div class="flex items-center mb-4">
                    <span class="text-3xl mr-3">‚ö°</span>
                    <h4 class="font-bold text-purple-800">Foso Operacional</h4>
                  </div>
                  <p class="text-sm text-purple-700 mb-3">40% reducci√≥n costos soporte, 30% menos reparaciones</p>
                  <div class="text-xs text-purple-600 font-semibold">‚Üí Escalabilidad sin recursos proporcionales</div>
                </div>
                
                <div class="moat-card bg-orange-50 p-6 rounded-lg border-l-4 border-orange-500 cursor-pointer hover:shadow-lg transition-shadow" 
                     data-moat="network" onclick="showMoatDetails('network')">
                  <div class="flex items-center mb-4">
                    <span class="text-3xl mr-3">üï∏Ô∏è</span>
                    <h4 class="font-bold text-orange-800">Foso de Red</h4>
                  </div>
                  <p class="text-sm text-orange-700 mb-3">Flywheel: m√°s datos ‚Üí IA m√°s smart ‚Üí mejor servicio</p>
                  <div class="text-xs text-orange-600 font-semibold">‚Üí Efecto red auto-reforzado</div>
                </div>
              </div>

              <!-- Detailed Moat Explanation (Hidden by default) -->
              <div id="moat-details" class="hidden bg-gray-50 p-8 rounded-lg">
                <div id="moat-content"></div>
              </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-md mt-12">
                <h3 class="font-bold text-xl mb-4 text-teal-800">An√°lisis ROI: IA-Nativo vs Tradicional</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 text-center">
                    <div class="bg-slate-50 p-3 rounded-lg"><p class="text-sm text-slate-500">ROI Proyectado (5 a√±os)</p><p id="roi-percentage" class="text-2xl font-bold text-green-600" data-ref="roi-calculation">557%</p></div>
                    <div class="bg-slate-50 p-3 rounded-lg"><p class="text-sm text-slate-500">Payback Period</p><p id="payback-period" class="text-2xl font-bold text-teal-600">20 meses</p></div>
                    <div class="bg-slate-50 p-3 rounded-lg"><p class="text-sm text-slate-500">Ahorro Total (5 a√±os)</p><p id="savings-total" class="text-2xl font-bold text-orange-600">$12.96M</p></div>
                </div>
                <div class="mb-6">
                    <label for="roi-years" class="block text-sm font-medium text-slate-700 mb-2">Proyecci√≥n a: <span id="years-label" class="font-bold text-orange-600">5</span> a√±os</label>
                    <input id="roi-years" type="range" min="1" max="5" value="5" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                </div>
                <div class="chart-container" style="height: 300px;">
                    <canvas id="roiComparisonChart"></canvas>
                </div>
            </div>
            
            <div class="mt-8 bg-white p-6 rounded-lg shadow-md">
                <h4 class="font-bold text-xl mb-4 text-teal-800">Breakdown ROI: ¬øD√≥nde Est√° El Ahorro?</h4>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500">Componente</th>
                                <th class="px-4 py-3 text-center text-xs font-medium text-gray-500">Modelo Tradicional</th>
                                <th class="px-4 py-3 text-center text-xs font-medium text-gray-500">Modelo IA-Nativo</th>
                                <th class="px-4 py-3 text-center text-xs font-medium text-gray-500">Ahorro Anual</th>
                            </tr>
                        </thead>
                        <tbody id="roi-breakdown-body" class="divide-y divide-gray-200">
                            <!-- Generado por JS con datos espec√≠ficos -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- 2. Plan Financiero -->
        <section id="financiero" class="mb-16 scroll-mt-16">
            <h2 class="text-3xl md:text-4xl font-bold text-slate-900 mb-2">Plan Financiero (CFO View)</h2>
            <p class="text-lg text-slate-600 mb-8">Un despliegue de capital no lineal para maximizar la eficiencia y mitigar riesgos.</p>
            
            <div class="bg-white p-6 rounded-lg shadow-md mb-12">
                <h3 class="font-bold text-xl mb-4 text-teal-800">Inversi√≥n Semilla Solicitada: $7,665,000 MXN</h3>
                <div class="chart-container" style="height: 400px; width: 100%;" data-ref="core-ia-budget">
                    <canvas id="investmentDonutChart"></canvas>
                </div>
                <div class="mt-8 bg-gradient-to-r from-teal-50 to-cyan-50 p-6 rounded-lg border border-teal-200">
                    <h4 class="font-bold text-teal-800 mb-4">üíº Desglose SaaS + Stack Tecnol√≥gico ($631,000)</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <h5 class="font-semibold text-slate-800 mb-3">SaaS Backbone ($436k)</h5>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between p-2 bg-white rounded">
                                    <span>Odoo Enterprise (ERP completo)</span>
                                    <span class="font-semibold text-teal-600">$216k</span>
                                </div>
                                <div class="flex justify-between p-2 bg-white rounded">
                                    <span>Financial AI (Xero, DocuSign)</span>
                                    <span class="font-semibold text-teal-600">$100k</span>
                                </div>
                                <div class="flex justify-between p-2 bg-white rounded">
                                    <span>Seguridad SOC2 (Auth0)</span>
                                    <span class="font-semibold text-teal-600">$60k</span>
                                </div>
                                <div class="flex justify-between p-2 bg-white rounded">
                                    <span>Comunicaci√≥n (Slack, Google)</span>
                                    <span class="font-semibold text-teal-600">$40k</span>
                                </div>
                                <div class="flex justify-between p-2 bg-white rounded">
                                    <span>Apps M√≥viles (Android)</span>
                                    <span class="font-semibold text-teal-600">$20k</span>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h5 class="font-semibold text-slate-800 mb-3">Stack Pagos Inclusivos ($75k)</h5>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between p-2 bg-green-50 rounded border border-green-200">
                                    <span>STP Integration (SPEI directo)</span>
                                    <span class="font-semibold text-green-600">$35k + $8k/mes</span>
                                </div>
                                <div class="flex justify-between p-2 bg-green-50 rounded border border-green-200">
                                    <span>Oxxo Pay API (20,000+ tiendas)</span>
                                    <span class="font-semibold text-green-600">$20k + $5k/mes</span>
                                </div>
                                <div class="flex justify-between p-2 bg-green-50 rounded border border-green-200">
                                    <span>PLD Compliance (anti-lavado)</span>
                                    <span class="font-semibold text-green-600">$12k</span>
                                </div>
                                <div class="flex justify-between p-2 bg-green-50 rounded border border-green-200">
                                    <span>Terminal POS backup</span>
                                    <span class="font-semibold text-green-600">$8k</span>
                                </div>
                            </div>
                            <div class="mt-3 p-2 bg-green-100 rounded border border-green-300">
                                <p class="text-xs font-bold text-green-800">üéØ Impacto Cr√≠tico</p>
                                <p class="text-xs text-green-700">70% poblaci√≥n no-bancarizada ‚Üí 100% accesible</p>
                                <p class="text-xs text-green-700">TAM mantiene $10.9B vs $3B solo tradicional</p>
                            </div>
                        </div>
                        <div>
                            <h5 class="font-semibold text-slate-800 mb-3">Automation Tools ($120k)</h5>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between p-2 bg-purple-50 rounded border border-purple-200">
                                    <span>Make/n8n Enterprise</span>
                                    <span class="font-semibold text-purple-600">$30k/a√±o</span>
                                </div>
                                <div class="flex justify-between p-2 bg-purple-50 rounded border border-purple-200">
                                    <span>WhatsApp Business API</span>
                                    <span class="font-semibold text-purple-600">$45k/a√±o</span>
                                </div>
                                <div class="flex justify-between p-2 bg-purple-50 rounded border border-purple-200">
                                    <span>APIs Premium (GPT-4, Claude)</span>
                                    <span class="font-semibold text-purple-600">$30k/a√±o</span>
                                </div>
                                <div class="flex justify-between p-2 bg-purple-50 rounded border border-purple-200">
                                    <span>Monitoring & DevOps</span>
                                    <span class="font-semibold text-purple-600">$15k</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 border-t pt-4">
                        <h5 class="font-semibold text-slate-800 mb-3">üìÖ Cronograma Implementaci√≥n SaaS</h5>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-3 text-xs">
                            <div class="p-3 bg-white rounded border-l-4 border-teal-500">
                                <div class="font-semibold text-teal-800">Mes 1-2: Core Setup</div>
                                <div class="text-slate-600">Odoo Enterprise + Auth0 + AWS base</div>
                                <div class="text-teal-600 font-medium">Owner: DevOps + Full-Stack</div>
                            </div>
                            <div class="p-3 bg-white rounded border-l-4 border-green-500">
                                <div class="font-semibold text-green-800">Mes 2-3: Pagos Inclusivos</div>
                                <div class="text-slate-600">STP + Oxxo Pay + PLD compliance</div>
                                <div class="text-green-600 font-medium">Owner: Backend + Legal</div>
                            </div>
                            <div class="p-3 bg-white rounded border-l-4 border-purple-500">
                                <div class="font-semibold text-purple-800">Mes 3-4: Automation</div>
                                <div class="text-slate-600">Make/n8n + WhatsApp Business API</div>
                                <div class="text-purple-600 font-medium">Owner: ML Engineer + Backend</div>
                            </div>
                            <div class="p-3 bg-white rounded border-l-4 border-orange-500">
                                <div class="font-semibold text-orange-800">Mes 4+: Stack Completo</div>
                                <div class="text-slate-600">100% operativo + SOC2-ready</div>
                                <div class="text-orange-600 font-medium">Milestone: Stack empresarial operativo</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-md mt-12">
                 <h3 class="font-bold text-xl mb-2 text-teal-800">Flujo de Caja y Gasto Mensual</h3>
                 <p class="text-slate-600 mb-4">Interact√∫e con el deslizador para explorar el plan financiero mes a mes. El gr√°fico visualiza el gasto por categor√≠a y el efectivo restante.</p>
                <div class="mb-8">
                    <label for="month-slider" class="block text-sm font-medium text-slate-700 mb-2">Mes: <span id="month-label" class="font-bold text-orange-600">1</span></label>
                    <input id="month-slider" type="range" min="1" max="12" value="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                </div>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8 text-center">
                    <div class="bg-slate-50 p-3 rounded-lg">
                        <p class="text-sm text-slate-500">Gasto del Mes</p>
                        <p id="kpi-gasto-mes" class="text-2xl font-bold"></p>
                    </div>
                    <div class="bg-slate-50 p-3 rounded-lg">
                        <p class="text-sm text-slate-500">Gasto Acumulado</p>
                        <p id="kpi-gasto-acumulado" class="text-2xl font-bold"></p>
                    </div>
                    <div class="bg-slate-50 p-3 rounded-lg">
                        <p class="text-sm text-slate-500">Efectivo Restante</p>
                        <p id="kpi-efectivo" class="text-2xl font-bold"></p>
                    </div>
                    <div class="bg-slate-50 p-3 rounded-lg">
                        <p class="text-sm text-slate-500">Reserva Emergencia</p>
                        <p id="kpi-reserva" class="text-2xl font-bold text-teal-600"></p>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="financialPlanChart"></canvas>
                </div>
                <div id="financial-breakdown-container" class="mt-6">
                    <!-- Breakdown se insertar√° aqu√≠ -->
                </div>
            </div>

            <!-- AGREGAR: Calculadora Interactiva de Escenarios -->
            <div class="bg-white p-6 rounded-lg shadow-md mt-8">
              <h3 class="text-xl font-bold mb-4 text-teal-800">üöÄ Calculadora Serie A "At a Glance"</h3>
              <p class="text-slate-600 mb-6">Proyecci√≥n de TIR, EBITDA y valuaci√≥n para diferentes escenarios de escalamiento post-SEED.</p>
              
              <div class="grid md:grid-cols-4 gap-4 mb-6">
                <div>
                  <label class="block text-sm font-medium mb-2 text-slate-700">Escenario</label>
                  <select id="scenario-select" onchange="updateScenarioCalculation()" 
                          class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-teal-500">
                    <option value="conservative">Conservador</option>
                    <option value="base" selected>Base (Plan)</option>
                    <option value="optimistic">Optimista</option>
                  </select>
                </div>
                
                <div>
                  <label class="block text-sm font-medium mb-2 text-slate-700">A√±os Proyecci√≥n</label>
                  <input type="range" id="years-slider" min="1" max="10" value="5" 
                         onchange="updateScenarioCalculation()"
                         class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                  <div class="text-center text-sm text-gray-600" id="years-display">5 a√±os</div>
                </div>
                
                <div>
                  <label class="block text-sm font-medium mb-2 text-slate-700">Serie A Target</label>
                  <input type="number" id="investment-input" value="45000000" 
                         onchange="updateScenarioCalculation()"
                         class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-teal-500">
                </div>
                
                <div>
                  <label class="block text-sm font-medium mb-2 text-slate-700">Flota (veh√≠culos)</label>
                  <input type="number" id="fleet-size" value="50" min="10" max="200"
                         onchange="updateScenarioCalculation()"
                         class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-teal-500">
                </div>
              </div>

              <div class="grid md:grid-cols-4 gap-4 mb-6">
                <div class="bg-green-50 p-4 rounded-lg text-center">
                  <h4 class="font-semibold text-green-800">TIR Equity</h4>
                  <div id="scenario-roi-result" class="text-2xl font-bold text-green-600">557%</div>
                </div>
                
                <div class="bg-blue-50 p-4 rounded-lg text-center">
                  <h4 class="font-semibold text-blue-800">Cash Positive</h4>
                  <div id="scenario-payback-result" class="text-2xl font-bold text-blue-600">20 meses</div>
                </div>
                
                <div class="bg-purple-50 p-4 rounded-lg text-center">
                  <h4 class="font-semibold text-purple-800">Valuaci√≥n Exit</h4>
                  <div id="scenario-value-result" class="text-2xl font-bold text-purple-600">$42.7M</div>
                </div>
                
                <div class="bg-orange-50 p-4 rounded-lg text-center">
                  <h4 class="font-semibold text-orange-800">Revenue Anual</h4>
                  <div id="scenario-revenue-result" class="text-2xl font-bold text-orange-600">$8.5M</div>
                </div>
              </div>

              <div class="chart-container" style="height: 300px;">
                <canvas id="scenario-chart"></canvas>
              </div>
              
              <div class="mt-4 p-4 bg-slate-50 rounded-lg">
                <h4 class="font-semibold text-slate-800 mb-2">Supuestos del Escenario:</h4>
                <div id="scenario-assumptions" class="text-sm text-slate-600"></div>
              </div>
            </div>
        </section>

        <!-- 3. Plan de Desarrollo Tecnol√≥gico -->
        <section id="tecnologia" class="mb-16 scroll-mt-16">
            <h2 class="text-3xl md:text-4xl font-bold text-slate-900 mb-2">Blueprint Tecnol√≥gico (CTO View)</h2>
            <p class="text-lg text-slate-600 mb-8">Ecosistema de agentes de IA, arquitectura de datos y especificaciones t√©cnicas.</p>
            
            <div id="agentes-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
                <!-- Los agentes se insertar√°n aqu√≠ por JS -->
            </div>

            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="font-bold text-xl mb-4 text-teal-800">Arquitectura y Pipeline de Datos</h3>
                <div id="arquitectura-datos-container">
                    <!-- La arquitectura de datos se insertar√° aqu√≠ por JS -->
                </div>
            </div>
        </section>

        <!-- 4. Plan de Ejecuci√≥n y Compliance -->
        <section id="ejecucion" class="mb-16 scroll-mt-16">
            <h2 class="text-3xl md:text-4xl font-bold text-slate-900 mb-2">Plan de Ejecuci√≥n (COO View)</h2>
            <p class="text-lg text-slate-600 mb-8">Cronograma semanal, hitos de negocio y timeline regulatorio.</p>

            <!-- AGREGAR: Phase Filter Section -->
            <div class="mb-8 text-center">
              <h3 class="text-lg font-semibold mb-4">Filtrar por Fase del Plan</h3>
              <div class="flex justify-center space-x-4 flex-wrap">
                <button class="phase-btn active" data-phase="all" onclick="filterByPhase('all')">
                  Todas las Fases
                </button>
                <button class="phase-btn" data-phase="foundation" onclick="filterByPhase('foundation')">
                  <span class="phase-indicator bg-blue-500"></span>
                  Fundaci√≥n (M1-3)
                </button>
                <button class="phase-btn" data-phase="development" onclick="filterByPhase('development')">
                  <span class="phase-indicator bg-green-500"></span>
                  Desarrollo (M4-6)
                </button>
                <button class="phase-btn" data-phase="validation" onclick="filterByPhase('validation')">
                  <span class="phase-indicator bg-purple-500"></span>
                  Validaci√≥n (M7-9)
                </button>
                <button class="phase-btn" data-phase="traction" onclick="filterByPhase('traction')">
                  <span class="phase-indicator bg-orange-500"></span>
                  Tracci√≥n (M10-12)
                </button>
              </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-md mb-12">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="font-bold text-xl text-teal-800">Roadmap de Desarrollo</h3>
                    <div class="flex bg-gray-100 rounded-lg p-1">
                        <button id="vista-ejecutiva-btn" class="px-4 py-2 text-sm font-medium rounded-md bg-teal-600 text-white transition-all">
                            üéØ Vista Ejecutiva
                        </button>
                        <button id="vista-operacional-btn" class="px-4 py-2 text-sm font-medium rounded-md text-gray-600 hover:text-gray-900 transition-all">
                            üîß Vista Operacional
                        </button>
                    </div>
                </div>
                
                <!-- VISTA EJECUTIVA (Nueva) -->
                <div id="executive-view-content" class="block">
                    <!-- KPI Cards por Agente -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                        <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-lg border-l-4 border-blue-500">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="font-bold text-blue-800">HASE</h4>
                                <span class="text-blue-600">üß†</span>
                            </div>
                            <p class="text-2xl font-bold text-blue-600">$710K</p>
                            <p class="text-sm text-blue-700">Mes 1-6 ‚Ä¢ Target: >90% AUC</p>
                            <div class="mt-2 text-xs text-blue-600">Social Scoring √∫nico</div>
                        </div>
                        <div class="bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-lg border-l-4 border-green-500">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="font-bold text-green-800">PIA</h4>
                                <span class="text-green-600">üì±</span>
                            </div>
                            <p class="text-2xl font-bold text-green-600">$475K</p>
                            <p class="text-sm text-green-700">Mes 2-5 ‚Ä¢ Target: <2min SLA</p>
                            <div class="mt-2 text-xs text-green-600">WhatsApp + LLMs emp√°ticos</div>
                        </div>
                        <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-lg border-l-4 border-purple-500">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="font-bold text-purple-800">Super-PMA</h4>
                                <span class="text-purple-600">üîß</span>
                            </div>
                            <p class="text-2xl font-bold text-purple-600">$600K</p>
                            <p class="text-sm text-purple-700">Mes 3-8 ‚Ä¢ Target: >85% precisi√≥n</p>
                            <div class="mt-2 text-xs text-purple-600">Marketplace + Kafka streaming</div>
                        </div>
                        <div class="bg-gradient-to-br from-orange-50 to-orange-100 p-4 rounded-lg border-l-4 border-orange-500">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="font-bold text-orange-800">Asistente</h4>
                                <span class="text-orange-600">ü§ñ</span>
                            </div>
                            <p class="text-2xl font-bold text-orange-600">$330K</p>
                            <p class="text-sm text-orange-700">Mes 4-8 ‚Ä¢ Target: 70% automation</p>
                            <div class="mt-2 text-xs text-orange-600">GPT-4 Vision + Make/n8n</div>
                        </div>
                    </div>
                    
                    <!-- Gantt Visual Simple -->
                    <div class="bg-slate-50 p-6 rounded-lg mb-6">
                        <h4 class="font-semibold text-slate-800 mb-4">Timeline & Dependencies</h4>
                        <div class="space-y-3">
                            <div class="flex items-center">
                                <div class="w-20 text-xs font-medium text-blue-800">HASE</div>
                                <div class="flex-1 bg-gray-200 rounded-full h-3 mx-2">
                                    <div class="bg-blue-500 h-3 rounded-full" style="width: 50%; margin-left: 0%;"></div>
                                </div>
                                <div class="text-xs text-slate-600">Mes 1-6</div>
                            </div>
                            <div class="flex items-center">
                                <div class="w-20 text-xs font-medium text-green-800">PIA</div>
                                <div class="flex-1 bg-gray-200 rounded-full h-3 mx-2">
                                    <div class="bg-green-500 h-3 rounded-full" style="width: 33%; margin-left: 16.67%;"></div>
                                </div>
                                <div class="text-xs text-slate-600">Mes 2-5</div>
                            </div>
                            <div class="flex items-center">
                                <div class="w-20 text-xs font-medium text-purple-800">Super-PMA</div>
                                <div class="flex-1 bg-gray-200 rounded-full h-3 mx-2">
                                    <div class="bg-purple-500 h-3 rounded-full" style="width: 50%; margin-left: 25%;"></div>
                                </div>
                                <div class="text-xs text-slate-600">Mes 3-8</div>
                            </div>
                            <div class="flex items-center">
                                <div class="w-20 text-xs font-medium text-orange-800">Asistente</div>
                                <div class="flex-1 bg-gray-200 rounded-full h-3 mx-2">
                                    <div class="bg-orange-500 h-3 rounded-full" style="width: 41.67%; margin-left: 33.33%;"></div>
                                </div>
                                <div class="text-xs text-slate-600">Mes 4-8</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Critical Path -->
                    <div class="bg-gradient-to-r from-amber-50 to-red-50 p-4 rounded-lg border border-amber-200">
                        <h4 class="font-bold text-amber-800 mb-2">üö® Critical Path hacia Serie A</h4>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-3 text-sm">
                            <div class="text-center">
                                <div class="font-semibold text-red-700">Mes 4</div>
                                <div class="text-red-600">REPUVE Legal</div>
                            </div>
                            <div class="text-center">
                                <div class="font-semibold text-orange-700">Mes 6</div>
                                <div class="text-orange-600">1ra Vagoneta</div>
                            </div>
                            <div class="text-center">
                                <div class="font-semibold text-blue-700">Mes 9</div>
                                <div class="text-blue-600">Validaci√≥n Piloto</div>
                            </div>
                            <div class="text-center">
                                <div class="font-semibold text-green-700">Mes 12</div>
                                <div class="text-green-600">Serie A $45M</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- VISTA OPERACIONAL (Mover cronograma actual aqu√≠) -->
                <div id="operational-view-content" class="hidden">
                    <div id="weekly-timeline-container">
                        <!-- El cronograma semanal actual se renderizar√° aqu√≠ -->
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-md mb-12">
                <h3 class="font-bold text-xl mb-4 text-teal-800">Hitos y KPIs Clave (Business-T√©cnico)</h3>
                <div id="kpis-correlacionados-container" class="space-y-6">
                    <!-- Los KPIs se insertar√°n aqu√≠ por JS -->
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="font-bold text-xl mb-4 text-teal-800">Timeline Regulatorio y de Compliance</h3>
                <div id="compliance-container" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- El timeline de compliance se insertar√° aqu√≠ por JS -->
                </div>
            </div>
        </section>

        <!-- 5. Plan de Equipo -->
        <section id="equipo" class="mb-16 scroll-mt-16">
            <h2 class="text-3xl md:text-4xl font-bold text-slate-900 mb-2">Plan de Equipo (HR View)</h2>
            <p class="text-lg text-slate-600 mb-8">La ventaja competitiva m√°s defendible y el principal mitigador del riesgo de ejecuci√≥n.</p>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="font-bold text-xl mb-4 text-teal-800">La Piedra Angular: El N√∫cleo ESOP</h3>
                    <div class="space-y-4 text-slate-700">
                        <p>La certeza de ejecuci√≥n recae sobre un equipo pre-ensamblado de miembros t√©cnicos senior con qu√≠mica y velocidad probadas.</p>
                        <blockquote class="border-l-4 border-orange-500 pl-4 italic">
                            Su compensaci√≥n es un modelo h√≠brido estrat√©gico: salarios base competitivos m√°s un <strong>10% de equity</strong> colectivo, creando <strong>"golden handcuffs"</strong> que eliminan el riesgo de fuga de talento.
                        </blockquote>
                        <p>Para los inversionistas, esto no es un plan de RRHH, es la garant√≠a de que el equipo que construye el valor permanecer√° para entregarlo. Es una asignaci√≥n de capital sofisticada que dirige el equity a los creadores de IP a largo plazo.</p>
                    </div>
                </div>
                 <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="font-bold text-xl mb-4 text-teal-800">Asignaci√≥n Detallada por Persona/Mes</h3>
                    <p class="text-slate-600 mb-4">Matriz completa mostrando la asignaci√≥n de cada rol a los hitos del plan maestro.</p>
                    
                    <div class="mb-4">
                        <label for="role-filter" class="block text-sm font-medium text-gray-700">Filtrar por Rol:</label>
                        <select id="role-filter" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md">
                            <option value="all">Todos los Roles</option>
                        </select>
                    </div>
                    <div class="overflow-x-auto">
                        <table id="hr-table" class="min-w-full divide-y divide-gray-200" data-ref="team-cost">
                            <thead class="bg-gray-50">
                                <!-- Cabecera generada por JS -->
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <!-- Filas generadas por JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- 6. Tracker de Progreso -->
        <section id="progreso" class="mb-16 scroll-mt-16">
            <h2 class="text-3xl md:text-4xl font-bold text-slate-900 mb-2">Tracker de Progreso (Dashboard View)</h2>
            
            <!-- MEJORAR secci√≥n progreso existente agregando: -->
            <div class="bg-gradient-to-r from-teal-50 to-blue-50 p-6 rounded-lg mb-8">
              <h3 class="text-xl font-bold mb-4">üéØ Progreso hacia Serie A</h3>
              
              <!-- Overall Progress Bar -->
              <div class="mb-6">
                <div class="flex justify-between items-center mb-2">
                  <span class="text-sm font-medium">Progreso General</span>
                  <span class="text-sm font-bold" id="overall-percentage">25%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-4">
                  <div id="overall-progress-bar" 
                       class="bg-gradient-to-r from-teal-500 to-blue-500 h-4 rounded-full transition-all duration-1000" 
                       style="width: 25%"></div>
                </div>
              </div>

              <!-- Milestone Cards -->
              <div class="grid md:grid-cols-4 gap-4 mb-6" id="milestone-cards">
                <div class="milestone-card bg-white p-4 rounded-lg border-l-4 border-blue-500" data-milestone="month3">
                  <div class="flex justify-between items-center mb-2">
                    <h4 class="font-bold text-blue-800">Fundaci√≥n Completa</h4>
                    <span class="milestone-status text-2xl">üéØ</span>
                  </div>
                  <div class="text-sm text-blue-700 mb-2">Mes 3 ‚Ä¢ Peso: 20%</div>
                  <div class="w-full bg-blue-100 rounded-full h-2">
                    <div class="milestone-progress bg-blue-500 h-2 rounded-full transition-all duration-500" style="width: 100%"></div>
                  </div>
                  <div class="text-xs text-blue-600 mt-2">HASE >80% AUC, Equipo completo</div>
                </div>
                
                <div class="milestone-card bg-white p-4 rounded-lg border-l-4 border-green-500" data-milestone="month6">
                  <div class="flex justify-between items-center mb-2">
                    <h4 class="font-bold text-green-800">MVP Tecnol√≥gico</h4>
                    <span class="milestone-status text-2xl">üöß</span>
                  </div>
                  <div class="text-sm text-green-700 mb-2">Mes 6 ‚Ä¢ Peso: 30%</div>
                  <div class="w-full bg-green-100 rounded-full h-2">
                    <div class="milestone-progress bg-green-500 h-2 rounded-full transition-all duration-500" style="width: 60%"></div>
                  </div>
                  <div class="text-xs text-green-600 mt-2">HASE >90% AUC, 1ra Vagoneta operando</div>
                </div>
                
                <div class="milestone-card bg-white p-4 rounded-lg border-l-4 border-purple-500" data-milestone="month9">
                  <div class="flex justify-between items-center mb-2">
                    <h4 class="font-bold text-purple-800">Piloto Validado</h4>
                    <span class="milestone-status text-2xl">‚è≥</span>
                  </div>
                  <div class="text-sm text-purple-700 mb-2">Mes 9 ‚Ä¢ Peso: 30%</div>
                  <div class="w-full bg-purple-100 rounded-full h-2">
                    <div class="milestone-progress bg-purple-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                  </div>
                  <div class="text-xs text-purple-600 mt-2">3 vagonetas, ingresos marketplace</div>
                </div>
                
                <div class="milestone-card bg-white p-4 rounded-lg border-l-4 border-orange-500" data-milestone="month12">
                  <div class="flex justify-between items-center mb-2">
                    <h4 class="font-bold text-orange-800">Serie A Ready</h4>
                    <span class="milestone-status text-2xl">üîÆ</span>
                  </div>
                  <div class="text-sm text-orange-700 mb-2">Mes 12 ‚Ä¢ Peso: 20%</div>
                  <div class="w-full bg-orange-100 rounded-full h-2">
                    <div class="milestone-progress bg-orange-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                  </div>
                  <div class="text-xs text-orange-600 mt-2">Term sheet $45M negociado</div>
                </div>
              </div>

              <!-- Next Actions -->
              <div class="bg-white p-4 rounded-lg">
                <h4 class="font-semibold mb-3">üöÄ Pr√≥ximas Acciones Cr√≠ticas</h4>
                <div id="next-actions" class="space-y-2">
                  <div class="flex items-center p-2 bg-blue-50 rounded border-l-4 border-blue-500">
                    <span class="text-blue-500 mr-2">üéØ</span>
                    <span class="text-sm text-blue-800">Completar integraci√≥n social scoring en HASE</span>
                  </div>
                  <div class="flex items-center p-2 bg-green-50 rounded border-l-4 border-green-500">
                    <span class="text-green-500 mr-2">ü§ñ</span>
                    <span class="text-sm text-green-800">Implementar PIA con WhatsApp Business API</span>
                  </div>
                  <div class="flex items-center p-2 bg-purple-50 rounded border-l-4 border-purple-500">
                    <span class="text-purple-500 mr-2">üìã</span>
                    <span class="text-sm text-purple-800">Finalizar tr√°mites REPUVE para vagonetas</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="font-bold text-xl mb-4">Desarrollo T√©cnico</h3>
                    <div id="tech-progress-bars" class="space-y-4"></div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="font-bold text-xl mb-4">Hitos de Negocio</h3>
                    <div id="business-progress-bars" class="space-y-4"></div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="font-bold text-xl mb-4">Burn Rate vs Plan</h3>
                    <div id="burn-rate-chart-container" class="chart-container" style="height: 250px;">
                        <canvas id="burn-rate-chart"></canvas>
                    </div>
                </div>
            </div>
        </section>

    </main>
    
    <!-- Modals -->
    <div id="agent-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto" id="modal-content-wrapper">
            <div class="sticky top-0 bg-white border-b p-4 flex justify-between items-center">
                <h2 id="modal-title" class="text-xl font-bold text-slate-800"></h2>
                <button id="close-modal" class="text-slate-500 hover:text-slate-700 text-2xl">&times;</button>
            </div>
            <div id="modal-content" class="p-6">
                <!-- Contenido del modal inyectado por JS -->
            </div>
        </div>
    </div>
    
    <div id="capex-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg max-w-3xl w-full">
            <div class="p-6 border-b flex justify-between items-center">
                <h3 class="text-xl font-bold text-slate-800">CAPEX Vagonetas - Breakdown Detallado</h3>
                <button id="close-capex-modal" class="text-slate-500 hover:text-slate-700 text-2xl">&times;</button>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-slate-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-slate-800 mb-3">Costo por Unidad</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span>Vagoneta para conversi√≥n GNV:</span>
                                <span class="font-semibold">$730,000</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Hardware IoT completo:</span>
                                <span class="font-semibold">$100,000</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Seguro + registro REPUVE:</span>
                                <span class="font-semibold">$46,667</span>
                            </div>
                            <div class="border-t pt-2 flex justify-between font-bold">
                                <span>Total por unidad:</span>
                                <span>$876,667</span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-slate-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-slate-800 mb-3">Hardware IoT ($100k)</h4>
                        <div class="text-sm text-slate-600 space-y-1">
                            <div>‚Ä¢ OBD-II diagn√≥sticos avanzados</div>
                            <div>‚Ä¢ GPS tracking + geofencing</div>
                            <div>‚Ä¢ Medidores flujo GNV + alertas</div>
                            <div>‚Ä¢ Aceler√≥metros comportamiento</div>
                            <div>‚Ä¢ Conectividad LTE/4G + backup 3G</div>
                            <div class="text-xs text-amber-600 mt-2">*Sin desglose espec√≠fico por sensor</div>
                        </div>
                    </div>
                    <div class="bg-slate-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-slate-800 mb-3">Cronograma Despliegue</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span>Unidad 1 (validaci√≥n):</span>
                                <span class="font-semibold text-blue-600">Mes 6</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Unidad 2 (escalamiento):</span>
                                <span class="font-semibold text-green-600">Mes 7</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Unidad 3 (validaci√≥n final):</span>
                                <span class="font-semibold text-purple-600">Mes 8</span>
                            </div>
                            <div class="text-xs text-slate-500 mt-3">
                                Total: 3 unidades √ó $876,667 = $2,630,000
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-slate-800 text-white mt-16">
        <div class="container mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center text-sm">
            <p>&copy; 2025 Rodando a Gas. Blueprint Operacional.</p>
        </div>
    </footer>

    <script>
    // AGREGAR: Cross-Reference Navigation System
    class CrossReferenceController {
      constructor() {
        this.references = {
          'core-ia-budget': {
            sourceSelector: '[data-ref="core-ia-budget"]',
            target: 'tecnologia',
            description: 'Ver desglose t√©cnico por agente',
            highlightSelector: '.agent-card'
          },
          'team-cost': {
            sourceSelector: '[data-ref="team-cost"]',
            target: 'equipo',
            description: 'Ver estructura y roles del equipo',
            highlightSelector: '#hr-table'
          },
          'hase-development': {
            sourceSelector: '[data-ref="hase-development"]',
            target: 'ejecucion',
            description: 'Ver cronograma de desarrollo HASE',
            highlightSelector: '[data-month="1"], [data-month="2"], [data-month="3"]'
          },
          'pia-development': {
            sourceSelector: '[data-ref="pia-development"]',
            target: 'ejecucion',
            description: 'Ver cronograma de desarrollo PIA',
            highlightSelector: '[data-month="4"], [data-month="5"]'
          },
          'superPma-development': {
            sourceSelector: '[data-ref="superPma-development"]',
            target: 'ejecucion',
            description: 'Ver cronograma de desarrollo Super-PMA',
            highlightSelector: '[data-month="5"], [data-month="6"]'
          },
          'asistente-development': {
            sourceSelector: '[data-ref="asistente-development"]',
            target: 'ejecucion',
            description: 'Ver cronograma de desarrollo Asistente',
            highlightSelector: '[data-month="4"], [data-month="5"]'
          },
          'ragDna-development': {
            sourceSelector: '[data-ref="ragDna-development"]',
            target: 'ejecucion',
            description: 'Ver cronograma RAG-DNA',
            highlightSelector: '[data-month="1"], [data-month="2"]'
          },
          'capex-breakdown': {
            sourceSelector: '[data-ref="capex-breakdown"]',
            target: 'ejecucion',
            description: 'Ver despliegue de vagonetas',
            highlightSelector: '[data-month="6"], [data-month="7"], [data-month="8"]'
          },
          'roi-calculation': {
            sourceSelector: '[data-ref="roi-calculation"]',
            target: 'financiero',
            description: 'Ver c√°lculos financieros detallados',
            highlightSelector: '#roiComparisonChart'
          }
        };
        this.init();
      }

      init() {
        this.createCrossReferences();
        this.bindEvents();
      }

      createCrossReferences() {
        Object.entries(this.references).forEach(([id, ref]) => {
          const sourceElements = document.querySelectorAll(ref.sourceSelector);
          sourceElements.forEach(element => {
            this.addCrossReferenceLink(element, ref);
          });
        });
      }

      addCrossReferenceLink(element, reference) {
        const link = document.createElement('button');
        link.className = 'cross-ref-link text-teal-600 hover:text-teal-800 text-xs ml-2 underline';
        link.innerHTML = `‚Üí ${reference.description}`;
        link.onclick = (e) => {
          e.preventDefault();
          this.navigateToReference(reference);
        };
        element.appendChild(link);
      }

      navigateToReference(reference) {
        const targetElement = document.getElementById(reference.target);
        if (targetElement) {
          // Smooth scroll to target
          targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
          
          // Highlight target section
          this.highlightSection(targetElement);
          
          // Highlight specific elements if specified
          if (reference.highlightSelector) {
            setTimeout(() => {
              this.highlightElements(reference.highlightSelector);
            }, 500);
          }
        }
      }

      highlightSection(element) {
        element.classList.add('section-highlight');
        setTimeout(() => {
          element.classList.remove('section-highlight');
        }, 3000);
      }

      highlightElements(selector) {
        document.querySelectorAll(selector).forEach(el => {
          el.classList.add('cross-ref-highlight');
          setTimeout(() => {
            el.classList.remove('cross-ref-highlight');
          }, 3000);
        });
      }

      bindEvents() {
        // Additional event bindings if needed
      }
    }

    // AGREGAR: Comprehensive Data Validation System
    class DataValidator {
      constructor() {
        this.foundationalData = {
          totalBudget: 7665000,
          teamCost: 1940000,
          coreTech: 2265000,
          pilotCapex: 2630000,
          saasStack: 631000,
          ragDNA: 150000,
          reserva: 49000,
          runway: 12,
          teamSize: 8,
          coreESOP: 3
        };
        
        this.tolerance = 1000; // Tolerance for rounding differences
        this.discrepancies = [];
        this.init();
      }

      init() {
        this.validateAll();
        this.displayValidationBadge();
      }

      validateAll() {
        this.discrepancies = [];
        this.validateFinancialData();
        this.validateTeamData();
        this.validateTechnicalData();
        this.validateTimelineData();
        return this.generateValidationReport();
      }

      validateFinancialData() {
        // Validate total budget matches sum of components
        const componentSum = this.foundationalData.teamCost +
                            this.foundationalData.coreTech +
                            this.foundationalData.pilotCapex +
                            this.foundationalData.saasStack +
                            this.foundationalData.ragDNA +
                            this.foundationalData.reserva;

        if (Math.abs(componentSum - this.foundationalData.totalBudget) > this.tolerance) {
          this.discrepancies.push({
            type: 'financial',
            field: 'totalBudget',
            expected: this.foundationalData.totalBudget,
            actual: componentSum,
            severity: 'high',
            message: 'Presupuesto total no coincide con suma de componentes'
          });
        }

        // Validate monthly burn rate
        const avgMonthlyBurn = this.foundationalData.totalBudget / this.foundationalData.runway;
        const expectedBurn = 638000; // From documents

        if (Math.abs(avgMonthlyBurn - expectedBurn) > 50000) {
          this.discrepancies.push({
            type: 'financial',
            field: 'burnRate',
            expected: expectedBurn,
            actual: Math.round(avgMonthlyBurn),
            severity: 'medium',
            message: 'Burn rate promedio fuera de rango esperado'
          });
        }
      }

      validateTeamData() {
        const teamElements = document.querySelectorAll('#hr-table tbody tr');
        if (teamElements.length !== this.foundationalData.teamSize) {
          this.discrepancies.push({
            type: 'team',
            field: 'teamSize',
            expected: this.foundationalData.teamSize,
            actual: teamElements.length,
            severity: 'medium',
            message: 'N√∫mero de miembros del equipo no coincide'
          });
        }

        // Validate ESOP members
        const esopMembers = Object.keys(equipoMatrizCompleta?.roles?.filter(r => r.type === 'ESOP') || {}).length;
        if (esopMembers !== this.foundationalData.coreESOP) {
          this.discrepancies.push({
            type: 'team',
            field: 'esopSize',
            expected: this.foundationalData.coreESOP,
            actual: esopMembers,
            severity: 'low',
            message: 'N√∫mero de perfiles ESOP no coincide'
          });
        }
      }

      validateTechnicalData() {
        // Validate agent budget allocation
        const agentBudgets = {
          hase: 710000,
          pia: 475000,
          superPma: 600000,
          asistente: 330000,
          ragDna: 150000
        };

        const totalAgentBudget = Object.values(agentBudgets).reduce((sum, budget) => sum + budget, 0);

        if (Math.abs(totalAgentBudget - this.foundationalData.coreTech) > this.tolerance) {
          this.discrepancies.push({
            type: 'technical',
            field: 'agentBudgets',
            expected: this.foundationalData.coreTech,
            actual: totalAgentBudget,
            severity: 'high',
            message: 'Presupuesto total de agentes no coincide con Core Tech'
          });
        }
      }

      validateTimelineData() {
        // Validate timeline has 12 months of data
        const timelineElements = document.querySelectorAll('[data-month]');
        const uniqueMonths = new Set();
        
        timelineElements.forEach(el => {
          const month = el.getAttribute('data-month');
          if (month) uniqueMonths.add(parseInt(month));
        });

        if (uniqueMonths.size < 10) { // Allow some flexibility
          this.discrepancies.push({
            type: 'timeline',
            field: 'monthCoverage',
            expected: 12,
            actual: uniqueMonths.size,
            severity: 'medium',
            message: 'Timeline no cubre suficientes meses del cronograma'
          });
        }
      }

      generateValidationReport() {
        if (this.discrepancies.length === 0) {
          return {
            status: 'valid',
            message: 'Todos los datos est√°n alineados con documentos fundacionales',
            discrepancies: []
          };
        }

        return {
          status: 'invalid',
          discrepancies: this.discrepancies,
          recommendations: this.generateRecommendations()
        };
      }

      generateRecommendations() {
        return this.discrepancies.map(disc => {
          switch (disc.type) {
            case 'financial':
              return `Revisar c√°lculos financieros en ${disc.field}`;
            case 'team':
              return `Verificar datos del equipo: ${disc.field}`;
            case 'technical':
              return `Validar presupuestos t√©cnicos: ${disc.field}`;
            case 'timeline':
              return `Completar datos de cronograma: ${disc.field}`;
            default:
              return `Revisar inconsistencia en ${disc.field}`;
          }
        });
      }

      displayValidationBadge() {
        const validation = this.validateAll();
        
        // Remove existing badge
        const existingBadge = document.getElementById('validation-badge');
        if (existingBadge) existingBadge.remove();

        const badge = document.createElement('div');
        badge.id = 'validation-badge';
        badge.className = `fixed bottom-4 right-4 px-4 py-2 rounded-lg text-white text-sm z-50 cursor-pointer transition-all duration-300 ${
          validation.status === 'valid' 
            ? 'bg-green-500 hover:bg-green-600' 
            : 'bg-red-500 hover:bg-red-600'
        }`;

        const icon = validation.status === 'valid' ? '‚úì' : '‚ö†';
        const text = validation.status === 'valid' ? 'Datos Validados' : `${this.discrepancies.length} Inconsistencias`;

        badge.innerHTML = `${icon} ${text}`;
        badge.onclick = () => this.showValidationModal(validation);

        document.body.appendChild(badge);

        // Animate in
        setTimeout(() => {
          badge.style.transform = 'translateY(0)';
        }, 100);
      }

      showValidationModal(validation) {
        // Remove existing modal
        const existingModal = document.getElementById('validation-modal');
        if (existingModal) existingModal.remove();

        const modal = document.createElement('div');
        modal.id = 'validation-modal';
        modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
        
        modal.innerHTML = `
          <div class="bg-white rounded-lg max-w-2xl w-full max-h-[80vh] overflow-y-auto">
            <div class="p-6 border-b flex justify-between items-center">
              <h3 class="text-xl font-bold text-slate-800">
                ${validation.status === 'valid' ? '‚úÖ Validaci√≥n Exitosa' : '‚ö†Ô∏è Inconsistencias Detectadas'}
              </h3>
              <button onclick="document.getElementById('validation-modal').remove()" 
                      class="text-slate-500 hover:text-slate-700 text-2xl">&times;</button>
            </div>
            
            <div class="p-6">
              ${validation.status === 'valid' ? `
                <div class="text-green-700 mb-4">
                  <p class="mb-2">${validation.message}</p>
                  <div class="bg-green-50 p-4 rounded-lg">
                    <h4 class="font-semibold mb-2">Validaciones Completadas:</h4>
                    <ul class="text-sm space-y-1">
                      <li>‚úì Coherencia presupuestal</li>
                      <li>‚úì Estructura del equipo</li>
                      <li>‚úì Asignaci√≥n t√©cnica</li>
                      <li>‚úì Cronograma completo</li>
                    </ul>
                  </div>
                </div>
              ` : `
                <div class="space-y-4">
                  ${validation.discrepancies.map(disc => `
                    <div class="border-l-4 ${disc.severity === 'high' ? 'border-red-500 bg-red-50' : 
                                           disc.severity === 'medium' ? 'border-yellow-500 bg-yellow-50' : 
                                           'border-blue-500 bg-blue-50'} p-4 rounded">
                      <div class="flex justify-between items-start mb-2">
                        <h4 class="font-semibold text-slate-800">${disc.message}</h4>
                        <span class="text-xs px-2 py-1 rounded ${
                          disc.severity === 'high' ? 'bg-red-200 text-red-800' :
                          disc.severity === 'medium' ? 'bg-yellow-200 text-yellow-800' :
                          'bg-blue-200 text-blue-800'
                        }">${disc.severity}</span>
                      </div>
                      <div class="text-sm text-slate-600">
                        <div>Esperado: ${this.formatValue(disc.expected)}</div>
                        <div>Actual: ${this.formatValue(disc.actual)}</div>
                      </div>
                    </div>
                  `).join('')}
                  
                  <div class="bg-slate-50 p-4 rounded-lg">
                    <h4 class="font-semibold mb-2">Recomendaciones:</h4>
                    <ul class="text-sm space-y-1">
                      ${validation.recommendations.map(rec => `<li>‚Ä¢ ${rec}</li>`).join('')}
                    </ul>
                  </div>
                </div>
              `}
            </div>
          </div>
        `;

        document.body.appendChild(modal);

        // Click outside to close
        modal.addEventListener('click', (e) => {
          if (e.target === modal) modal.remove();
        });
      }

      formatValue(value) {
        if (typeof value === 'number') {
          return new Intl.NumberFormat('es-MX').format(value);
        }
        return value;
      }
    }

    // AGREGAR: Testing and Validation Utilities
    class TestingController {
      constructor() {
        this.tests = [];
        this.results = {
          passed: 0,
          failed: 0,
          total: 0
        };
        this.init();
      }

      init() {
        this.setupTestSuite();
        this.runTests();
      }

      setupTestSuite() {
        // Functional Tests
        this.addTest('Navigation Links', () => this.testNavigationLinks());
        this.addTest('Charts Loading', () => this.testChartsLoading());
        this.addTest('Role Switching', () => this.testRoleSwitching());
        this.addTest('Phase Filtering', () => this.testPhaseFiltering());
        this.addTest('Data Validation', () => this.testDataValidation());
        this.addTest('Cross References', () => this.testCrossReferences());
        this.addTest('Progress Tracking', () => this.testProgressTracking());
        this.addTest('Mobile Navigation', () => this.testMobileNavigation());
      }

      addTest(name, testFunction) {
        this.tests.push({ name, testFunction });
      }

      runTests() {
        console.log('üß™ Ejecutando suite de pruebas...');
        
        this.tests.forEach(test => {
          try {
            const result = test.testFunction();
            if (result) {
              this.results.passed++;
              console.log(`‚úÖ ${test.name}: PASS`);
            } else {
              this.results.failed++;
              console.log(`‚ùå ${test.name}: FAIL`);
            }
          } catch (error) {
            this.results.failed++;
            console.log(`‚ùå ${test.name}: ERROR - ${error.message}`);
          }
          this.results.total++;
        });

        this.displayResults();
      }

      testNavigationLinks() {
        const navLinks = document.querySelectorAll('.nav-link');
        const sections = document.querySelectorAll('section[id]');
        let allLinksValid = true;

        navLinks.forEach(link => {
          const href = link.getAttribute('href');
          if (href && href.startsWith('#')) {
            const targetId = href.replace('#', '');
            const targetSection = document.getElementById(targetId);
            if (!targetSection) {
              allLinksValid = false;
              console.warn(`Missing target section: ${targetId}`);
            }
          }
        });

        return navLinks.length > 0 && sections.length > 0 && allLinksValid;
      }

      testChartsLoading() {
        const charts = document.querySelectorAll('canvas');
        let chartsLoaded = true;

        charts.forEach(canvas => {
          if (!canvas.getContext) {
            chartsLoaded = false;
          }
        });

        return charts.length > 0 && chartsLoaded;
      }

      testRoleSwitching() {
        if (!window.audienceController) return false;
        
        const roleSelector = document.getElementById('role-selector');
        if (!roleSelector) return false;

        // Test role switching
        window.audienceController.switchRole('investor');
        const bodyHasRoleClass = document.body.className.includes('role-investor');
        
        window.audienceController.switchRole('general');
        return bodyHasRoleClass;
      }

      testPhaseFiltering() {
        if (!window.phaseController) return false;
        
        const phaseButtons = document.querySelectorAll('.phase-btn');
        if (phaseButtons.length === 0) return false;

        // Test phase filtering
        window.phaseController.filterByPhase('foundation');
        const hasActiveButton = document.querySelector('.phase-btn.active');
        
        window.phaseController.filterByPhase('all');
        return hasActiveButton !== null;
      }

      testDataValidation() {
        if (!window.dataValidator) return false;
        
        const validation = window.dataValidator.validateAll();
        return validation && validation.hasOwnProperty('status');
      }

      testCrossReferences() {
        if (!window.crossReferenceController) return false;
        
        const crossRefLinks = document.querySelectorAll('.cross-ref-link');
        return crossRefLinks.length > 0;
      }

      testProgressTracking() {
        if (!window.progressTracker) return false;
        
        const progressBars = document.querySelectorAll('.milestone-progress');
        const milestoneCards = document.querySelectorAll('.milestone-card');
        
        return progressBars.length > 0 && milestoneCards.length > 0;
      }

      testMobileNavigation() {
        const mobileNav = document.getElementById('mobile-nav');
        const mobileLinks = document.querySelectorAll('.mobile-nav-link');
        
        return mobileNav !== null && mobileLinks.length > 0;
      }

      displayResults() {
        const successRate = Math.round((this.results.passed / this.results.total) * 100);
        
        console.log('\nüìä Resultados de Pruebas:');
        console.log(`‚úÖ Exitosas: ${this.results.passed}`);
        console.log(`‚ùå Fallidas: ${this.results.failed}`);
        console.log(`üìà Tasa de √©xito: ${successRate}%`);
        
        if (successRate >= 90) {
          console.log('üéâ EXCELENTE: Sistema funcionando correctamente');
        } else if (successRate >= 75) {
          console.log('‚ö†Ô∏è BUENO: Algunos problemas menores detectados');
        } else {
          console.log('üö® ATENCI√ìN: Problemas cr√≠ticos detectados');
        }

        // Show results in UI if in development mode
        if (window.location.hostname === 'localhost' || window.location.search.includes('debug=true')) {
          this.showTestResults(successRate);
        }
      }

      showTestResults(successRate) {
        const resultsModal = document.createElement('div');
        resultsModal.className = 'fixed top-4 left-4 bg-white border border-gray-300 rounded-lg shadow-lg p-4 z-50 max-w-sm';
        resultsModal.innerHTML = `
          <div class="flex justify-between items-center mb-2">
            <h4 class="font-bold text-slate-800">üß™ Test Results</h4>
            <button onclick="this.parentElement.parentElement.remove()" class="text-slate-500">&times;</button>
          </div>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between">
              <span>Passed:</span>
              <span class="text-green-600 font-semibold">${this.results.passed}</span>
            </div>
            <div class="flex justify-between">
              <span>Failed:</span>
              <span class="text-red-600 font-semibold">${this.results.failed}</span>
            </div>
            <div class="flex justify-between">
              <span>Success Rate:</span>
              <span class="font-bold ${successRate >= 90 ? 'text-green-600' : 
                                     successRate >= 75 ? 'text-yellow-600' : 
                                     'text-red-600'}">${successRate}%</span>
            </div>
          </div>
          <div class="mt-2 text-xs text-slate-500">
            ${successRate >= 90 ? 'üéâ All systems operational' :
              successRate >= 75 ? '‚ö†Ô∏è Minor issues detected' :
              'üö® Critical issues found'}
          </div>
        `;

        document.body.appendChild(resultsModal);

        // Auto-hide after 5 seconds
        setTimeout(() => {
          if (resultsModal.parentElement) {
            resultsModal.remove();
          }
        }, 5000);
      }
    }

    // --- GLOBAL DATA OBJECTS (Available before DOMContentLoaded) ---
    const equipoMatrizCompleta = { roles: [ { name: 'Cient√≠fico de Datos', type: 'ESOP', hours: 1584, focus: 'HASE l√≠der + Social Scoring + RAG-DNA', allocations: ['HASE/RAG-DNA', 'HASE/Social', 'Social OCR', 'HASE API', 'Deploy RT', 'Super-PMA', 'An√°lisis', 'Optimizaci√≥n', 'Validaci√≥n', 'Doc Tech', 'Serie A', 'Serie A'] }, { name: 'Ingeniero ML', type: 'ESOP', hours: 1440, focus: 'PIA l√≠der + Asistente NLP/CV + HASE support', allocations: ['HASE Support', 'PIA/HASE', 'PIA Core', 'PIA WhatsApp', 'PIA Deploy', 'Asistente', 'Asistente CV', 'Multimodal', 'Optimizaci√≥n', 'Doc IA', 'Serie A', 'Serie A'] }, { name: 'Full-Stack IA', type: 'ESOP', hours: 1536, focus: 'SaaS arquitecto + RAG-DNA + Integration', allocations: ['SaaS Setup', 'SaaS/RAG-DNA', 'SaaS Complete', 'PIA Frontend', 'PIA Dash', 'Super-PMA UI', 'Marketplace', 'Integration', 'Optimization', 'Final Integration', 'Support', 'Support'] }, { name: 'Backend Developer', type: 'Contractor', hours: 1296, focus: 'APIs Core + Social Scoring + Pagos Inclusivos', allocations: ['DB Schema', 'HASE APIs', 'Social APIs', 'PIA APIs', 'Pagos APIs', 'Integration', 'Support APIs', 'Optimization', 'Performance', 'Documentation', 'Maintenance', 'Maintenance'] }, { name: 'IoT Engineer', type: 'Contractor', hours: 768, focus: 'Sensores + Kafka streaming + Hardware', allocations: ['-', 'Super-PMA HW', 'Kafka Setup', 'Sensors Select', 'Streaming', 'Deploy V1', 'Deploy V2', 'Deploy V3', 'Monitoring', 'Optimization', '-', '-'] }, { name: 'Frontend Developer', type: 'Contractor', hours: 720, focus: 'App Android + Dashboards + UX', allocations: ['-', '-', 'App Start', 'App Core', 'App Beta', 'App Production', 'Dashboard', 'UX Optimization', 'Final Polish', 'Documentation', '-', '-'] }, { name: 'DevOps Engineer', type: 'Contractor', hours: 480, focus: 'Infrastructure + CI/CD + Monitoring', allocations: ['AWS Setup', 'CI/CD', 'Monitoring', 'Scaling', 'Security', 'Support', '-', '-', '-', '-', '-', '-'] }, { name: 'QA Engineer', type: 'Contractor', hours: 384, focus: 'Testing automation + Validation', allocations: ['-', '-', '-', '-', '-', 'Setup QA', 'Testing', 'Validation', 'Regression', 'Final QA', '-', '-'] } ], totalHours: 7760, totalCost: 1940000, esopEquity: '10%', esopUpside: '~$15M MXN en Serie A exitosa' };

    document.addEventListener('DOMContentLoaded', function() {
        // --- DATA OBJECTS ---
        const presupuestoReal = { total: 7665000, distribucion: { coreIA: 2265000, capexPiloto: 2630000, equipoTotal: 1940000, saasStack: 631000, ragDNA: 150000, reserva: 49000 } };
        const agentesDetalleCompleto = { hase: { presupuesto: 710000, breakdown: { desarrollo: 600000, socialScoring: 110000 }, horas: 1584, arquitectura: ['XGBoost', 'FastAPI <200ms', 'PostgreSQL', 'TimescaleDB', 'SHAP XAI', 'Apache Airflow'], diferenciadorUnico: 'Carta Aval de Ruta - Colateral Social Propietario', apis: ['POST /api/v1/score', 'POST /api/v1/social-scoring', 'GET /api/v1/risk-profile'], kpisTecnicos: ['Mes 3: >80% AUC offline', 'Mes 6: >90% AUC tiempo real', 'Social scoring >85% correlaci√≥n'], sla: { latency: '200ms', accuracy: '90% AUC', uptime: '99.9%' } }, pia: { presupuesto: 475000, breakdown: { desarrollo: 400000, whatsappBusiness: 45000, llmTraining: 30000 }, horas: 576, arquitectura: ['WhatsApp Business API', 'LLMs emp√°ticos', 'Decision Trees', 'FastAPI', 'Redis queue'], apis: ['POST /api/v1/trigger-alert', 'POST /api/v1/whatsapp-webhook', 'GET /api/v1/intervention-analytics'], kpisTecnicos: ['<2min response SLA', 'Motor alertas funcional', 'WhatsApp integrado'], sla: { responseTime: '2min', availability: '99.9%', successRate: '95%' } }, superPma: { presupuesto: 600000, breakdown: { desarrollo: 450000, marketplace: 100000, partnerships: 50000 }, horas: 768, arquitectura: ['Kafka', 'Spark Streaming', 'InfluxDB', 'Arquitectura Kappa', 'React', 'Python'], sensores: ['OBD-II', 'GPS 30-60seg', 'Aceler√≥metros', 'Medidores GNV', 'LTE conectividad'], marketplace: { comision: '15-20%', partners: ['Jetz App 90min', 'Meru 1000+ brands'] }, apis: ['POST /api/v1/telemetry', 'GET /api/v1/maintenance-predictions', 'POST /api/v1/marketplace/order'], kpisTecnicos: ['>85% precisi√≥n predicci√≥n', '>1000 events/sec Kafka', '99.5% uptime sensores'], beneficios: ['25% reducci√≥n costos mantenimiento', '30-50% menos inactividad', 'Hasta 40% optimizaci√≥n combustible'] }, asistente: { presupuesto: 330000, breakdown: { desarrollo: 220000, gpt4Vision: 45000, baseConocimiento: 35000, automationTools: 30000 }, horas: 480, arquitectura: ['GPT-4 Vision', 'Claude 3', 'BERT espa√±ol', 'Make/n8n', 'WhatsApp chatbot'], apis: ['POST /api/v1/chat', 'POST /api/v1/visual-diagnosis', 'GET /api/v1/knowledge-base'], kpisTecnicos: ['70% consultas automatizadas', '<3seg response time', '24/7 uptime'], monetizacion: ['Diagn√≥sticos premium $500-800/consulta', 'Base conocimiento 50+ escenarios'] }, ragDna: { presupuesto: 150000, breakdown: { entrevistas: 60000, algoritmatizacion: 50000, validacion: 40000 }, horas: 432, proposito: 'Sistematizaci√≥n 20+ a√±os experiencia RAG en algoritmos', impacto: 'Conocimiento humano ‚Üí Activo tecnol√≥gico escalable', diferenciador: 'Experience-to-Algorithm √∫nico en mercado' } };
        const arquitecturaDatos = { fuentes: { gnv: { campos: ['litros_cargados', 'sobreprecio_por_litro'], endpoint: 'POST /api/v1/transactions', frecuencia: 'tiempo real' }, gps: { campos: ['odometro', 'estado_motor', 'lat_lng'], endpoint: 'POST /api/v1/telemetry', frecuencia: '30-60 segundos' }, consware: { campos: ['consumo_gnv_diario', 'ruta', 'eventos_criticos'], endpoint: 'GET /api/v1/historical?fecha=YYYY-MM-DD', frecuencia: 'diaria' }, cartaAval: { campos: ['ocr_texto', 'firma_validada', 'presidente_ruta'], endpoint: 'POST /api/v1/social-scoring', frecuencia: 'onboarding' }, iotSensores: { campos: ['obd_codes', 'acelerometro', 'flujo_gnv'], endpoint: 'POST /api/v1/sensors', frecuencia: 'streaming' } }, storage: { postgresql: 'Datos estructurados + scoring', timescaledb: 'Series temporales GPS/GNV', influxdb: 'Datos IoT alta frecuencia', redis: 'Cache APIs + cola mensajes PIA' }, etl: { herramienta: 'Apache Airflow', pipeline: 'Ingesta ‚Üí Limpieza ‚Üí Enriquecimiento ‚Üí Storage', latencia: '<500ms datos cr√≠ticos' } };
        const cronogramaSemanalCompleto = { mes1: { titulo: 'Fundaci√≥n + RAG-DNA', sem1: { tasks: ['AWS setup VPC+IAM', 'Odoo installation config', 'Ingesta Consware hist√≥rica'], owners: ['DevOps', 'Full-Stack', 'Data Scientist'], hours: 240, milestone: 'Infra base + datos limpios' }, sem2: { tasks: ['Auth0 setup', 'Features engineering HASE', 'RAG-DNA entrevistas start'], owners: ['Full-Stack', 'Data Scientist', 'Data Scientist'], hours: 240, milestone: 'Seguridad + arquitectura definida' }, sem3: { tasks: ['HASE baseline v0.5', 'API structure design', 'Database schema'], owners: ['Data Scientist', 'Backend', 'Backend'], hours: 240, milestone: 'Baseline modelo + APIs dise√±adas' }, sem4: { tasks: ['RAG-DNA sistematizaci√≥n', 'SaaS basic integration', 'Social scoring design'], owners: ['Data Scientist', 'Full-Stack', 'ML Engineer'], hours: 240, milestone: 'RAG-DNA iniciado + social scoring dise√±ado' } }, mes2: { titulo: 'Social Scoring + Pagos Inclusivos', sem1: { tasks: ['Carta Aval OCR research', 'STP integration start', 'PIA architecture'], owners: ['Data Scientist', 'Backend', 'ML Engineer'], hours: 240, milestone: 'OCR research + pagos inclusivos start' }, sem2: { tasks: ['OCR engine development', 'Oxxo Pay API integration', 'XGBoost + social hybrid'], owners: ['Data Scientist', 'Backend', 'Data Scientist'], hours: 240, milestone: 'OCR funcional + pagos inclusivos' }, sem3: { tasks: ['Social scoring validation', 'PLD compliance', 'Motor alertas PIA'], owners: ['Data Scientist', 'Backend', 'ML Engineer'], hours: 240, milestone: 'H√≠brido HASE+social funcional' }, sem4: { tasks: ['Correlaci√≥n >85% social', 'Stack pagos testing', 'WhatsApp Business setup'], owners: ['Data Scientist', 'Backend', 'ML Engineer'], hours: 240, milestone: 'Social scoring >85% + pagos operativos' } }, mes3: { titulo: 'HASE Tiempo Real + App MVP', sem1: { tasks: ['HASE v0.8 deployment', 'Android app start', 'Super-PMA design'], owners: ['Data Scientist', 'Frontend', 'IoT Engineer'], hours: 240, milestone: 'HASE tiempo real' }, sem2: { tasks: ['API FastAPI optimization', 'App backend APIs', 'Kafka setup'], owners: ['Backend', 'Frontend', 'IoT Engineer'], hours: 240, milestone: 'APIs optimizadas + Kafka streaming' }, sem3: { tasks: ['HASE >80% AUC validation', 'App UI/UX', 'Legal REPUVE prep'], owners: ['Data Scientist', 'Frontend', 'Legal'], hours: 240, milestone: 'HASE validado + legal iniciado' }, sem4: { tasks: ['Social scoring integration final', 'App MVP beta', 'SEMARNAT applications'], owners: ['Data Scientist', 'Frontend', 'Legal'], hours: 240, milestone: 'MVP tech + legal en proceso' } }, mes4: { titulo: 'PIA + Asistente Digital + Legal', sem1: { tasks: ['PIA v1.0 WhatsApp', 'BERT espa√±ol setup', 'REPUVE documentation'], owners: ['ML Engineer', 'ML Engineer', 'Legal'], hours: 240, milestone: 'PIA funcional + BERT core' }, sem2: { tasks: ['LLMs emp√°ticos training', 'IoT sensors selection', 'Contratos piloto'], owners: ['ML Engineer', 'IoT Engineer', 'Business'], hours: 240, milestone: 'LLMs trained + sensores seleccionados' }, sem3: { tasks: ['Decision trees escalamiento', '1ra vagoneta prep', 'App Android beta'], owners: ['ML Engineer', 'IoT Engineer', 'Frontend'], hours: 240, milestone: 'PIA completo + 1ra vagoneta prep' }, sem4: { tasks: ['WhatsApp integration testing', 'Base conocimiento', 'REPUVE final'], owners: ['ML Engineer', 'ML Engineer', 'Legal'], hours: 240, milestone: 'PIA <2min SLA + legal avanzado' } }, mes5: { titulo: 'Super-PMA Streaming + Marketplace', sem1: { tasks: ['Kafka streaming production', 'Asistente base conocimiento', 'SEMARNAT final'], owners: ['IoT Engineer', 'ML Engineer', 'Legal'], hours: 240, milestone: 'Streaming operativo + legal completo' }, sem2: { tasks: ['Sensores installation', 'GPT-4 Vision integration', 'App beta testing'], owners: ['IoT Engineer', 'ML Engineer', 'QA'], hours: 240, milestone: 'Sensores instalados + Vision AI' }, sem3: { tasks: ['InfluxDB optimization', 'Marketplace MVP design', 'Dashboard operativo'], owners: ['IoT Engineer', 'Full-Stack', 'Frontend'], hours: 240, milestone: 'DB optimizada + marketplace dise√±ado' }, sem4: { tasks: ['Modelos predictivos', 'Proveedores onboarding', 'App production'], owners: ['Data Scientist', 'Full-Stack', 'Frontend'], hours: 240, milestone: 'Modelos >85% + marketplace funcional' } }, mes6: { titulo: 'Deployment 1ra Vagoneta + Ecosistema Integrado', sem1: { tasks: ['1ra vagoneta deployment', 'Marketplace transaccional', 'HASE >90% validation'], owners: ['IoT Engineer', 'Full-Stack', 'Data Scientist'], hours: 240, milestone: '1ra vagoneta transmitiendo datos' }, sem2: { tasks: ['Streaming datos validaci√≥n', 'Asistente multimodal', 'Contratos firmados'], owners: ['IoT Engineer', 'ML Engineer', 'Business'], hours: 240, milestone: 'Datos streaming + contratos' }, sem3: { tasks: ['Super-PMA predicciones', 'Jetz+Meru integration', 'Compliance validation'], owners: ['Data Scientist', 'Full-Stack', 'Legal'], hours: 240, milestone: 'Predicciones funcionales + partnerships' }, sem4: { tasks: ['Ecosistema 4 agentes integrado', 'Marketplace primeras transacciones', 'QA setup'], owners: ['All Team', 'Full-Stack', 'QA Engineer'], hours: 240, milestone: 'MVP completo operacional' } }, mes7: { titulo: '2da Vagoneta + Validaci√≥n Comercial', sem1: { tasks: ['2da vagoneta deployment', 'Marketplace optimizaci√≥n', 'Pruebas carga'], owners: ['IoT Engineer', 'Full-Stack', 'QA Engineer'], hours: 240, milestone: '2da vagoneta operativa' }, sem2: { tasks: ['An√°lisis datos piloto', 'Comisiones automatizadas', 'Performance monitoring'], owners: ['Data Scientist', 'Backend', 'DevOps'], hours: 240, milestone: 'Datos validaci√≥n + comisiones' }, sem3: { tasks: ['Correlaci√≥n mantenimiento-riesgo', 'Primeros ingresos marketplace', 'NPS >50 tracking'], owners: ['Data Scientist', 'Business', 'Business'], hours: 240, milestone: 'Correlaci√≥n cuantificada + ingresos' }, sem4: { tasks: ['Optimizaci√≥n modelos', 'Feedback loops', 'Documentaci√≥n QA'], owners: ['ML Engineer', 'All Team', 'QA Engineer'], hours: 240, milestone: 'Optimizaci√≥n + feedback integrado' } }, mes8: { titulo: '3ra Vagoneta + Marketplace Escalamiento', sem1: { tasks: ['3ra vagoneta deployment', 'Marketplace scaling', 'Diagn√≥sticos premium'], owners: ['IoT Engineer', 'Full-Stack', 'ML Engineer'], hours: 240, milestone: '3ra vagoneta + premium services' }, sem2: { tasks: ['3 vagonetas >95% uptime', 'Proveedores expansion', 'Automatizaci√≥n testing'], owners: ['IoT Engineer', 'Business', 'QA Engineer'], hours: 240, milestone: '3 vagonetas estables' }, sem3: { tasks: ['An√°lisis econom√≠a unitaria', '$500/veh√≠culo/mes target', 'Regresi√≥n testing'], owners: ['Data Scientist', 'Business', 'QA Engineer'], hours: 240, milestone: 'Econom√≠a unitaria validada' }, sem4: { tasks: ['Refinamiento ecosistema', 'Business validation', 'Documentation'], owners: ['All Team', 'Business', 'QA Engineer'], hours: 240, milestone: 'Ecosistema refinado + validaci√≥n business' } }, mes9: { titulo: 'Optimizaci√≥n Final + Datos Validaci√≥n', sem1: { tasks: ['Optimizaci√≥n performance', 'Morosidad = 0% validation', 'Stress testing'], owners: ['All Team', 'Business', 'QA Engineer'], hours: 240, milestone: 'Performance optimizado' }, sem2: { tasks: ['Machine learning refinement', 'Business metrics final', 'Load testing'], owners: ['ML Team', 'Business', 'QA Engineer'], hours: 240, milestone: 'ML optimizado + m√©tricas' }, sem3: { tasks: ['Final validation KPIs', 'NPS >50 achieved', 'Security testing'], owners: ['All Team', 'Business', 'QA Engineer'], hours: 240, milestone: 'KPIs validados' }, sem4: { tasks: ['Piloto final analysis', 'Serie A preparation start', 'Final documentation'], owners: ['All Team', 'Business', 'All Team'], hours: 240, milestone: 'Piloto completo + Serie A prep' } }, mes10: { titulo: 'Documentaci√≥n + Serie A Preparaci√≥n', sem1: { tasks: ['Technical documentation', 'Business case documentation', 'Data room start'], owners: ['Tech Team', 'Business', 'All Team'], hours: 200, milestone: 'Documentaci√≥n t√©cnica completa' }, sem2: { tasks: ['API documentation', 'Financial projections', 'Investor materials'], owners: ['Backend', 'CFO', 'Business'], hours: 200, milestone: 'Documentaci√≥n APIs + financiera' }, sem3: { tasks: ['Architecture diagrams', 'ROI validation', 'Pitch deck'], owners: ['CTO', 'CFO', 'CEO'], hours: 200, milestone: 'Materiales investor ready' }, sem4: { tasks: ['Final testing', 'Business validation', 'Legal compliance'], owners: ['QA Engineer', 'Business', 'Legal'], hours: 200, milestone: 'Validaci√≥n final completa' } }, mes11: { titulo: 'Data Room + Investor Outreach', sem1: { tasks: ['Data room 100% complete', 'NPS >70 achievement', 'Investor meetings'], owners: ['All Team', 'Business', 'CEO'], hours: 180, milestone: 'Data room completo' }, sem2: { tasks: ['Due diligence prep', 'Financial audits', 'Tech presentations'], owners: ['All Team', 'CFO', 'CTO'], hours: 180, milestone: 'Due diligence ready' }, sem3: { tasks: ['Investor demos', 'Technical deep dives', 'Legal reviews'], owners: ['CEO', 'CTO', 'Legal'], hours: 180, milestone: 'Investor engagement activo' }, sem4: { tasks: ['Term sheet negotiations', 'Technical validation', 'Compliance final'], owners: ['CEO', 'CTO', 'Legal'], hours: 180, milestone: 'Negociaciones activas' } }, mes12: { titulo: 'Serie A Cierre + Roadmap Post-Inversi√≥n', sem1: { tasks: ['Term sheet $45M negotiation', 'Technical roadmap post-Serie A', 'Team scaling plan'], owners: ['CEO', 'CTO', 'HR'], hours: 160, milestone: 'Term sheet en negociaci√≥n' }, sem2: { tasks: ['Legal documentation', 'Technology transition plan', 'Operational scaling'], owners: ['Legal', 'CTO', 'COO'], hours: 160, milestone: 'Documentaci√≥n legal avanzada' }, sem3: { tasks: ['Final validations', 'Post-investment planning', 'Team preparation'], owners: ['All Team', 'Leadership', 'HR'], hours: 160, milestone: 'Preparaci√≥n post-inversi√≥n' }, sem4: { tasks: ['Serie A closing', 'Roadmap execution start', 'Celebration'], owners: ['CEO', 'All Team', 'All Team'], hours: 160, milestone: 'Serie A cerrada exitosamente' } } };
        const complianceTimeline = { repuve: { periodo: 'Mes 2-4', proceso: ['Documentaci√≥n t√©cnica vagonetas', 'Certificaci√≥n conversi√≥n GNV', 'Registro oficial SEMARNAT', 'Validaci√≥n final'], costo: 15000, timeline: '6-8 semanas proceso', criticidad: 'ALTA - Sin esto no opera vagoneta' }, semarnat: { periodo: 'Mes 3-4', proceso: ['Permisos conversi√≥n GNV', 'Verificaci√≥n emisiones', 'Certificado ambiental', 'Aprobaci√≥n final'], timeline: '6-8 semanas paralelo REPUVE', criticidad: 'ALTA - Requerido por ley' }, pld: { periodo: 'Mes 1-12', proceso: ['Pol√≠ticas compliance efectivo (Oxxo Pay)', 'Monitoreo transacciones >$7,500 MXN', 'Reportes CNBV mensuales', 'Auditor√≠a externa semestral'], criticidad: 'CONTINUA - Riesgo legal alto' } };
        const kpisConCorrelacion = { mes3: { tecnicos: ['HASE >80% AUC', 'Social >85%', 'OCR >95%'], business: ['Equipo 100%', 'RAG-DNA completo'], financial: ['Burn rate: $638k/mes', 'Runway: 8.5 meses'], correlacion: 'Precisi√≥n t√©cnica ‚Üí Confianza investor ‚Üí Capital availability' }, mes6: { tecnicos: ['HASE >90% AUC', 'PIA <2min SLA', '1ra vagoneta 99.5% uptime'], business: ['Contratos piloto firmados', 'REPUVE/SEMARNAT OK'], financial: ['Burn rate: $875k/mes', 'Runway: 5 meses'], correlacion: 'Performance t√©cnico ‚Üí Viabilidad comercial' }, mes9: { tecnicos: ['Super-PMA >85% accuracy', 'Marketplace transaccional', '3 vagonetas >95% uptime'], business: ['Ingresos marketplace', 'NPS >50'], financial: ['Ingresos: $15k/mes', 'Burn rate (neto): $850k/mes'], correlacion: 'Eficiencia operativa ‚Üí Rentabilidad comprobada' }, mes12: { tecnicos: ['Ecosistema optimizado', 'Documentaci√≥n completa', 'SOC2-ready'], business: ['Data room completo', 'NPS >70'], financial: ['Term sheet $45M', 'Econom√≠a unitaria validada'], correlacion: 'Madurez t√©cnica ‚Üí Readiness Serie A' } };
        const diferenciadores = { filosofia: { titulo: 'Humanamente Tecnol√≥gica', descripcion: 'IA para escalar empat√≠a, no reemplazar humanos', implementacion: 'PIA emp√°tico + Social scoring + Support 24/7', ventaja: 'Confianza en mercado hist√≥ricamente explotado' }, cartaAval: { titulo: 'Carta Aval de Ruta - Colateral Social √önico', descripcion: 'Primer scoring financiero basado en capital social', implementacion: 'OCR + validaci√≥n + algoritmo correlaci√≥n >85%', ventaja: 'Imposible replicar - conocimiento cultural 20+ a√±os' }, pagosInclusivos: { titulo: 'Stack Pagos 100% Inclusivo', descripcion: '70% poblaci√≥n no-bancarizada ‚Üí 100% accesible', implementacion: 'STP + Oxxo + PLD + Terminal POS', ventaja: 'TAM mantiene $10.9B vs $3B competencia' }, ragDna: { titulo: 'RAG-DNA: Experience-to-Algorithm', descripcion: '20+ a√±os experiencia convertida en IA', implementacion: 'Entrevistas ‚Üí Sistematizaci√≥n ‚Üí Algoritmos', ventaja: 'Conocimiento imposible adquirir por competidores' }, socios: { titulo: 'Socios, No Acreedores', descripcion: 'Resiliencia como Servicio vs pr√©stamo tradicional', implementacion: 'Flexibilidad + Support + Marketplace + Maintenance', ventaja: 'Loyalty en mercado con desconfianza hist√≥rica' } };
        const flujosEfectivoReales = { gastoEquipo: [120000, 130000, 140000, 140000, 140000, 140000, 140000, 140000, 140000, 130000, 120000, 110000], gastoDesarrollo: [315000, 340000, 365000, 355000, 355000, 355000, 325000, 325000, 325000, 280000, 280000, 290000], gastoCapex: [0, 0, 0, 0, 0, 876667, 876667, 876666, 0, 0, 0, 0], stackInclusivo: [10000, 15000, 25000, 35000, 35000, 35000, 35000, 35000, 35000, 35000, 35000, 35000], compliance: [5000, 8000, 12000, 15000, 8000, 5000, 3000, 3000, 3000, 3000, 3000, 8000], inversionInicial: 7665000 };
        
        // --- HELPERS ---
        const formatCurrency = (value) => new Intl.NumberFormat('es-MX', { style: 'currency', currency: 'MXN', minimumFractionDigits: 0 }).format(value);
        const formatNumber = (value) => new Intl.NumberFormat('es-MX').format(value);

        // --- RENDER FUNCTIONS ---

        // 1. Tesis y Diferenciadores
        function renderInvestmentChart() {
            const ctx = document.getElementById('investmentDonutChart')?.getContext('2d');
            if (!ctx) return;
            const data = presupuestoReal.distribucion;
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Core IA', 'CAPEX Piloto', 'Equipo Total', 'SaaS + Pagos', 'RAG-DNA', 'Reserva'],
                    datasets: [{
                        data: [data.coreIA, data.capexPiloto, data.equipoTotal, data.saasStack, data.ragDNA, data.reserva],
                        backgroundColor: ['#0d9488', '#0f766e', '#115e59', '#f59e0b', '#8b5cf6', '#f97316'],
                        borderColor: '#f8f7f4',
                        borderWidth: 4
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, cutout: '60%', plugins: { legend: { position: 'bottom' }, tooltip: { callbacks: { label: (c) => `${c.label}: ${formatCurrency(c.parsed)}` } } } }
            });
        }
        
        function renderROIChart() {
            const ctx = document.getElementById('roiComparisonChart')?.getContext('2d');
            if (!ctx) return;

            const roiData = {
                tradicional: [3580000, 7339000, 11285950, 15430248, 19781760],
                iaNativo: [3140000, 3994700, 4892135, 5834442, 6823864],
                ahorros: [440000, 3344300, 6393815, 9595806, 12957896]
            };

            const labels = Array.from({length: 5}, (_, i) => `A√±o ${i + 1}`);
            const roiChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        { label: 'Costo Tradicional', data: roiData.tradicional, borderColor: '#ef4444', fill: false, tension: 0.3 },
                        { label: 'Costo IA-Nativo', data: roiData.iaNativo, borderColor: '#10b981', fill: false, tension: 0.3 }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { tooltip: { callbacks: { label: (c) => `${c.dataset.label}: ${formatCurrency(c.parsed.y)}` } } },
                    scales: { y: { beginAtZero: true, title: { display: true, text: 'Costo Acumulado (MXN)' } } }
                }
            });

            const roiSlider = document.getElementById('roi-years');
            const updateMetrics = (year) => {
                const investment = 2265000; // Core IA
                const savings = roiData.ahorros[year-1];
                const roi = ((savings / investment) * 100).toFixed(0);
                const paybackMonths = 20;
                const paybackYears = (paybackMonths / 12).toFixed(1);
                
                document.getElementById('roi-percentage').textContent = `${roi}%`;
                document.getElementById('payback-period').textContent = `${paybackYears} a√±os (${paybackMonths} meses)`;
                document.getElementById('savings-total').textContent = formatCurrency(savings);
                renderRoiBreakdownTable(year);
            };

            roiSlider.addEventListener('input', (e) => {
                const years = parseInt(e.target.value);
                document.getElementById('years-label').textContent = years;
                roiChart.data.labels = labels.slice(0, years);
                roiChart.data.datasets[0].data = roiData.tradicional.slice(0, years);
                roiChart.data.datasets[1].data = roiData.iaNativo.slice(0, years);
                roiChart.update();
                updateMetrics(years);
            });
            updateMetrics(5); // Initial render
        }

        function renderRoiBreakdownTable(year) {
            const body = document.getElementById('roi-breakdown-body');
            if (!body) return;

            const tradicionalCosts = {
                personal: 3760000 / 5 * year,
                scoringManual: 1800000 / 5 * year,
                mantenimientoReactivo: 2200000 / 5 * year
            };
            const iaNativoCosts = {
                personal: 1490000 / 5 * year,
                scoringManual: (2265000 + 631000) / 5, // Simplified annual cost of tech
                mantenimientoReactivo: 950000 / 5 * year
            };

            const data = [
                { component: 'Costo de Personal', trad: tradicionalCosts.personal, ia: iaNativoCosts.personal },
                { component: 'Scoring y Operaciones', trad: tradicionalCosts.scoringManual, ia: iaNativoCosts.scoringManual },
                { component: 'Mantenimiento', trad: tradicionalCosts.mantenimientoReactivo, ia: iaNativoCosts.mantenimientoReactivo }
            ];

            body.innerHTML = data.map(row => `
                <tr class="text-sm">
                    <td class="px-4 py-3 font-medium text-gray-900">${row.component}</td>
                    <td class="px-4 py-3 text-center text-red-600">${formatCurrency(row.trad)}</td>
                    <td class="px-4 py-3 text-center text-green-600">${formatCurrency(row.ia)}</td>
                    <td class="px-4 py-3 text-center font-semibold text-teal-700">${formatCurrency(row.trad - row.ia)}</td>
                </tr>
            `).join('');
        }

        function renderDiferenciadores() {
            const container = document.getElementById('diferenciadores-container');
            if (!container) return;
            container.innerHTML = Object.values(diferenciadores).map(d => `
                <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                    <h4 class="font-bold text-teal-800 mb-2">${d.titulo}</h4>
                    <p class="text-sm text-slate-600 mb-2">${d.descripcion}</p>
                    <p class="text-xs font-semibold text-slate-500">Ventaja: <span class="font-normal text-slate-700">${d.ventaja}</span></p>
                </div>
            `).join('');
        }

        // 2. Financiero
        function renderFinancials() {
            const ctx = document.getElementById('financialPlanChart')?.getContext('2d');
            if (!ctx) return;
            
            const labels = Array.from({ length: 12 }, (_, i) => `Mes ${i + 1}`);
            const datasets = [
                { label: 'Equipo', data: flujosEfectivoReales.gastoEquipo, backgroundColor: '#14b8a6', stack: 'gastos' },
                { label: 'Desarrollo', data: flujosEfectivoReales.gastoDesarrollo, backgroundColor: '#0d9488', stack: 'gastos' },
                { label: 'CAPEX', data: flujosEfectivoReales.gastoCapex, backgroundColor: '#0f766e', stack: 'gastos' },
                { label: 'Pagos/SaaS', data: flujosEfectivoReales.stackInclusivo, backgroundColor: '#f59e0b', stack: 'gastos' },
                { label: 'Compliance', data: flujosEfectivoReales.compliance, backgroundColor: '#f97316', stack: 'gastos' },
            ];

            let gastoAcumulado = 0;
            const efectivoRestante = flujosEfectivoReales.gastoEquipo.map((_, i) => {
                const gastoMes = datasets.reduce((sum, ds) => sum + ds.data[i], 0);
                gastoAcumulado += gastoMes;
                return flujosEfectivoReales.inversionInicial - gastoAcumulado;
            });

            datasets.push({
                label: 'Efectivo Restante',
                data: efectivoRestante,
                type: 'line',
                borderColor: '#c2410c',
                backgroundColor: 'rgba(249, 115, 22, 0.1)',
                fill: true,
                yAxisID: 'y1',
                tension: 0.3
            });

            const financialChart = new Chart(ctx, {
                type: 'bar',
                data: { labels, datasets },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { tooltip: { callbacks: { label: (c) => `${c.dataset.label}: ${formatCurrency(c.parsed.y)}` } }, legend: { position: 'bottom' } },
                    scales: {
                        x: { stacked: true },
                        y: { stacked: true, beginAtZero: true, title: { display: true, text: 'Gasto Mensual (MXN)' } },
                        y1: { position: 'right', beginAtZero: true, title: { display: true, text: 'Efectivo Restante (MXN)' }, grid: { drawOnChartArea: false } }
                    }
                }
            });

            const monthSlider = document.getElementById('month-slider');
            const updateKPIs = (month) => {
                const index = month - 1;
                document.getElementById('month-label').textContent = month;
                const gastoMes = datasets.filter(ds => ds.stack === 'gastos').reduce((sum, ds) => sum + ds.data[index], 0);
                const gastoAcc = datasets.filter(ds => ds.stack === 'gastos').reduce((total, ds) => total + ds.data.slice(0, month).reduce((a, b) => a + b, 0), 0);
                document.getElementById('kpi-gasto-mes').textContent = formatCurrency(gastoMes);
                document.getElementById('kpi-gasto-acumulado').textContent = formatCurrency(gastoAcc);
                document.getElementById('kpi-efectivo').textContent = formatCurrency(efectivoRestante[index]);
                document.getElementById('kpi-reserva').textContent = formatCurrency(presupuestoReal.distribucion.reserva);
            };
            monthSlider.addEventListener('input', (e) => updateKPIs(parseInt(e.target.value)));
            updateKPIs(1);
        }
        
        function renderFinancialBreakdown() {
            const container = document.getElementById('financial-breakdown-container');
            if (!container) return;
            container.innerHTML = `
                <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                    <h4 class="font-semibold text-slate-800 mb-2">Notas del Flujo de Caja:</h4>
                    <ul class="text-sm text-slate-600 list-disc list-inside space-y-1">
                        <li><strong>Stack Inclusivo:</strong> Escala de $10k a $35k en el Mes 4 con la activaci√≥n de APIs.</li>
                        <li><strong>Compliance:</strong> Pico de $15k en Mes 4 por setups iniciales, luego se estabiliza.</li>
                        <li><strong>CAPEX:</strong> Concentrado 100% en los Meses 6-8 para el despliegue de las 3 vagonetas piloto.</li>
                        <li><strong>Reserva:</strong> Los $49k se mantienen intactos como red de seguridad.</li>
                    </ul>
                </div>
            `;
        }

        // 3. Tecnolog√≠a
        function renderAgentes() {
            const container = document.getElementById('agentes-container');
            if (!container) return;
            container.innerHTML = Object.entries(agentesDetalleCompleto).map(([key, agent]) => {
                const breakdownTooltip = Object.entries(agent.breakdown).map(([k, v]) => `${k.charAt(0).toUpperCase() + k.slice(1)}: ${formatCurrency(v)}`).join(' | ');
                return `
                <div class="agent-card bg-white p-6 rounded-lg shadow-md border-l-4 border-teal-600 cursor-pointer" data-agent-key="${key}" data-ref="${key}-development" data-tooltip="${breakdownTooltip}">
                    <h3 class="font-bold text-lg text-slate-800">${key.toUpperCase()}</h3>
                    <p class="text-sm text-slate-600 mb-3">${agent.proposito || agent.diferenciadorUnico || ''}</p>
                    <p class="text-2xl font-bold text-teal-600">${formatCurrency(agent.presupuesto)}</p>
                    <p class="text-xs text-slate-500">${formatNumber(agent.horas)} horas desarrollo</p>
                    <div class="mt-3 text-xs text-slate-400">Click para detalles t√©cnicos ‚Üí</div>
                </div>
            `}).join('');
        }

        function renderArquitecturaDatos() {
            const container = document.getElementById('arquitectura-datos-container');
            if (!container) return;
            container.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div>
                        <h4 class="font-semibold text-slate-800 mb-3">Fuentes de Datos y Endpoints</h4>
                        <div class="space-y-2 text-sm">
                            ${Object.entries(arquitecturaDatos.fuentes).map(([key, val]) => `
                                <div class="p-2 bg-slate-50 rounded">
                                    <div class="font-semibold">${key} <span class="text-xs font-normal text-slate-500">(${val.frecuencia})</span></div>
                                    <div class="text-xs text-teal-700 font-mono">${val.endpoint}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold text-slate-800 mb-3">Almacenamiento (Storage)</h4>
                        <div class="space-y-2 text-sm">
                            ${Object.entries(arquitecturaDatos.storage).map(([key, val]) => `
                                <div class="p-2 bg-slate-50 rounded"><strong>${key}:</strong> ${val}</div>
                            `).join('')}
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold text-slate-800 mb-3">ETL Pipeline</h4>
                        <div class="p-3 bg-slate-50 rounded">
                            <p><strong>Herramienta:</strong> ${arquitecturaDatos.etl.herramienta}</p>
                            <p><strong>Pipeline:</strong> ${arquitecturaDatos.etl.pipeline}</p>
                            <p><strong>Latencia Cr√≠tica:</strong> ${arquitecturaDatos.etl.latencia}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // 4. Ejecuci√≥n
        function renderWeeklyTimeline() {
            const container = document.getElementById('weekly-timeline-container');
            if (!container) return;

            const tabs = Object.keys(cronogramaSemanalCompleto).map((mesKey, index) => `
                <button class="tab-button px-4 py-2 text-sm font-medium rounded-md ${index === 0 ? 'active' : ''}" data-tab="${mesKey}">
                    ${mesKey.replace('mes', 'Mes ')}
                </button>
            `).join('');

            const content = Object.entries(cronogramaSemanalCompleto).map(([mesKey, mesData], index) => `
                <div class="tab-content mt-4 ${index === 0 ? 'active' : ''}" id="${mesKey}">
                    <h4 class="text-lg font-bold mb-4">${mesData.titulo}</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        ${Object.entries(mesData).filter(([key]) => key.startsWith('sem')).map(([semKey, semData]) => `
                            <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                                <h5 class="font-bold text-slate-800">Semana ${semKey.replace('sem', '')}</h5>
                                <ul class="text-xs text-slate-600 mt-2 space-y-1 list-disc list-inside">
                                    ${semData.tasks.map(t => `<li>${t}</li>`).join('')}
                                </ul>
                                <p class="text-xs font-semibold text-teal-700 mt-3">Owner(s): ${semData.owners.join(', ')}</p>
                                <div class="mt-3 pt-3 border-t">
                                    <p class="text-xs font-bold text-orange-600">Milestone: <span class="font-normal text-slate-700">${semData.milestone}</span></p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');

            container.innerHTML = `<div class="flex flex-wrap gap-2">${tabs}</div>${content}`;
            
            container.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => {
                    container.querySelector('.tab-button.active').classList.remove('active');
                    button.classList.add('active');
                    container.querySelector('.tab-content.active').classList.remove('active');
                    container.querySelector(`#${button.dataset.tab}`).classList.add('active');
                });
            });
        }
        
        function renderKpisCorrelacionados() {
            const container = document.getElementById('kpis-correlacionados-container');
            if(!container) return;
            container.innerHTML = Object.entries(kpisConCorrelacion).map(([mes, data]) => `
                <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                    <h4 class="font-bold text-lg text-slate-800 mb-3">Hitos del ${mes.replace('mes', 'Mes ')}</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                        <div>
                            <h5 class="font-semibold text-teal-700 mb-2">KPIs T√©cnicos</h5>
                            <ul class="list-disc list-inside space-y-1">${data.tecnicos.map(k => `<li>${k}</li>`).join('')}</ul>
                        </div>
                        <div>
                            <h5 class="font-semibold text-orange-700 mb-2">KPIs de Negocio</h5>
                            <ul class="list-disc list-inside space-y-1">${data.business.map(k => `<li>${k}</li>`).join('')}</ul>
                        </div>
                        <div>
                            <h5 class="font-semibold text-indigo-700 mb-2">KPIs Financieros</h5>
                            <ul class="list-disc list-inside space-y-1">${data.financial.map(k => `<li>${k}</li>`).join('')}</ul>
                        </div>
                    </div>
                    <div class="mt-3 pt-3 border-t">
                        <p class="text-sm font-semibold text-slate-700">Correlaci√≥n: <span class="font-normal">${data.correlacion}</span></p>
                    </div>
                </div>
            `).join('');
        }

        function renderCompliance() {
            const container = document.getElementById('compliance-container');
            if(!container) return;
            container.innerHTML = Object.entries(complianceTimeline).map(([key, data]) => `
                <div class="p-4 rounded-lg border ${data.criticidad === 'ALTA' ? 'bg-red-50 border-red-200' : 'bg-amber-50 border-amber-200'}">
                    <h4 class="font-bold text-lg text-slate-800 uppercase">${key}</h4>
                    <p class="text-sm font-semibold text-slate-600">${data.periodo}</p>
                    <ul class="text-xs text-slate-700 mt-2 space-y-1 list-disc list-inside">
                        ${data.proceso.map(p => `<li>${p}</li>`).join('')}
                    </ul>
                    <div class="mt-3 pt-3 border-t">
                        <p class="text-xs font-bold ${data.criticidad === 'ALTA' ? 'text-red-700' : 'text-amber-700'}">Criticidad: ${data.criticidad}</p>
                    </div>
                </div>
            `).join('');
        }

        // 5. Equipo
        function renderTeamTable() {
            const table = document.getElementById('hr-table');
            const filter = document.getElementById('role-filter');
            if (!table || !filter) return;

            const thead = table.querySelector('thead');
            const tbody = table.querySelector('tbody');
            
            thead.innerHTML = `<tr>
                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rol</th>
                ${Array.from({length: 12}, (_, i) => `<th class="px-2 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">M${i+1}</th>`).join('')}
            </tr>`;

            tbody.innerHTML = '';
            filter.innerHTML = '<option value="all">Todos los Roles</option>';
            equipoMatrizCompleta.roles.forEach(role => {
                const option = document.createElement('option');
                option.value = role.name;
                option.textContent = role.name;
                filter.appendChild(option);

                const tr = document.createElement('tr');
                tr.dataset.role = role.name;
                tr.className = role.type === 'ESOP' ? 'bg-amber-50' : '';
                tr.innerHTML = `
                    <td class="px-3 py-2 whitespace-nowrap text-sm font-medium text-gray-900">
                        <div class="flex items-center">
                            ${role.type === 'ESOP' ? '<span class="text-amber-500 mr-2">‚òÖ</span>' : ''}
                            ${role.name}
                        </div>
                        <div class="text-xs text-slate-500">${role.focus}</div>
                    </td>
                    ${role.allocations.map(task => `<td class="px-2 py-2 text-center text-xs text-gray-600">${task}</td>`).join('')}
                `;
                tbody.appendChild(tr);
            });

            filter.addEventListener('change', () => {
                const selectedRole = filter.value;
                tbody.querySelectorAll('tr').forEach(tr => {
                    tr.style.display = (selectedRole === 'all' || tr.dataset.role === selectedRole) ? '' : 'none';
                });
            });

            // AGREGAR al final de renderTeamTable() antes del cierre de funci√≥n:
            // Render ESOP Profiles
            const profilesContainer = document.createElement('div');
            profilesContainer.className = 'mt-12';
            profilesContainer.innerHTML = `
              <div class="bg-gradient-to-r from-amber-50 to-orange-50 p-8 rounded-lg border border-amber-200">
                <div class="flex items-center mb-6">
                  <span class="text-3xl mr-3">‚≠ê</span>
                  <h3 class="font-bold text-2xl text-amber-800">Perfiles del N√∫cleo ESOP</h3>
                </div>
                <p class="text-amber-700 mb-6 text-sm">
                  El equipo de liderazgo t√©cnico con equity significativo y compromiso de largo plazo. 
                  <strong>10% equity pool</strong> con potencial de <strong>~$15MM MXN</strong> en Serie A exitosa.
                </p>
                
                <div class="grid md:grid-cols-3 gap-6">
                  ${Object.entries(equipoESOPProfiles).map(([role, profile]) => `
                    <div class="bg-white p-6 rounded-lg border-l-4 border-${profile.color}-500 shadow-md hover:shadow-lg transition-shadow">
                      <div class="flex items-center mb-4">
                        <span class="text-3xl mr-3">${profile.icon}</span>
                        <div>
                          <h4 class="font-bold text-slate-800 text-lg">‚òÖ ${role}</h4>
                          <div class="text-xs text-${profile.color}-600 font-semibold">ESOP Core Member</div>
                        </div>
                      </div>
                      
                      <div class="space-y-3">
                        <div>
                          <h5 class="font-semibold text-slate-700 text-sm mb-1">Perfil:</h5>
                          <p class="text-xs text-slate-600 leading-relaxed">${profile.bio}</p>
                        </div>
                        
                        <div>
                          <h5 class="font-semibold text-slate-700 text-sm mb-1">Expertise:</h5>
                          <p class="text-xs text-slate-600">${profile.expertise}</p>
                        </div>
                        
                        <div>
                          <h5 class="font-semibold text-slate-700 text-sm mb-1">Diferenciador:</h5>
                          <p class="text-xs text-${profile.color}-700 font-medium">${profile.diferenciador}</p>
                        </div>
                        
                        <div class="pt-2 border-t border-gray-200">
                          <div class="flex justify-between items-center text-xs">
                            <span class="text-slate-500">Equity Tier:</span>
                            <span class="font-bold text-amber-600">ESOP Fundador</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  `).join('')}
                </div>
                
                <div class="mt-6 p-4 bg-amber-100 rounded-lg border border-amber-300">
                  <h4 class="font-bold text-amber-800 mb-2">üéØ Alineaci√≥n de Incentivos</h4>
                  <div class="grid md:grid-cols-2 gap-4 text-sm text-amber-700">
                    <div>
                      <strong>Modelo Hybrid:</strong> Salario competitivo + equity significativo = "golden handcuffs"
                    </div>
                    <div>
                      <strong>Upside Potencial:</strong> ~$15MM MXN valor colectivo en Serie A exitosa
                    </div>
                  </div>
                </div>
              </div>
            `;

            // Insert after existing team table
            const teamSection = document.getElementById('equipo');
            const teamGrid = teamSection.querySelector('.grid');
            if (teamGrid && teamGrid.parentElement) {
                teamGrid.parentElement.appendChild(profilesContainer);
            }
        }
        
        // 6. Progreso
        function renderProgressTrackers() {
            const techContainer = document.getElementById('tech-progress-bars');
            const businessContainer = document.getElementById('business-progress-bars');
            const burnCtx = document.getElementById('burn-rate-chart')?.getContext('2d');
            if (!techContainer || !businessContainer || !burnCtx) return;

            // Simple progress simulation (replace with real data later)
            const techProgress = { 'HASE': 100, 'PIA': 80, 'Super-PMA': 60, 'Asistente': 50 };
            const businessProgress = { 'Piloto': 75, 'Legal': 100, 'Serie A Prep': 25 };

            techContainer.innerHTML = Object.entries(techProgress).map(([key, value]) => `
                <div>
                    <div class="flex justify-between mb-1"><span class="text-sm font-medium">${key}</span><span class="text-sm font-medium">${value}%</span></div>
                    <div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-teal-600 h-2.5 rounded-full" style="width: ${value}%"></div></div>
                </div>
            `).join('');

            businessContainer.innerHTML = Object.entries(businessProgress).map(([key, value]) => `
                <div>
                    <div class="flex justify-between mb-1"><span class="text-sm font-medium">${key}</span><span class="text-sm font-medium">${value}%</span></div>
                    <div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-orange-500 h-2.5 rounded-full" style="width: ${value}%"></div></div>
                </div>
            `).join('');

            const plannedBurn = flujosEfectivoReales.gastoEquipo.map((e, i) => e + flujosEfectivoReales.gastoDesarrollo[i] + flujosEfectivoReales.stackInclusivo[i] + flujosEfectivoReales.compliance[i] + flujosEfectivoReales.gastoCapex[i]);
            // Simulate actual burn for demo
            const actualBurn = plannedBurn.map((p, i) => i < 6 ? p * (1 - Math.random() * 0.1) : 0).filter(b => b > 0);
            
            new Chart(burnCtx, {
                type: 'line',
                data: {
                    labels: Array.from({length: actualBurn.length}, (_, i) => `Mes ${i+1}`),
                    datasets: [
                        { label: 'Burn Rate Planeado', data: plannedBurn, borderColor: '#a1a1aa', borderDash: [5, 5], fill: false },
                        { label: 'Burn Rate Real', data: actualBurn, borderColor: '#ef4444', fill: false }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
            });
        }

        // --- MODAL LOGIC ---
        function setupModal() {
            const agentModal = document.getElementById('agent-modal');
            const closeAgentModalBtn = document.getElementById('close-modal');
            const capexModal = document.getElementById('capex-modal');
            const closeCapexModalBtn = document.getElementById('close-capex-modal');

            document.body.addEventListener('click', (e) => {
                const card = e.target.closest('.agent-card');
                if (card) {
                    const agentKey = card.dataset.agentKey;
                    const agentData = agentesDetalleCompleto[agentKey];
                    if (agentData) {
                        document.getElementById('modal-title').textContent = `${agentKey.toUpperCase()} - Blueprint T√©cnico`;
                        document.getElementById('modal-content').innerHTML = createAgentModalContent(agentData);
                        agentModal.style.display = 'flex';
                    }
                }
            });

            const closeAgentModal = () => agentModal.style.display = 'none';
            closeAgentModalBtn.addEventListener('click', closeAgentModal);
            agentModal.addEventListener('click', (e) => {
                if (e.target === agentModal) closeAgentModal();
            });

            const closeCapexModal = () => capexModal.style.display = 'none';
            if(closeCapexModalBtn) closeCapexModalBtn.addEventListener('click', closeCapexModal);
            if(capexModal) capexModal.addEventListener('click', (e) => {
                if (e.target === capexModal) closeCapexModal();
            });
        }

        function createAgentModalContent(agent) {
            return `
                <div class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                        <div class="bg-slate-50 p-3 rounded-lg"><p class="text-sm text-slate-500">Presupuesto</p><p class="text-xl font-bold">${formatCurrency(agent.presupuesto)}</p></div>
                        <div class="bg-slate-50 p-3 rounded-lg"><p class="text-sm text-slate-500">Horas</p><p class="text-xl font-bold">${formatNumber(agent.horas)}</p></div>
                        <div class="bg-slate-50 p-3 rounded-lg"><p class="text-sm text-slate-500">Diferenciador</p><p class="text-sm font-semibold">${agent.diferenciadorUnico || agent.proposito}</p></div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-slate-50 p-4 rounded-lg">
                            <h4 class="font-semibold mb-2">Arquitectura y Stack</h4>
                            <div class="flex flex-wrap gap-2">${(agent.arquitectura || []).map(t => `<span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">${t}</span>`).join('')}</div>
                        </div>
                        <div class="bg-slate-50 p-4 rounded-lg">
                            <h4 class="font-semibold mb-2">Endpoints API Clave</h4>
                            <div class="font-mono text-xs space-y-1">${(agent.apis || []).map(a => `<div>${a}</div>`).join('')}</div>
                        </div>
                        <div class="bg-slate-50 p-4 rounded-lg">
                            <h4 class="font-semibold mb-2">KPIs T√©cnicos</h4>
                            <ul class="text-sm list-disc list-inside">${(agent.kpisTecnicos || []).map(k => `<li>${k}</li>`).join('')}</ul>
                        </div>
                        <div class="bg-slate-50 p-4 rounded-lg">
                            <h4 class="font-semibold mb-2">SLAs Operacionales</h4>
                            <div class="text-sm">${Object.entries(agent.sla || {}).map(([k,v]) => `<div><strong>${k}:</strong> ${v}</div>`).join('')}</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // AGREGAR: Perfiles ESOP Detallados
        const equipoESOPProfiles = {
          "Cient√≠fico de Datos": {
            bio: "Ingeniera en Sistemas con Master en IA, 4+ a√±os liderando equipos de datos en empresas tech, especialista en infraestructura cloud y analytics avanzados",
            expertise: "Data Engineering, ETL pipelines, Azure/AWS, forecasting, team leadership, RPA automation",
            achievements: "L√≠der t√©cnica en RPA y analytics para empresas Fortune 500, experiencia en computer vision industrial",
            diferenciador: "Experiencia end-to-end: desde infraestructura hasta insights de negocio",
            icon: "üß†",
            color: "blue"
          },
          "Ingeniero ML": {
            bio: "Ingeniera en Sistemas y Rob√≥tica con Master en IA en curso, 4+ a√±os en RPA y desarrollo full-stack, l√≠der t√©cnica con experiencia en visi√≥n artificial",
            expertise: "Python, Pandas, Selenium, Angular, computer vision, team leadership, industrial automation",
            achievements: "Desarrollo de sistemas automatizados para Samsung, GM, Ford, especialista en Cognex/Matrox",
            diferenciador: "Combina ML/IA con ingenier√≠a de sistemas industriales",
            icon: "ü§ñ",
            color: "green"
          },
          "Full-Stack IA": {
            bio: "Ingeniero en Ciencias Computacionales con 4+ a√±os en desarrollo backend/full-stack, certificado Scrum Master, experiencia en startups tech",
            expertise: "Backend APIs, web development, C++, Agile methodologies, system architecture, startup scaling",
            achievements: "Co-founder de startup tech, experiencia en Zebrands, Scrum Master certificado",
            diferenciador: "Arquitectura de sistemas escalables con metodolog√≠as √°giles",
            icon: "‚ö°",
            color: "purple"
          }
        };

        // AGREGAR: Sistema de Navegaci√≥n por Audiencia
        class AudienceController {
          constructor() {
            this.currentRole = 'general';
            this.roles = {
              investor: {
                name: 'Inversionista üîç',
                focus: ['roi', 'team', 'traction', 'financials'],
                sections: ['tesis', 'financiero', 'equipo', 'progreso'],
                highlightElements: ['.kpi-card', '#roi-percentage', '#hr-table', '.progress-bars']
              },
              cto: {
                name: 'CTO üíª',
                focus: ['tech-stack', 'apis', 'roadmap', 'architecture'],
                sections: ['tecnologia', 'ejecucion'],
                highlightElements: ['.agent-card', '#arquitectura-datos-container', '.timeline-item']
              },
              coo: {
                name: 'COO üìä',
                focus: ['timeline', 'dependencies', 'milestones', 'operations'],
                sections: ['ejecucion', 'equipo'],
                highlightElements: ['#weekly-timeline-container', '#compliance-container', '#hr-table']
              },
              cfo: {
                name: 'CFO üí∞',
                focus: ['burn-rate', 'cash-flow', 'unit-economics', 'roi'],
                sections: ['financiero', 'progreso'],
                highlightElements: ['#financialPlanChart', '#roi-breakdown-body', '#burn-rate-chart']
              }
            };
          }

          switchRole(role) {
            this.currentRole = role;
            document.body.className = `role-${role}`;
            
            // Update navigation highlights
            this.updateNavigation(role);
            
            // Add contextual hints
            this.addContextualHints(role);
            
            // Highlight relevant elements
            this.highlightRoleElements(role);
          }

          updateNavigation(role) {
            const navLinks = document.querySelectorAll('.nav-link');
            const roleConfig = this.roles[role];
            
            navLinks.forEach(link => {
              const href = link.getAttribute('href').replace('#', '');
              if (roleConfig && roleConfig.sections.includes(href)) {
                link.classList.add('role-highlight');
                link.style.borderBottomColor = '#c2410c';
                link.style.fontWeight = 'bold';
              } else {
                link.classList.remove('role-highlight');
                link.style.borderBottomColor = 'transparent';
                link.style.fontWeight = 'normal';
              }
            });
          }

          highlightRoleElements(role) {
            // Remove previous highlights
            document.querySelectorAll('.role-highlight-element').forEach(el => {
              el.classList.remove('role-highlight-element');
            });
            
            if (role === 'general') return;
            
            const roleConfig = this.roles[role];
            roleConfig.highlightElements.forEach(selector => {
              document.querySelectorAll(selector).forEach(element => {
                element.classList.add('role-highlight-element');
              });
            });
          }

          addContextualHints(role) {
            // Remove existing hints
            document.querySelectorAll('.role-hint').forEach(hint => hint.remove());
            
            if (role === 'general') return;
            
            const roleConfig = this.roles[role];
            const hint = document.createElement('div');
            hint.className = 'role-hint fixed top-20 right-4 bg-orange-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
            hint.innerHTML = `
              <div class="text-sm font-medium">${roleConfig.name} Focus:</div>
              <div class="text-xs">${roleConfig.focus.join(', ')}</div>
            `;
            document.body.appendChild(hint);
            
            // Auto-hide after 5 seconds
            setTimeout(() => hint.remove(), 5000);
          }
        }

        // AGREGAR: Phase Controller System
        class PhaseController {
          constructor() {
            this.phases = {
              foundation: { name: 'Fundaci√≥n', months: [1,2,3], color: 'blue' },
              development: { name: 'Desarrollo', months: [4,5,6], color: 'green' },
              validation: { name: 'Validaci√≥n', months: [7,8,9], color: 'purple' },
              traction: { name: 'Tracci√≥n', months: [10,11,12], color: 'orange' }
            };
            this.currentPhase = 'all';
            this.addDataAttributes();
          }

          addDataAttributes() {
            // Add data-month attributes to existing timeline items
            document.querySelectorAll('.tab-content').forEach((content, monthIndex) => {
              content.setAttribute('data-month', monthIndex + 1);
            });
            
            // Add data-phase attributes based on month
            Object.entries(this.phases).forEach(([phaseKey, phase]) => {
              phase.months.forEach(month => {
                const monthElements = document.querySelectorAll(`[data-month="${month}"]`);
                monthElements.forEach(el => {
                  el.setAttribute('data-phase', phaseKey);
                });
              });
            });
          }

          filterByPhase(phase) {
            this.currentPhase = phase;
            
            // Update active button
            document.querySelectorAll('.phase-btn').forEach(btn => {
              btn.classList.toggle('active', btn.dataset.phase === phase);
            });

            // Filter timeline content
            this.filterTimelineContent(phase);
            
            // Update phase summary
            this.updatePhaseSummary(phase);
          }

          filterTimelineContent(phase) {
            const allItems = document.querySelectorAll('[data-phase]');
            
            allItems.forEach(item => {
              if (phase === 'all') {
                item.style.display = '';
                item.style.opacity = '1';
              } else {
                const itemPhase = item.getAttribute('data-phase');
                if (itemPhase === phase) {
                  item.style.display = '';
                  item.style.opacity = '1';
                  item.classList.add('phase-highlighted');
                } else {
                  item.style.opacity = '0.3';
                  item.classList.remove('phase-highlighted');
                }
              }
            });
          }

          updatePhaseSummary(phase) {
            let existingSummary = document.getElementById('phase-summary');
            if (existingSummary) existingSummary.remove();
            
            if (phase === 'all') return;
            
            const phaseConfig = this.phases[phase];
            const summary = document.createElement('div');
            summary.id = 'phase-summary';
            summary.className = `mt-6 p-4 bg-${phaseConfig.color}-50 border-l-4 border-${phaseConfig.color}-500 rounded-lg`;
            summary.innerHTML = `
              <h4 class="font-bold text-${phaseConfig.color}-800 mb-2">Fase ${phaseConfig.name} - Resumen</h4>
              <div class="grid md:grid-cols-3 gap-4 text-sm">
                <div>
                  <strong class="text-${phaseConfig.color}-700">Periodo:</strong> 
                  Meses ${phaseConfig.months.join(', ')}
                </div>
                <div>
                  <strong class="text-${phaseConfig.color}-700">Objetivo Principal:</strong> 
                  ${this.getPhaseObjective(phase)}
                </div>
                <div>
                  <strong class="text-${phaseConfig.color}-700">Entregables Clave:</strong> 
                  ${this.getPhaseDeliverables(phase)}
                </div>
              </div>
            `;
            
            const activeBtn = document.querySelector('.phase-btn.active');
            if (activeBtn) {
              activeBtn.parentElement.insertAdjacentElement('afterend', summary);
            }
          }

          getPhaseObjective(phase) {
            const objectives = {
              foundation: 'Establecer infraestructura t√©cnica y operativa',
              development: 'Desarrollar MVP tecnol√≥gico y lanzar piloto',
              validation: 'Validar modelo de negocio con flota piloto',
              traction: 'Demostrar tracci√≥n y preparar Serie A'
            };
            return objectives[phase];
          }

          getPhaseDeliverables(phase) {
            const deliverables = {
              foundation: 'Equipo completo, RAG-DNA, infraestructura base',
              development: 'HASE >90% AUC, PIA funcional, 1ra vagoneta',
              validation: '3 vagonetas operando, ingresos marketplace, NPS >50',
              traction: 'Data room completo, NPS >70, term sheet preparado'
            };
            return deliverables[phase];
          }
        }

        // üöÄ CALCULADORA SERIE A "AT A GLANCE" - POST SEED / SERIE A (MOBILITY TECH REAL)
class ScenarioCalculator {
  constructor() {
    // ESCENARIOS REALISTAS PARA MOBILITY TECH
    this.scenarios = {
      conservative: { 
        growth: 1.25,             // 25% crecimiento anual (conservador mobility)
        margin: 0.28,             // 28% margen EBITDA (realista)
        morosidad: 0.08,          // 8% morosidad
        fleetMultiplier: 0.8, 
        description: "Crecimiento Controlado", 
        marketCondition: "Adopci√≥n gradual, competencia moderada" 
      },
      base: { 
        growth: 1.45,             // 45% crecimiento anual (plan base)
        margin: 0.32,             // 32% margen EBITDA (con IA efficiency)
        morosidad: 0.06,          // 6% morosidad (mejor con IA)
        fleetMultiplier: 1.0, 
        description: "Plan Ejecutable",
        marketCondition: "Crecimiento sostenido con IA automation"
      },
      optimistic: { 
        growth: 1.65,             // 65% crecimiento anual (agresivo pero factible)
        margin: 0.38,             // 38% margen EBITDA (IA l√≠der)
        morosidad: 0.04,          // 4% morosidad (best-in-class)
        fleetMultiplier: 1.25, 
        description: "Expansi√≥n Acelerada",
        marketCondition: "L√≠der dominante con expansi√≥n geogr√°fica"
      }
    };

    // DATOS ALINEADOS AL MODELO FINANCIERO REAL
    this.modelData = { 
      // Unit Economics REALES del modelo
      packagePrice: 985820,            // Precio financiado por unidad
      packageCost: 706000,             // CAPEX real por unidad
      unitMarginMXN: 279820,           // Margen por unidad
      monthlyRevenuePerUnit: 8733,     // $8.7K/mes por unidad REAL
      annualRevenuePerUnit: 104796,    // $104.8K/a√±o por unidad
      
      // Financiamiento REALISTA (no over-leveraged)
      seedCompleted: 7600000,          // $7.6M SEED completed
      seriesABase: 45000000,           // $45M Serie A base
      seriesAExtension: 75000000,      // $75M Serie A extended
      
      // LEVERAGE CONSERVADOR para mobility tech
      leverageRatio: 2.0,              // 2x debt/equity (conservador mobility)
      ventureDebtRate: 0.18,           // 18% venture debt (realista)
      commercialDebtRate: 0.14,        // 14% commercial debt
      
      // Par√°metros operacionales
      seedUnitsDeployed: 3,            // Unidades ya desplegadas
      operationalEfficiency: 0.88,     // 88% eficiencia (realista)
      marketPenetration: 0.75,         // 75% penetraci√≥n de mercado
      
      // M√∫ltiplos MOBILITY TECH (no SaaS)
      targetEquityIRR: 35,             // 35% TIR target (mobility realistic)
      industryMultiple: 8.5,           // 8.5x EBITDA (mobility premium)
      timeToExitYears: 5,              // 5 a√±os proyecci√≥n
      
      // Cash positive threshold REALISTA
      cashPositiveThreshold: 15000000, // $15M EBITDA = cash positive
      fixedCostsAnnual: 25000000       // $25M costos fijos anuales
    };

    this.init();
  }

  init() { 
    this.createChart(); 
    this.updateCalculation(); 
  }

  createChart() {
    const ctx = document.getElementById('scenario-chart')?.getContext('2d');
    if (!ctx) return;

    this.chart = new Chart(ctx, {
      type: 'line',
      data: { 
        labels: [], 
        datasets: [
          { 
            label: 'Equity TIR %', 
            data: [], 
            borderColor: '#dc2626', 
            backgroundColor: 'rgba(220, 38, 38, 0.1)', 
            fill: true, 
            tension: 0.4, 
            pointRadius: 6, 
            pointHoverRadius: 10,
            borderWidth: 3
          }, 
          { 
            label: 'EBITDA (M MXN)', 
            data: [], 
            borderColor: '#059669', 
            backgroundColor: 'rgba(5, 150, 105, 0.1)', 
            yAxisID: 'y1', 
            fill: false, 
            tension: 0.4, 
            pointRadius: 6, 
            pointHoverRadius: 10,
            borderWidth: 3
          }, 
          { 
            label: 'Valuation Exit (M MXN)', 
            data: [], 
            borderColor: '#7c3aed', 
            backgroundColor: 'rgba(124, 58, 237, 0.1)', 
            yAxisID: 'y2', 
            fill: false, 
            tension: 0.4, 
            pointRadius: 6, 
            pointHoverRadius: 10,
            borderWidth: 3
          }
        ] 
      },
      options: { 
        responsive: true, 
        maintainAspectRatio: false, 
        plugins: { 
          tooltip: { 
            backgroundColor: 'rgba(15, 23, 42, 0.95)', 
            titleColor: '#f8fafc', 
            bodyColor: '#e2e8f0',
            titleFont: { size: 14, weight: 'bold' },
            bodyFont: { size: 13 },
            callbacks: { 
              label: (context) => {
                if (context.datasetIndex === 0) return `üöÄ TIR Equity: ${context.parsed.y.toFixed(1)}%`;
                else if (context.datasetIndex === 1) return `üí∞ EBITDA: $${context.parsed.y.toFixed(1)}M MXN`;
                else return `üèÜ Valuaci√≥n: $${context.parsed.y.toFixed(0)}M MXN`;
              } 
            } 
          }, 
          legend: { 
            labels: { 
              color: '#94a3b8', 
              font: { size: 11, weight: 'bold' },
              usePointStyle: true
            } 
          } 
        }, 
        scales: { 
          x: { 
            ticks: { color: '#94a3b8', font: { weight: 'bold' } }, 
            title: { display: true, text: 'Unidades Desplegadas', color: '#94a3b8', font: { size: 14, weight: 'bold' } },
            grid: { color: 'rgba(148, 163, 184, 0.1)' }
          }, 
          y: { 
            beginAtZero: true,
            max: 70, // CAP TIR at 70% max
            title: { display: true, text: 'TIR Equity (%)', color: '#dc2626', font: { size: 14, weight: 'bold' } }, 
            ticks: { color: '#dc2626', font: { weight: 'bold' } }, 
            position: 'left',
            grid: { color: 'rgba(220, 38, 38, 0.1)' }
          }, 
          y1: { 
            beginAtZero: true, 
            title: { display: true, text: 'EBITDA (M MXN)', color: '#059669', font: { size: 14, weight: 'bold' } }, 
            ticks: { color: '#059669', font: { weight: 'bold' } }, 
            position: 'right', 
            grid: { drawOnChartArea: false } 
          }, 
          y2: { 
            beginAtZero: true, 
            title: { display: true, text: 'Valuaci√≥n (M MXN)', color: '#7c3aed', font: { size: 14, weight: 'bold' } }, 
            ticks: { color: '#7c3aed', font: { weight: 'bold' } }, 
            display: false 
          } 
        } 
      }
    });
  }

  calculateOptimalCapitalStructure(fleetSize, sinosureEnabled = false) {
    const totalCapexRequired = fleetSize * this.modelData.packageCost;
    const seedAlreadyDeployed = this.modelData.seedCompleted;
    const additionalCapexNeeded = Math.max(0, totalCapexRequired - seedAlreadyDeployed);

    // ESTRUCTURA DE CAPITAL CONSERVADORA PARA MOBILITY
    let equityNeeded, ventureDebt, commercialDebt;

    if (additionalCapexNeeded <= this.modelData.seriesABase) {
      // Serie A base covers it
      equityNeeded = additionalCapexNeeded;
      ventureDebt = 0;
      commercialDebt = 0;
    } else if (additionalCapexNeeded <= this.modelData.seriesABase + this.modelData.seriesAExtension) {
      // Use Serie A + some debt
      equityNeeded = this.modelData.seriesABase;
      const remaining = additionalCapexNeeded - equityNeeded;
      const debtCapacity = equityNeeded * this.modelData.leverageRatio; // 2x leverage max
      
      ventureDebt = Math.min(remaining * 0.7, debtCapacity * 0.6);
      commercialDebt = Math.min(remaining - ventureDebt, debtCapacity * 0.4);
      
      // If still short, need more equity
      if (ventureDebt + commercialDebt < remaining) {
        const shortfall = remaining - ventureDebt - commercialDebt;
        equityNeeded += shortfall;
      }
    } else {
      // Need Serie A extension
      equityNeeded = this.modelData.seriesABase + this.modelData.seriesAExtension;
      const remaining = additionalCapexNeeded - equityNeeded;
      const debtCapacity = equityNeeded * this.modelData.leverageRatio;
      
      ventureDebt = Math.min(remaining * 0.6, debtCapacity * 0.6);
      commercialDebt = Math.min(remaining - ventureDebt, debtCapacity * 0.4);
    }

    const totalFunding = seedAlreadyDeployed + equityNeeded + ventureDebt + commercialDebt;
    const totalEquity = seedAlreadyDeployed + equityNeeded;

    return { 
      totalCapexRequired, 
      seedAlreadyDeployed, 
      newEquityNeeded: equityNeeded, 
      ventureDebt, 
      commercialDebt, 
      totalFunding, 
      totalEquity,
      fundingGap: Math.max(0, totalCapexRequired - totalFunding), 
      equityPercentage: totalEquity / totalFunding, 
      debtPercentage: (ventureDebt + commercialDebt) / totalFunding 
    };
  }

  calculateEquityIRR(capitalStructure, ebitdaProjection, years) {
    const equityCashFlows = [-capitalStructure.totalEquity];

    for (let year = 1; year <= years; year++) {
      const ebitda = ebitdaProjection[year - 1];
      
      // Interest payments on debt
      let interestPayments = 0;
      if (capitalStructure.ventureDebt > 0) {
        interestPayments += capitalStructure.ventureDebt * this.modelData.ventureDebtRate;
      }
      if (capitalStructure.commercialDebt > 0) {
        interestPayments += capitalStructure.commercialDebt * this.modelData.commercialDebtRate;
      }

      const netCashFlow = Math.max(0, ebitda - interestPayments);

      if (year === years) { 
        // Exit year
        const exitValuation = ebitda * this.modelData.industryMultiple; 
        const debtRepayment = capitalStructure.ventureDebt + capitalStructure.commercialDebt; 
        const equityValue = Math.max(0, exitValuation - debtRepayment); 
        equityCashFlows.push(netCashFlow + equityValue); 
      } else { 
        equityCashFlows.push(netCashFlow); 
      }
    }

    return this.calculateIRR(equityCashFlows);
  }

  calculateIRR(cashFlows, maxIterations = 100, tolerance = 1e-6) {
    if (cashFlows.length < 2) return 0;

    let rate = 0.15; // Start with 15% for mobility tech

    for (let iteration = 0; iteration < maxIterations; iteration++) {
      let npv = 0; 
      let npvDerivative = 0;

      for (let i = 0; i < cashFlows.length; i++) { 
        const discountFactor = Math.pow(1 + rate, i); 
        npv += cashFlows[i] / discountFactor; 
        if (i > 0) npvDerivative -= (i * cashFlows[i]) / (Math.pow(1 + rate, i + 1)); 
      }

      if (Math.abs(npv) < tolerance) {
        return Math.max(0, Math.min(rate * 100, 65)); // Cap at 65% max
      }

      if (Math.abs(npvDerivative) < tolerance) break;

      rate = rate - npv / npvDerivative; 
      rate = Math.max(-0.99, Math.min(rate, 3)); // Cap rate
    }

    return Math.max(0, Math.min(rate * 100, 65));
  }

  calculate(scenario, years, investment, fleetSize) {
    const fixedYears = 5;
    const params = this.scenarios[scenario];
    const capitalStructure = this.calculateOptimalCapitalStructure(fleetSize);

    // PROYECCI√ìN EBITDA REALISTA
    const ebitdaProjection = [];
    
    for (let year = 1; year <= fixedYears; year++) { 
      // Fleet deployment curve: gradual ramp-up
      let operatingUnits;
      if (year === 1) operatingUnits = Math.round(fleetSize * 0.15); // 15% year 1
      else if (year === 2) operatingUnits = Math.round(fleetSize * 0.35); // 35% year 2
      else if (year === 3) operatingUnits = Math.round(fleetSize * 0.60); // 60% year 3
      else if (year === 4) operatingUnits = Math.round(fleetSize * 0.80); // 80% year 4
      else operatingUnits = fleetSize; // 100% year 5
      
      // Revenue calculation
      const baseRevenue = operatingUnits * this.modelData.annualRevenuePerUnit;
      const growthAdjustedRevenue = baseRevenue * Math.pow(params.growth, year - 1);
      const adjustedRevenue = growthAdjustedRevenue * this.modelData.marketPenetration;
      
      // EBITDA calculation
      const grossEBITDA = adjustedRevenue * params.margin;
      const netEBITDA = Math.max(0, grossEBITDA - this.modelData.fixedCostsAnnual);
      const finalEBITDA = netEBITDA * this.modelData.operationalEfficiency;
      
      ebitdaProjection.push(finalEBITDA); 
    }

    const equityIRR = this.calculateEquityIRR(capitalStructure, ebitdaProjection, fixedYears);
    const finalEBITDA = ebitdaProjection[fixedYears - 1];
    const finalValuation = finalEBITDA * this.modelData.industryMultiple;
    
    // Final year revenue
    const finalRevenue = fleetSize * this.modelData.annualRevenuePerUnit * Math.pow(params.growth, fixedYears - 1);

    // Chart data for different scales
    const chartLabels = [100, 250, 500, 750, 1000, 1500].filter(u => u <= fleetSize * 1.2);
    
    const chartTIRData = chartLabels.map(units => { 
      const tempResults = this.calculateScenario(scenario, units);
      return Math.min(tempResults.tir, 65); // Cap at 65%
    });

    const chartEBITDAData = chartLabels.map(units => { 
      const tempResults = this.calculateScenario(scenario, units);
      return tempResults.ebitda / 1000000; 
    });

    const chartValuationData = chartEBITDAData.map(ebitda => ebitda * this.modelData.industryMultiple);

    return { 
      finalTIR: Math.min(equityIRR, 65), // Cap TIR
      finalEBITDA: finalEBITDA, 
      finalValuation: finalValuation, 
      finalRevenue: finalRevenue, 
      capitalStructure: capitalStructure, 
      chartLabels: chartLabels, 
      chartTIRData: chartTIRData, 
      chartEBITDAData: chartEBITDAData, 
      chartValuationData: chartValuationData, 
      isViable: equityIRR >= 25, 
      fundingGap: capitalStructure.fundingGap, 
      cashPositiveYear: this.getCashPositiveYear(ebitdaProjection), 
      breakEvenUnits: this.getBreakEvenUnits(params),
      projectedYears: fixedYears,
      yearFiveUnits: fleetSize,
      ebitdaProjection: ebitdaProjection
    };
  }

  calculateScenario(scenario, units) {
    const params = this.scenarios[scenario];
    const capitalStructure = this.calculateOptimalCapitalStructure(units);
    
    // Simplified calculation for chart data
    const year5Units = units;
    const year5Revenue = year5Units * this.modelData.annualRevenuePerUnit * Math.pow(params.growth, 4);
    const year5EBITDA = Math.max(0, (year5Revenue * params.margin - this.modelData.fixedCostsAnnual) * this.modelData.operationalEfficiency);
    
    // Simple IRR approximation for chart
    const exitValue = year5EBITDA * this.modelData.industryMultiple;
    const netExitValue = Math.max(0, exitValue - capitalStructure.ventureDebt - capitalStructure.commercialDebt);
    const simpleIRR = capitalStructure.totalEquity > 0 ? 
      Math.pow(netExitValue / capitalStructure.totalEquity, 1/5) * 100 - 100 : 0;
    
    return {
      tir: Math.min(Math.max(simpleIRR, 0), 65),
      ebitda: year5EBITDA
    };
  }

  getCashPositiveYear(projectionData) { 
    for (let i = 0; i < projectionData.length; i++) { 
      if (projectionData[i] > this.modelData.cashPositiveThreshold) return i + 1; 
    } 
    return 4; // Conservative default
  }

  getBreakEvenUnits(params) { 
    const unitEBITDA = this.modelData.annualRevenuePerUnit * params.margin; 
    return Math.ceil(this.modelData.fixedCostsAnnual / unitEBITDA); 
  }

  updateCalculation() {
    const scenario = document.getElementById('scenario-select')?.value || 'base';
    const years = 5;
    const investment = parseInt(document.getElementById('investment-input')?.value || 45000000);
    const fleetSize = parseInt(document.getElementById('fleet-size')?.value || 500); // Default 500 units

    const yearsDisplay = document.getElementById('years-display');
    if (yearsDisplay) yearsDisplay.textContent = `5 a√±os`;

    const results = this.calculate(scenario, years, investment, fleetSize);

    // Update displays
    this.updateResultDisplay('scenario-roi-result', `${Math.round(results.finalTIR || 0)}%`);
    this.updateResultDisplay('scenario-payback-result', `A√±o ${results.cashPositiveYear}`);
    this.updateResultDisplay('scenario-value-result', `$${(results.finalValuation/1000000).toFixed(0)}M`);
    this.updateResultDisplay('scenario-revenue-result', `$${(results.finalRevenue/1000000).toFixed(1)}M`);

    this.updateChart(results); 
    this.updateAssumptions(scenario, results);
  }

  updateResultDisplay(elementId, value) { 
    const element = document.getElementById(elementId); 
    if (element) element.textContent = value; 
  }

  updateChart(results) {
    if (!this.chart) return;

    this.chart.data.labels = results.chartLabels.map(u => `${u} units`);
    this.chart.data.datasets[0].data = results.chartTIRData;
    this.chart.data.datasets[1].data = results.chartEBITDAData;
    this.chart.data.datasets[2].data = results.chartValuationData;
    this.chart.update();
  }

  updateAssumptions(scenario, results) {
    const params = this.scenarios[scenario]; 
    const assumptionsElement = document.getElementById('scenario-assumptions'); 
    if (!assumptionsElement) return;

    let viabilityStatus = '';
    if (results.finalTIR >= 45) {
      viabilityStatus = `<div class="bg-emerald-900/30 border border-emerald-600 text-emerald-200 p-4 rounded-lg mb-4">
        üöÄ <strong>STRONG RETURNS:</strong> TIR ${results.finalTIR.toFixed(1)}% - Excellent for mobility tech
      </div>`;
    } else if (results.finalTIR >= 30) {
      viabilityStatus = `<div class="bg-blue-900/30 border border-blue-600 text-blue-200 p-4 rounded-lg mb-4">
        üíé <strong>SOLID RETURNS:</strong> TIR ${results.finalTIR.toFixed(1)}% - Strong Serie A case
      </div>`;
    } else if (results.finalTIR >= 20) {
      viabilityStatus = `<div class="bg-amber-900/30 border border-amber-600 text-amber-200 p-4 rounded-lg mb-4">
        ‚ö° <strong>VIABLE RETURNS:</strong> TIR ${results.finalTIR.toFixed(1)}% - Acceptable for mobility
      </div>`;
    } else {
      viabilityStatus = `<div class="bg-red-900/30 border border-red-600 text-red-200 p-4 rounded-lg mb-4">
        ‚ö†Ô∏è <strong>BELOW TARGET:</strong> TIR ${results.finalTIR.toFixed(1)}% - Needs optimization
      </div>`;
    }

    let fundingAlert = ''; 
    if (results.fundingGap > 0) {
      fundingAlert = `<div class="bg-orange-900/30 border border-orange-600 text-orange-200 p-3 rounded-lg mb-4">
        üí∞ <strong>Funding Gap:</strong> ${this.formatCurrency(results.fundingGap)} adicional requerido
      </div>`;
    }

    assumptionsElement.innerHTML = `
      ${viabilityStatus}${fundingAlert}
      
      <div class="grid md:grid-cols-2 gap-6">
        <div class="space-y-3">
          <div class="font-semibold text-sky-400">üìä Escenario de Mercado</div>
          <div class="space-y-2 text-sm">
            <div><strong>Descripci√≥n:</strong> ${params.description}</div>
            <div><strong>Condiciones:</strong> ${params.marketCondition}</div>
            <div><strong>Crecimiento anual:</strong> <span class="text-emerald-400">${((params.growth - 1) * 100).toFixed(1)}%</span></div>
            <div><strong>Margen EBITDA:</strong> <span class="text-emerald-400">${(params.margin * 100).toFixed(1)}%</span></div>
            <div><strong>Morosidad:</strong> <span class="text-emerald-400">${(params.morosidad * 100).toFixed(1)}%</span></div>
            <div><strong>CAPEX/Unidad:</strong> <span class="text-yellow-400">${this.formatCurrency(this.modelData.packageCost)}</span></div>
          </div>
        </div>
        
        <div class="space-y-3">
          <div class="font-semibold text-emerald-400">üí∞ Estructura Financiera</div>
          <div class="space-y-2 text-sm">
            <div><strong>Equity Total:</strong> ${this.formatCurrency(results.capitalStructure.totalEquity)}</div>
            <div><strong>Venture Debt:</strong> ${this.formatCurrency(results.capitalStructure.ventureDebt)}</div>
            <div><strong>Commercial Debt:</strong> ${this.formatCurrency(results.capitalStructure.commercialDebt)}</div>
            <div><strong>Leverage Ratio:</strong> <span class="text-blue-400">${this.modelData.leverageRatio}x</span></div>
            <div><strong>Cash Positive:</strong> <span class="text-green-400">A√±o ${results.cashPositiveYear}</span></div>
            <div><strong>Flota A√±o 5:</strong> <span class="text-purple-400">${results.yearFiveUnits} unidades</span></div>
          </div>
        </div>
      </div>
      
      <div class="mt-4 p-4 bg-gradient-to-r from-slate-900/40 to-blue-900/20 rounded-lg border border-slate-600/30">
        <div class="font-semibold text-slate-300 mb-2 text-center">üéØ Mobility Tech Reality Check</div>
        <div class="grid md:grid-cols-3 gap-4 text-sm text-center">
          <div>
            <div class="text-2xl mb-1">üöõ</div>
            <div class="font-semibold text-slate-400">CAPEX Intensive</div>
            <div class="text-slate-300">$${(this.modelData.packageCost/1000).toFixed(0)}K per unit vs SaaS $0</div>
          </div>
          <div>
            <div class="text-2xl mb-1">üìà</div>
            <div class="font-semibold text-slate-400">Gradual Scale</div>
            <div class="text-slate-300">${results.yearFiveUnits} units over 5 years</div>
          </div>
          <div>
            <div class="text-2xl mb-1">üíé</div>
            <div class="font-semibold text-slate-400">AI Premium</div>
            <div class="text-slate-300">${this.modelData.industryMultiple}x vs ${this.modelData.industryMultiple-1}x traditional</div>
          </div>
        </div>
      </div>
    `;
  }

  formatCurrency(value) { 
    if (Math.abs(value) >= 1000000) return `$${(value / 1000000).toFixed(1)}M`; 
    return new Intl.NumberFormat('es-MX', { style: 'currency', currency: 'MXN', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(value); 
  }
}
        class ScenarioCalculator {
          constructor() {
            this.scenarios = {
              conservative: { growth: 1.25, margin: 0.24, morosidad: 0.10, fleetMultiplier: 0.8, description: "Crecimiento controlado, m√°rgenes estables", marketCondition: "Adopci√≥n gradual, competencia moderada" },
              base: { growth: 1.45, margin: 0.284, morosidad: 0.08, fleetMultiplier: 1.0, description: "Escenario base del modelo principal", marketCondition: "Crecimiento sostenido, mercado receptivo" },
              optimistic: { growth: 1.65, margin: 0.32, morosidad: 0.05, fleetMultiplier: 1.25, description: "Adopci√≥n acelerada, expansi√≥n geogr√°fica", marketCondition: "Mercado en explosi√≥n, l√≠der dominante" }
            };
            this.modelData = { packagePrice: 985820, packageCost: 706000, unitMarginMXN: 279820, monthlyRevenuePerUnit: 8733, seedCompleted: 7600000, seriesABase: 45000000, seriesAExtension: 75000000, seedUnitsDeployed: 3, seedLessonsLearned: true, operationalEfficiency: 0.90, marketPenetration: 0.75, targetEquityIRR: 35, industryMultiple: 7.5, timeToExitYears: 4, clientInterestRate: 0.255, ventureDebtRate: 0.18, commercialDebtRate: 0.14 };
            this.init();
          }
          
          init() { this.createChart(); this.updateCalculation(); }
          
          createChart() {
            const ctx = document.getElementById('scenario-chart')?.getContext('2d');
            if (!ctx) return;
            this.chart = new Chart(ctx, {
              type: 'line',
              data: { labels: [], datasets: [{ label: 'Equity TIR %', data: [], borderColor: '#dc2626', backgroundColor: 'rgba(220, 38, 38, 0.1)', fill: true, tension: 0.4, pointRadius: 6, pointHoverRadius: 10 }, { label: 'EBITDA (M MXN)', data: [], borderColor: '#059669', backgroundColor: 'rgba(5, 150, 105, 0.1)', yAxisID: 'y1', fill: false, tension: 0.4, pointRadius: 6, pointHoverRadius: 10 }, { label: 'Valuation Exit (M MXN)', data: [], borderColor: '#7c3aed', backgroundColor: 'rgba(124, 58, 237, 0.1)', yAxisID: 'y2', fill: false, tension: 0.4, pointRadius: 6, pointHoverRadius: 10 }] },
              options: { responsive: true, maintainAspectRatio: false, plugins: { tooltip: { backgroundColor: 'rgba(15, 23, 42, 0.95)', titleColor: '#f8fafc', bodyColor: '#e2e8f0', callbacks: { label: (context) => { if (context.datasetIndex === 0) return `TIR Equity: ${context.parsed.y.toFixed(1)}%`; else if (context.datasetIndex === 1) return `EBITDA: $${context.parsed.y.toFixed(1)}M MXN`; else return `Valuaci√≥n: $${context.parsed.y.toFixed(0)}M MXN`; } } }, legend: { labels: { color: '#94a3b8', font: { size: 11 } } } }, scales: { x: { ticks: { color: '#94a3b8' }, title: { display: true, text: 'Unidades Desplegadas', color: '#94a3b8' } }, y: { beginAtZero: true, title: { display: true, text: 'TIR Equity (%)', color: '#dc2626' }, ticks: { color: '#dc2626' }, position: 'left' }, y1: { beginAtZero: true, title: { display: true, text: 'EBITDA (M MXN)', color: '#059669' }, ticks: { color: '#059669' }, position: 'right', grid: { drawOnChartArea: false } }, y2: { beginAtZero: true, title: { display: true, text: 'Valuaci√≥n (M MXN)', color: '#7c3aed' }, ticks: { color: '#7c3aed' }, display: false } } }
            });
          }
          
          calculateOptimalCapitalStructure(fleetSize, sinosureEnabled = false) {
            const totalCapexRequired = fleetSize * this.modelData.packageCost;
            const seedAlreadyDeployed = this.modelData.seedCompleted;
            const additionalCapexNeeded = Math.max(0, totalCapexRequired - seedAlreadyDeployed);
            let equityNeeded, ventureDebt, commercialDebt;
            if (additionalCapexNeeded <= this.modelData.seriesABase) { equityNeeded = additionalCapexNeeded; ventureDebt = 0; commercialDebt = 0; } 
            else if (additionalCapexNeeded <= this.modelData.seriesABase + this.modelData.seriesAExtension) { equityNeeded = this.modelData.seriesABase; const remaining = additionalCapexNeeded - this.modelData.seriesABase; if (sinosureEnabled && remaining > 0) { commercialDebt = Math.min(remaining, totalCapexRequired * 0.6); ventureDebt = Math.max(0, remaining - commercialDebt); } else { equityNeeded += remaining; ventureDebt = 0; commercialDebt = 0; } } 
            else { equityNeeded = this.modelData.seriesABase + this.modelData.seriesAExtension; const remaining = additionalCapexNeeded - equityNeeded; if (sinosureEnabled) { commercialDebt = Math.min(remaining, totalCapexRequired * 0.6); ventureDebt = Math.max(0, remaining - commercialDebt); } else { ventureDebt = remaining; commercialDebt = 0; } }
            const totalFunding = seedAlreadyDeployed + equityNeeded + ventureDebt + commercialDebt;
            const totalEquity = seedAlreadyDeployed + equityNeeded;
            return { totalCapexRequired, seedAlreadyDeployed, newEquityNeeded: equityNeeded, ventureDebt, commercialDebt, totalFunding, totalEquity, fundingGap: Math.max(0, totalCapexRequired - totalFunding), equityPercentage: totalEquity / totalFunding, debtPercentage: (ventureDebt + commercialDebt) / totalFunding };
          }
          
          calculateEquityIRR(capitalStructure, ebitdaProjection, years) {
            const equityCashFlows = [-capitalStructure.totalEquity];
            for (let year = 1; year <= years; year++) {
              const ebitda = ebitdaProjection[year - 1];
              let interestPayments = 0;
              if (capitalStructure.ventureDebt > 0) interestPayments += capitalStructure.ventureDebt * this.modelData.ventureDebtRate;
              if (capitalStructure.commercialDebt > 0) interestPayments += capitalStructure.commercialDebt * this.modelData.commercialDebtRate;
              const netCashFlow = ebitda - interestPayments;
              if (year === years) { const exitValuation = ebitda * this.modelData.industryMultiple; const debtRepayment = capitalStructure.ventureDebt + capitalStructure.commercialDebt; const equityValue = Math.max(0, exitValuation - debtRepayment); equityCashFlows.push(netCashFlow + equityValue); } else { equityCashFlows.push(netCashFlow); }
            }
            return this.calculateIRR(equityCashFlows);
          }
          
          calculateIRR(cashFlows, maxIterations = 100, tolerance = 1e-6) {
            if (cashFlows.length < 2) return 0;
            let rate = 0.1;
            for (let iteration = 0; iteration < maxIterations; iteration++) {
              let npv = 0; let npvDerivative = 0;
              for (let i = 0; i < cashFlows.length; i++) { const discountFactor = Math.pow(1 + rate, i); npv += cashFlows[i] / discountFactor; if (i > 0) npvDerivative -= (i * cashFlows[i]) / (Math.pow(1 + rate, i + 1)); }
              if (Math.abs(npv) < tolerance) return Math.max(0, Math.min(rate * 100, 200));
              if (Math.abs(npvDerivative) < tolerance) break;
              rate = rate - npv / npvDerivative; rate = Math.max(-0.99, Math.min(rate, 5));
            }
            return Math.max(0, Math.min(rate * 100, 200));
          }
          
          calculate(scenario, years, investment, fleetSize) {
            const params = this.scenarios[scenario];
            const capitalStructure = this.calculateOptimalCapitalStructure(fleetSize);
            const ebitdaProjection = [];
            for (let year = 1; year <= years; year++) { const operatingUnits = this.getOperatingUnits(year, fleetSize); const annualRevenue = operatingUnits * this.modelData.monthlyRevenuePerUnit * 12 * Math.pow(params.growth, year - 1) * this.modelData.marketPenetration; const ebitda = annualRevenue * params.margin * this.modelData.operationalEfficiency; ebitdaProjection.push(ebitda); }
            const equityIRR = this.calculateEquityIRR(capitalStructure, ebitdaProjection, years);
            const finalEBITDA = ebitdaProjection[ebitdaProjection.length - 1];
            const finalValuation = finalEBITDA * this.modelData.industryMultiple;
            const finalRevenue = fleetSize * this.modelData.monthlyRevenuePerUnit * 12 * Math.pow(params.growth, years - 1);
            const chartLabels = [10, 25, 50, 75, 100, 150].filter(u => u <= fleetSize * 1.5);
            const chartTIRData = chartLabels.map(units => { const tempCapital = this.calculateOptimalCapitalStructure(units); const tempEbitda = []; for (let year = 1; year <= years; year++) { const operatingUnits = this.getOperatingUnits(year, units); const annualRevenue = operatingUnits * this.modelData.monthlyRevenuePerUnit * 12 * Math.pow(params.growth, year - 1) * this.modelData.marketPenetration; const ebitda = annualRevenue * params.margin * this.modelData.operationalEfficiency; tempEbitda.push(ebitda); } return this.calculateEquityIRR(tempCapital, tempEbitda, years); });
            const chartEBITDAData = chartLabels.map(units => { const operatingUnits = this.getOperatingUnits(years, units); const annualRevenue = operatingUnits * this.modelData.monthlyRevenuePerUnit * 12 * Math.pow(params.growth, years - 1) * this.modelData.marketPenetration; const ebitda = annualRevenue * params.margin * this.modelData.operationalEfficiency; return ebitda / 1000000; });
            const chartValuationData = chartEBITDAData.map(ebitda => ebitda * this.modelData.industryMultiple);
            return { finalTIR: equityIRR, finalEBITDA: finalEBITDA, finalValuation: finalValuation, finalRevenue: finalRevenue, capitalStructure: capitalStructure, chartLabels: chartLabels, chartTIRData: chartTIRData, chartEBITDAData: chartEBITDAData, chartValuationData: chartValuationData, isViable: equityIRR >= 25, fundingGap: capitalStructure.fundingGap, cashPositiveYear: this.getCashPositiveYear(ebitdaProjection), breakEvenUnits: this.getBreakEvenUnits(params) };
          }
          
          getOperatingUnits(year, targetUnits) { if (year === 1) return Math.round(targetUnits * 0.7); return targetUnits; }
          getCashPositiveYear(projectionData) { for (let i = 0; i < projectionData.length; i++) { if (projectionData[i] > 5000000) return i + 1; } return projectionData.length + 1; }
          getBreakEvenUnits(params) { const fixedCosts = 15000000; const unitEBITDA = this.modelData.monthlyRevenuePerUnit * 12 * params.margin; return Math.ceil(fixedCosts / unitEBITDA); }
          
          updateCalculation() {
            const scenario = document.getElementById('scenario-select')?.value || 'base';
            const years = parseInt(document.getElementById('years-slider')?.value || 5);
            const investment = parseInt(document.getElementById('investment-input')?.value || 45000000);
            const fleetSize = parseInt(document.getElementById('fleet-size')?.value || 50);
            const yearsDisplay = document.getElementById('years-display');
            if (yearsDisplay) yearsDisplay.textContent = `${years} a√±os`;
            const results = this.calculate(scenario, years, investment, fleetSize);
            this.updateResultDisplay('scenario-roi-result', `${Math.round(results.finalTIR || 0)}%`);
            this.updateResultDisplay('scenario-payback-result', `A√±o ${results.cashPositiveYear}`);
            this.updateResultDisplay('scenario-value-result', `$${(results.finalValuation/1000000).toFixed(0)}M`);
            this.updateResultDisplay('scenario-revenue-result', `$${(results.finalRevenue/1000000).toFixed(1)}M`);
            this.updateChart(results); this.updateAssumptions(scenario, results);
          }
          
          updateResultDisplay(elementId, value) { const element = document.getElementById(elementId); if (element) element.textContent = value; }
          
          updateChart(results) {
            if (!this.chart) return;
            this.chart.data.labels = results.chartLabels.map(u => `${u} units`);
            this.chart.data.datasets[0].data = results.chartTIRData;
            this.chart.data.datasets[1].data = results.chartEBITDAData;
            this.chart.data.datasets[2].data = results.chartValuationData;
            this.chart.update();
          }
          
          updateAssumptions(scenario, results) {
            const params = this.scenarios[scenario]; const assumptionsElement = document.getElementById('scenario-assumptions'); if (!assumptionsElement) return;
            let viabilityStatus = '';
            if (results.finalTIR >= 35) viabilityStatus = `<div class="bg-emerald-900/30 border border-emerald-600 text-emerald-200 p-3 rounded-lg mb-4">üöÄ <strong>Serie A Atractiva:</strong> TIR ${results.finalTIR.toFixed(1)}% supera target de 35%</div>`;
            else if (results.finalTIR >= 25) viabilityStatus = `<div class="bg-amber-900/30 border border-amber-600 text-amber-200 p-3 rounded-lg mb-4">‚ö° <strong>Serie A Viable:</strong> TIR ${results.finalTIR.toFixed(1)}% dentro de rango aceptable</div>`;
            else viabilityStatus = `<div class="bg-red-900/30 border border-red-600 text-red-200 p-3 rounded-lg mb-4">‚ö†Ô∏è <strong>TIR Insuficiente:</strong> ${results.finalTIR.toFixed(1)}% por debajo del m√≠nimo (25%)</div>`;
            let fundingAlert = ''; if (results.fundingGap > 0) fundingAlert = `<div class="bg-blue-900/30 border border-blue-600 text-blue-200 p-3 rounded-lg mb-4">üí∞ <strong>Funding Adicional:</strong> ${this.formatCurrency(results.fundingGap)} sobre l√≠mites actuales</div>`;
            assumptionsElement.innerHTML = `${viabilityStatus}${fundingAlert}<div class="grid md:grid-cols-2 gap-6"><div class="space-y-3"><div class="font-semibold text-sky-400">Escenario de Mercado</div><div class="space-y-2 text-sm"><div><strong>Descripci√≥n:</strong> ${params.description}</div><div><strong>Condiciones:</strong> ${params.marketCondition}</div><div><strong>Crecimiento anual:</strong> ${((params.growth - 1) * 100).toFixed(1)}%</div><div><strong>Margen EBITDA:</strong> ${(params.margin * 100).toFixed(1)}%</div><div><strong>Morosidad:</strong> ${(params.morosidad * 100).toFixed(1)}%</div></div></div><div class="space-y-3"><div class="font-semibold text-emerald-400">Estructura Financiera</div><div class="space-y-2 text-sm"><div><strong>Equity Total:</strong> ${this.formatCurrency(results.capitalStructure.totalEquity)}</div><div><strong>Venture Debt:</strong> ${this.formatCurrency(results.capitalStructure.ventureDebt)}</div><div><strong>Commercial Debt:</strong> ${this.formatCurrency(results.capitalStructure.commercialDebt)}</div><div><strong>Cash Positive:</strong> A√±o ${results.cashPositiveYear}</div><div><strong>Breakeven Units:</strong> ${results.breakEvenUnits} unidades</div></div></div></div>`;
          }
          
          formatCurrency(value) { if (Math.abs(value) >= 1000000) return `$${(value / 1000000).toFixed(1)}M`; return new Intl.NumberFormat('es-MX', { style: 'currency', currency: 'MXN', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(value); }
        }

        // AGREGAR: DataValidator class
        class DataValidator {
          constructor() {
            this.foundationalData = { totalBudget: 7665000, teamCost: 1940000, coreTech: 2265000, pilotCapex: 2630000, saasStack: 631000, ragDNA: 150000, reserva: 49000, runway: 12, teamSize: 8, coreESOP: 3 };
            this.tolerance = 1000; this.discrepancies = []; this.init();
          }
          init() { this.validateAll(); this.displayValidationBadge(); }
          validateAll() { this.discrepancies = []; this.validateFinancialData(); this.validateTeamData(); this.validateTechnicalData(); this.validateTimelineData(); return this.generateValidationReport(); }
          validateFinancialData() {
            const componentSum = this.foundationalData.teamCost + this.foundationalData.coreTech + this.foundationalData.pilotCapex + this.foundationalData.saasStack + this.foundationalData.ragDNA + this.foundationalData.reserva;
            if (Math.abs(componentSum - this.foundationalData.totalBudget) > this.tolerance) this.discrepancies.push({ type: 'financial', field: 'totalBudget', expected: this.foundationalData.totalBudget, actual: componentSum, severity: 'high', message: 'Presupuesto total no coincide con suma de componentes' });
            const avgMonthlyBurn = this.foundationalData.totalBudget / this.foundationalData.runway; const expectedBurn = 638000;
            if (Math.abs(avgMonthlyBurn - expectedBurn) > 50000) this.discrepancies.push({ type: 'financial', field: 'burnRate', expected: expectedBurn, actual: Math.round(avgMonthlyBurn), severity: 'medium', message: 'Burn rate promedio fuera de rango esperado' });
          }
          validateTeamData() {
            const teamElements = document.querySelectorAll('#hr-table tbody tr');
            if (teamElements.length !== this.foundationalData.teamSize) this.discrepancies.push({ type: 'team', field: 'teamSize', expected: this.foundationalData.teamSize, actual: teamElements.length, severity: 'medium', message: 'N√∫mero de miembros del equipo no coincide' });
          }
          validateTechnicalData() {
            const agentBudgets = { hase: 710000, pia: 475000, superPma: 600000, asistente: 330000, ragDna: 150000 };
            const totalAgentBudget = Object.values(agentBudgets).reduce((sum, budget) => sum + budget, 0);
            if (Math.abs(totalAgentBudget - this.foundationalData.coreTech) > this.tolerance) this.discrepancies.push({ type: 'technical', field: 'agentBudgets', expected: this.foundationalData.coreTech, actual: totalAgentBudget, severity: 'high', message: 'Presupuesto total de agentes no coincide con Core Tech' });
          }
          validateTimelineData() {
            const timelineElements = document.querySelectorAll('[data-month]'); const uniqueMonths = new Set();
            timelineElements.forEach(el => { const month = el.getAttribute('data-month'); if (month) uniqueMonths.add(parseInt(month)); });
            if (uniqueMonths.size < 10) this.discrepancies.push({ type: 'timeline', field: 'monthCoverage', expected: 12, actual: uniqueMonths.size, severity: 'medium', message: 'Timeline no cubre suficientes meses del cronograma' });
          }
          generateValidationReport() {
            if (this.discrepancies.length === 0) return { status: 'valid', message: 'Todos los datos est√°n alineados con documentos fundacionales', discrepancies: [] };
            return { status: 'invalid', discrepancies: this.discrepancies, recommendations: this.generateRecommendations() };
          }
          generateRecommendations() {
            return this.discrepancies.map(disc => {
              switch (disc.type) {
                case 'financial': return `Revisar c√°lculos financieros en ${disc.field}`;
                case 'team': return `Verificar datos del equipo: ${disc.field}`;
                case 'technical': return `Validar presupuestos t√©cnicos: ${disc.field}`;
                case 'timeline': return `Completar datos de cronograma: ${disc.field}`;
                default: return `Revisar inconsistencia en ${disc.field}`;
              }
            });
          }
          displayValidationBadge() {
            const validation = this.validateAll(); const existingBadge = document.getElementById('validation-badge'); if (existingBadge) existingBadge.remove();
            const badge = document.createElement('div'); badge.id = 'validation-badge';
            badge.className = `fixed bottom-4 right-4 px-4 py-2 rounded-lg text-white text-sm z-50 cursor-pointer transition-all duration-300 ${validation.status === 'valid' ? 'bg-green-500 hover:bg-green-600' : 'bg-red-500 hover:bg-red-600'}`;
            const icon = validation.status === 'valid' ? '‚úì' : '‚ö†'; const text = validation.status === 'valid' ? 'Datos Validados' : `${this.discrepancies.length} Inconsistencias`;
            badge.innerHTML = `${icon} ${text}`; badge.onclick = () => this.showValidationModal(validation); document.body.appendChild(badge);
            setTimeout(() => { badge.style.transform = 'translateY(0)'; }, 100);
          }
          showValidationModal(validation) {
            const existingModal = document.getElementById('validation-modal'); if (existingModal) existingModal.remove();
            const modal = document.createElement('div'); modal.id = 'validation-modal'; modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            modal.innerHTML = `<div class="bg-white rounded-lg max-w-2xl w-full max-h-[80vh] overflow-y-auto"><div class="p-6 border-b flex justify-between items-center"><h3 class="text-xl font-bold text-slate-800">${validation.status === 'valid' ? '‚úÖ Validaci√≥n Exitosa' : '‚ö†Ô∏è Inconsistencias Detectadas'}</h3><button onclick="document.getElementById('validation-modal').remove()" class="text-slate-500 hover:text-slate-700 text-2xl">&times;</button></div><div class="p-6">${validation.status === 'valid' ? `<div class="text-green-700 mb-4"><p class="mb-2">${validation.message}</p><div class="bg-green-50 p-4 rounded-lg"><h4 class="font-semibold mb-2">Validaciones Completadas:</h4><ul class="text-sm space-y-1"><li>‚úì Coherencia presupuestal</li><li>‚úì Estructura del equipo</li><li>‚úì Asignaci√≥n t√©cnica</li><li>‚úì Cronograma completo</li></ul></div></div>` : `<div class="space-y-4">${validation.discrepancies.map(disc => `<div class="border-l-4 ${disc.severity === 'high' ? 'border-red-500 bg-red-50' : disc.severity === 'medium' ? 'border-yellow-500 bg-yellow-50' : 'border-blue-500 bg-blue-50'} p-4 rounded"><div class="flex justify-between items-start mb-2"><h4 class="font-semibold text-slate-800">${disc.message}</h4><span class="text-xs px-2 py-1 rounded ${disc.severity === 'high' ? 'bg-red-200 text-red-800' : disc.severity === 'medium' ? 'bg-yellow-200 text-yellow-800' : 'bg-blue-200 text-blue-800'}">${disc.severity}</span></div><div class="text-sm text-slate-600"><div>Esperado: ${this.formatValue(disc.expected)}</div><div>Actual: ${this.formatValue(disc.actual)}</div></div></div>`).join('')}<div class="bg-slate-50 p-4 rounded-lg"><h4 class="font-semibold mb-2">Recomendaciones:</h4><ul class="text-sm space-y-1">${validation.recommendations.map(rec => `<li>‚Ä¢ ${rec}</li>`).join('')}</ul></div></div>`}</div></div>`;
            document.body.appendChild(modal); modal.addEventListener('click', (e) => { if (e.target === modal) modal.remove(); });
          }
          formatValue(value) { if (typeof value === 'number') return new Intl.NumberFormat('es-MX').format(value); return value; }
        }

        // AGREGAR: TestingController class
        class TestingController {
          constructor() { this.tests = []; this.results = { passed: 0, failed: 0, total: 0 }; this.init(); }
          init() { this.setupTestSuite(); this.runTests(); }
          setupTestSuite() {
            this.addTest('Navigation Links', () => this.testNavigationLinks());
            this.addTest('Charts Loading', () => this.testChartsLoading());
            this.addTest('Role Switching', () => this.testRoleSwitching());
            this.addTest('Phase Filtering', () => this.testPhaseFiltering());
            this.addTest('Data Validation', () => this.testDataValidation());
            this.addTest('Cross References', () => this.testCrossReferences());
            this.addTest('Progress Tracking', () => this.testProgressTracking());
            this.addTest('Mobile Navigation', () => this.testMobileNavigation());
          }
          addTest(name, testFunction) { this.tests.push({ name, testFunction }); }
          runTests() {
            console.log('üß™ Ejecutando suite de pruebas...');
            this.tests.forEach(test => {
              try {
                const result = test.testFunction();
                if (result) { this.results.passed++; console.log(`‚úÖ ${test.name}: PASS`); } else { this.results.failed++; console.log(`‚ùå ${test.name}: FAIL`); }
              } catch (error) { this.results.failed++; console.log(`‚ùå ${test.name}: ERROR - ${error.message}`); }
              this.results.total++;
            });
            this.displayResults();
          }
          testNavigationLinks() {
            const navLinks = document.querySelectorAll('.nav-link'); const sections = document.querySelectorAll('section[id]'); let allLinksValid = true;
            navLinks.forEach(link => { const href = link.getAttribute('href'); if (href && href.startsWith('#')) { const targetId = href.replace('#', ''); const targetSection = document.getElementById(targetId); if (!targetSection) { allLinksValid = false; console.warn(`Missing target section: ${targetId}`); } } });
            return navLinks.length > 0 && sections.length > 0 && allLinksValid;
          }
          testChartsLoading() { const charts = document.querySelectorAll('canvas'); let chartsLoaded = true; charts.forEach(canvas => { if (!canvas.getContext) chartsLoaded = false; }); return charts.length > 0 && chartsLoaded; }
          testRoleSwitching() { if (!window.audienceController) return false; const roleSelector = document.getElementById('role-selector'); if (!roleSelector) return false; window.audienceController.switchRole('investor'); const bodyHasRoleClass = document.body.className.includes('role-investor'); window.audienceController.switchRole('general'); return bodyHasRoleClass; }
          testPhaseFiltering() { if (!window.phaseController) return false; const phaseButtons = document.querySelectorAll('.phase-btn'); if (phaseButtons.length === 0) return false; window.phaseController.filterByPhase('foundation'); const hasActiveButton = document.querySelector('.phase-btn.active'); window.phaseController.filterByPhase('all'); return hasActiveButton !== null; }
          testDataValidation() { if (!window.dataValidator) return false; const validation = window.dataValidator.validateAll(); return validation && validation.hasOwnProperty('status'); }
          testCrossReferences() { if (!window.crossReferenceController) return false; const crossRefLinks = document.querySelectorAll('.cross-ref-link'); return crossRefLinks.length > 0; }
          testProgressTracking() { if (!window.progressTracker) return false; const progressBars = document.querySelectorAll('.milestone-progress'); const milestoneCards = document.querySelectorAll('.milestone-card'); return progressBars.length > 0 && milestoneCards.length > 0; }
          testMobileNavigation() { const mobileNav = document.getElementById('mobile-nav'); const mobileLinks = document.querySelectorAll('.mobile-nav-link'); return mobileNav !== null && mobileLinks.length > 0; }
          displayResults() {
            const successRate = Math.round((this.results.passed / this.results.total) * 100);
            console.log('\nüìä Resultados de Pruebas:'); console.log(`‚úÖ Exitosas: ${this.results.passed}`); console.log(`‚ùå Fallidas: ${this.results.failed}`); console.log(`üìà Tasa de √©xito: ${successRate}%`);
            if (successRate >= 90) console.log('üéâ EXCELENTE: Sistema funcionando correctamente'); else if (successRate >= 75) console.log('‚ö†Ô∏è BUENO: Algunos problemas menores detectados'); else console.log('üö® ATENCI√ìN: Problemas cr√≠ticos detectados');
            if (window.location.hostname === 'localhost' || window.location.search.includes('debug=true')) this.showTestResults(successRate);
          }
          showTestResults(successRate) {
            const resultsModal = document.createElement('div'); resultsModal.className = 'fixed top-4 left-4 bg-white border border-gray-300 rounded-lg shadow-lg p-4 z-50 max-w-sm';
            resultsModal.innerHTML = `<div class="flex justify-between items-center mb-2"><h4 class="font-bold text-slate-800">üß™ Test Results</h4><button onclick="this.parentElement.parentElement.remove()" class="text-slate-500">&times;</button></div><div class="space-y-2 text-sm"><div class="flex justify-between"><span>Passed:</span><span class="text-green-600 font-semibold">${this.results.passed}</span></div><div class="flex justify-between"><span>Failed:</span><span class="text-red-600 font-semibold">${this.results.failed}</span></div><div class="flex justify-between"><span>Success Rate:</span><span class="font-bold ${successRate >= 90 ? 'text-green-600' : successRate >= 75 ? 'text-yellow-600' : 'text-red-600'}">${successRate}%</span></div></div><div class="mt-2 text-xs text-slate-500">${successRate >= 90 ? 'üéâ All systems operational' : successRate >= 75 ? '‚ö†Ô∏è Minor issues detected' : 'üö® Critical issues found'}</div>`;
            document.body.appendChild(resultsModal); setTimeout(() => { if (resultsModal.parentElement) resultsModal.remove(); }, 5000);
          }
        }

        // AGREGAR: CrossReferenceController class
        class CrossReferenceController {
          constructor() {
            this.references = {
              'core-ia-budget': { sourceSelector: '[data-ref="core-ia-budget"]', target: 'tecnologia', description: 'Ver desglose t√©cnico por agente', highlightSelector: '.agent-card' },
              'team-cost': { sourceSelector: '[data-ref="team-cost"]', target: 'equipo', description: 'Ver estructura y roles del equipo', highlightSelector: '#hr-table' },
              'hase-development': { sourceSelector: '[data-ref="hase-development"]', target: 'ejecucion', description: 'Ver cronograma de desarrollo HASE', highlightSelector: '[data-month="1"], [data-month="2"], [data-month="3"]' },
              'pia-development': { sourceSelector: '[data-ref="pia-development"]', target: 'ejecucion', description: 'Ver cronograma de desarrollo PIA', highlightSelector: '[data-month="4"], [data-month="5"]' },
              'superPma-development': { sourceSelector: '[data-ref="superPma-development"]', target: 'ejecucion', description: 'Ver cronograma de desarrollo Super-PMA', highlightSelector: '[data-month="5"], [data-month="6"]' },
              'asistente-development': { sourceSelector: '[data-ref="asistente-development"]', target: 'ejecucion', description: 'Ver cronograma de desarrollo Asistente', highlightSelector: '[data-month="4"], [data-month="5"]' },
              'ragDna-development': { sourceSelector: '[data-ref="ragDna-development"]', target: 'ejecucion', description: 'Ver cronograma RAG-DNA', highlightSelector: '[data-month="1"], [data-month="2"]' },
              'capex-breakdown': { sourceSelector: '[data-ref="capex-breakdown"]', target: 'ejecucion', description: 'Ver despliegue de vagonetas', highlightSelector: '[data-month="6"], [data-month="7"], [data-month="8"]' },
              'roi-calculation': { sourceSelector: '[data-ref="roi-calculation"]', target: 'financiero', description: 'Ver c√°lculos financieros detallados', highlightSelector: '#roiComparisonChart' }
            };
            this.init();
          }
          init() { this.createCrossReferences(); this.bindEvents(); }
          createCrossReferences() { Object.entries(this.references).forEach(([id, ref]) => { const sourceElements = document.querySelectorAll(ref.sourceSelector); sourceElements.forEach(element => { this.addCrossReferenceLink(element, ref); }); }); }
          addCrossReferenceLink(element, reference) {
            const link = document.createElement('button'); link.className = 'cross-ref-link text-teal-600 hover:text-teal-800 text-xs ml-2 underline'; link.innerHTML = `‚Üí ${reference.description}`;
            link.onclick = (e) => { e.preventDefault(); this.navigateToReference(reference); }; element.appendChild(link);
          }
          navigateToReference(reference) {
            const targetElement = document.getElementById(reference.target);
            if (targetElement) { targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' }); this.highlightSection(targetElement); if (reference.highlightSelector) setTimeout(() => { this.highlightElements(reference.highlightSelector); }, 500); }
          }
          highlightSection(element) { element.classList.add('section-highlight'); setTimeout(() => { element.classList.remove('section-highlight'); }, 3000); }
          highlightElements(selector) { document.querySelectorAll(selector).forEach(el => { el.classList.add('cross-ref-highlight'); setTimeout(() => { el.classList.remove('cross-ref-highlight'); }, 3000); }); }
          bindEvents() { }
        }

        // AGREGAR: Real-time Progress Tracking System
        class ProgressTracker {
          constructor() {
            this.milestones = {
              month3: { 
                name: 'Fundaci√≥n Completa', 
                weight: 0.2, 
                status: 'completed',
                completion: 100,
                kpis: ['HASE >80% AUC', 'Infraestructura base', 'Equipo 100% operativo'],
                nextActions: []
              },
              month6: { 
                name: 'MVP Tecnol√≥gico', 
                weight: 0.3, 
                status: 'in-progress',
                completion: 60,
                kpis: ['HASE >90% AUC', 'PIA <2min SLA', '1ra Vagoneta >99.5% uptime'],
                nextActions: ['Completar integraci√≥n social scoring', 'Deploy PIA producci√≥n']
              },
              month9: { 
                name: 'Piloto Validado', 
                weight: 0.3, 
                status: 'pending',
                completion: 0,
                kpis: ['Super-PMA >85% accuracy', '3 vagonetas >95% uptime', 'NPS >50'],
                nextActions: ['Instalar sensores IoT', 'Marketplace transaccional']
              },
              month12: { 
                name: 'Serie A Ready', 
                weight: 0.2, 
                status: 'pending',
                completion: 0,
                kpis: ['Data room completo', 'NPS >70', 'Term sheet $45M'],
                nextActions: ['Preparar documentaci√≥n investor', 'Validar m√©tricas finales']
              }
            };
            this.overallProgress = 0;
            this.init();
          }

          init() {
            this.calculateProgress();
            this.setupProgressUpdates();
          }

          calculateProgress() {
            this.overallProgress = Object.values(this.milestones).reduce((total, milestone) => {
              return total + (milestone.completion / 100) * milestone.weight;
            }, 0) * 100;
            
            this.updateProgressDisplay();
          }

          updateProgressDisplay() {
            // Update overall progress
            const overallBar = document.getElementById('overall-progress-bar');
            const overallPercentage = document.getElementById('overall-percentage');
            
            if (overallBar) {
              overallBar.style.width = `${this.overallProgress}%`;
            }
            
            if (overallPercentage) {
              overallPercentage.textContent = `${Math.round(this.overallProgress)}%`;
            }

            // Update individual milestone cards
            Object.entries(this.milestones).forEach(([milestoneId, milestone]) => {
              this.updateMilestoneCard(milestoneId, milestone);
            });
            
            // Update next actions
            this.updateNextActions();
          }

          updateMilestoneCard(milestoneId, milestone) {
            const card = document.querySelector(`[data-milestone="${milestoneId}"]`);
            if (!card) return;

            const progressBar = card.querySelector('.milestone-progress');
            const statusIcon = card.querySelector('.milestone-status');
            
            if (progressBar) {
              progressBar.style.width = `${milestone.completion}%`;
            }
            
            if (statusIcon) {
              const icons = {
                completed: '‚úÖ',
                'in-progress': 'üöß',
                pending: '‚è≥',
                blocked: 'üö´'
              };
              statusIcon.textContent = icons[milestone.status] || '‚è≥';
            }
            
            // Add click handler for milestone details
            card.style.cursor = 'pointer';
            card.onclick = () => this.showMilestoneDetails(milestoneId, milestone);
          }

          updateNextActions() {
            const actionsContainer = document.getElementById('next-actions');
            if (!actionsContainer) return;

            // Collect next actions from in-progress milestones
            const nextActions = [];
            Object.values(this.milestones).forEach(milestone => {
              if (milestone.status === 'in-progress' || (milestone.status === 'pending' && milestone.nextActions.length > 0)) {
                nextActions.push(...milestone.nextActions.slice(0, 2)); // Limit to 2 per milestone
              }
            });

            // Limit to 3 total actions
            const limitedActions = nextActions.slice(0, 3);
            
            if (limitedActions.length > 0) {
              actionsContainer.innerHTML = limitedActions.map((action, index) => {
                const colors = ['blue', 'green', 'purple', 'orange'];
                const color = colors[index % colors.length];
                const icons = ['üéØ', 'ü§ñ', 'üìã', 'üöÄ'];
                const icon = icons[index % icons.length];
                
                return `
                  <div class="flex items-center p-2 bg-${color}-50 rounded border-l-4 border-${color}-500">
                    <span class="text-${color}-500 mr-2">${icon}</span>
                    <span class="text-sm text-${color}-800">${action}</span>
                  </div>
                `;
              }).join('');
            }
          }

          setupProgressUpdates() {
            // Simulate real-time updates (in production, this would come from actual data)
            setInterval(() => {
              // Update in-progress milestones
              Object.entries(this.milestones).forEach(([id, milestone]) => {
                if (milestone.status === 'in-progress' && milestone.completion < 100) {
                  // Simulate progress increment
                  const increment = Math.random() * 1; // 0-1% increase
                  milestone.completion = Math.min(100, milestone.completion + increment);
                  
                  if (milestone.completion >= 100) {
                    milestone.status = 'completed';
                    this.triggerCelebration(milestone.name);
                  }
                }
              });
              
              this.calculateProgress();
            }, 30000); // Update every 30 seconds
          }

          triggerCelebration(milestoneName) {
            // Create confetti effect
            this.showCelebration(`¬°${milestoneName} Completado!`);
            
            // Add celebration to milestone card
            const cards = document.querySelectorAll('.milestone-card');
            cards.forEach(card => {
              if (card.textContent.includes(milestoneName)) {
                card.classList.add('celebration-pulse');
                setTimeout(() => {
                  card.classList.remove('celebration-pulse');
                }, 2000);
              }
            });
          }

          showCelebration(message) {
            const celebration = document.createElement('div');
            celebration.className = 'fixed inset-0 flex items-center justify-center z-50 pointer-events-none';
            celebration.innerHTML = `
              <div class="bg-green-500 text-white px-8 py-4 rounded-lg shadow-lg transform scale-0 transition-transform duration-500">
                <div class="text-center">
                  <span class="text-3xl block mb-2">üéâ</span>
                  <div class="font-bold text-lg">${message}</div>
                  <div class="text-sm opacity-90">¬°Excelente progreso hacia Serie A!</div>
                </div>
              </div>
            `;
            
            document.body.appendChild(celebration);
            
            // Animate in
            setTimeout(() => {
              celebration.firstElementChild.classList.add('scale-100');
            }, 100);
            
            // Remove after animation
            setTimeout(() => {
              celebration.remove();
            }, 3000);
          }

          showMilestoneDetails(milestoneId, milestone) {
            // Create modal with milestone details
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
              <div class="bg-white rounded-lg max-w-lg w-full">
                <div class="p-6 border-b flex justify-between items-center">
                  <h3 class="text-xl font-bold text-slate-800">${milestone.name}</h3>
                  <button onclick="this.closest('.fixed').remove()" 
                          class="text-slate-500 hover:text-slate-700 text-2xl">&times;</button>
                </div>
                
                <div class="p-6">
                  <div class="mb-4">
                    <div class="flex justify-between items-center mb-2">
                      <span class="font-medium">Progreso</span>
                      <span class="font-bold">${milestone.completion}%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                      <div class="bg-teal-500 h-3 rounded-full transition-all duration-500" 
                           style="width: ${milestone.completion}%"></div>
                    </div>
                  </div>
                  
                  <div class="mb-4">
                    <h4 class="font-semibold mb-2">KPIs Objetivo:</h4>
                    <ul class="space-y-1">
                      ${milestone.kpis.map(kpi => `
                        <li class="flex items-center text-sm">
                          <span class="text-green-500 mr-2">‚Ä¢</span>
                          ${kpi}
                        </li>
                      `).join('')}
                    </ul>
                  </div>
                  
                  ${milestone.nextActions.length > 0 ? `
                    <div>
                      <h4 class="font-semibold mb-2">Acciones Pendientes:</h4>
                      <ul class="space-y-1">
                        ${milestone.nextActions.map(action => `
                          <li class="flex items-center text-sm">
                            <span class="text-orange-500 mr-2">‚Üí</span>
                            ${action}
                          </li>
                        `).join('')}
                      </ul>
                    </div>
                  ` : ''}
                </div>
              </div>
            `;
            
            document.body.appendChild(modal);
            
            // Click outside to close
            modal.addEventListener('click', (e) => {
              if (e.target === modal) modal.remove();
            });
          }
        }

        // AGREGAR: Moat Details System for Competitive Analysis
        function showMoatDetails(moatType) {
          const moatData = {
            datos: {
              title: 'Foso de Datos: Carta Aval de Ruta',
              content: `
                <div class="space-y-4">
                  <div class="bg-blue-50 p-4 rounded-lg">
                    <h4 class="font-bold text-blue-800 mb-2">Activo Propietario √önico</h4>
                    <p class="text-blue-700 text-sm">La "Carta Aval de Ruta" representa 20+ a√±os de conocimiento cultural del sector transportista mexicano, imposible de replicar por competidores tradicionales o fintechs.</p>
                  </div>
                  <div class="grid md:grid-cols-2 gap-4">
                    <div>
                      <h5 class="font-semibold mb-2">Componentes √önicos:</h5>
                      <ul class="text-sm space-y-1">
                        <li>‚Ä¢ Capital social comunitario digitalizado</li>
                        <li>‚Ä¢ Validaci√≥n por presidentes de ruta</li>
                        <li>‚Ä¢ Historial reputacional no-financiero</li>
                        <li>‚Ä¢ Network effects culturales</li>
                      </ul>
                    </div>
                    <div>
                      <h5 class="font-semibold mb-2">Barrera de Entrada:</h5>
                      <ul class="text-sm space-y-1">
                        <li>‚Ä¢ Tiempo: 20+ a√±os para construir</li>
                        <li>‚Ä¢ Costo: Imposible monetizar</li>
                        <li>‚Ä¢ Acceso: Requiere confianza cultural</li>
                        <li>‚Ä¢ Competidores: Sin equivalente</li>
                      </ul>
                    </div>
                  </div>
                </div>
              `
            },
            tech: {
              title: 'Foso Tecnol√≥gico: Arquitectura Multi-Agente',
              content: `
                <div class="space-y-4">
                  <div class="bg-green-50 p-4 rounded-lg">
                    <h4 class="font-bold text-green-800 mb-2">4 Agentes IA Sin√©rgicos</h4>
                    <p class="text-green-700 text-sm">Arquitectura √∫nica donde cada agente se especializa y retroalimenta a los dem√°s, creando un ecosistema de IA m√°s potente que la suma de sus partes.</p>
                  </div>
                  <div class="grid md:grid-cols-2 gap-4">
                    <div>
                      <h5 class="font-semibold mb-2">Sinergia T√©cnica:</h5>
                      <ul class="text-sm space-y-1">
                        <li>‚Ä¢ HASE ‚Üí scoring ‚Üí triggers PIA</li>
                        <li>‚Ä¢ Super-PMA ‚Üí datos ‚Üí mejora HASE</li>
                        <li>‚Ä¢ Asistente ‚Üí interacciones ‚Üí entrena PIA</li>
                        <li>‚Ä¢ RAG-DNA ‚Üí conocimiento ‚Üí todos</li>
                      </ul>
                    </div>
                    <div>
                      <h5 class="font-semibold mb-2">Ventaja Competitiva:</h5>
                      <ul class="text-sm space-y-1">
                        <li>‚Ä¢ Fintechs: Monol√≠ticos, no especializados</li>
                        <li>‚Ä¢ Bancos: Legacy systems, no IA-nativo</li>
                        <li>‚Ä¢ Startups: Single-purpose, no ecosystem</li>
                        <li>‚Ä¢ RAG: Multi-agent, self-improving</li>
                      </ul>
                    </div>
                  </div>
                </div>
              `
            },
            ops: {
              title: 'Foso Operacional: Escalabilidad sin Headcount',
              content: `
                <div class="space-y-4">
                  <div class="bg-purple-50 p-4 rounded-lg">
                    <h4 class="font-bold text-purple-800 mb-2">Automatizaci√≥n de Costos Variables</h4>
                    <p class="text-purple-700 text-sm">La IA convierte costos variables tradicionales (soporte, cobranza, mantenimiento) en inversi√≥n de capital fija, mejorando m√°rgenes conforme escala.</p>
                  </div>
                  <div class="grid md:grid-cols-2 gap-4">
                    <div>
                      <h5 class="font-semibold mb-2">Reducciones Operativas:</h5>
                      <ul class="text-sm space-y-1">
                        <li>‚Ä¢ Soporte: 40% menos agentes humanos</li>
                        <li>‚Ä¢ Cobranza: Autom√°tica + emp√°tica</li>
                        <li>‚Ä¢ Mantenimiento: 30% menos reparaciones</li>
                        <li>‚Ä¢ Diagn√≥sticos: 70% automatizados</li>
                      </ul>
                    </div>
                    <div>
                      <h5 class="font-semibold mb-2">Escalabilidad:</h5>
                      <ul class="text-sm space-y-1">
                        <li>‚Ä¢ 10 veh√≠culos: Margen 25%</li>
                        <li>‚Ä¢ 100 veh√≠culos: Margen 35%</li>
                        <li>‚Ä¢ 1000 veh√≠culos: Margen 45%</li>
                        <li>‚Ä¢ AI mejora con m√°s datos</li>
                      </ul>
                    </div>
                  </div>
                </div>
              `
            },
            network: {
              title: 'Foso de Red: Flywheel Auto-Reforzado',
              content: `
                <div class="space-y-4">
                  <div class="bg-orange-50 p-4 rounded-lg">
                    <h4 class="font-bold text-orange-800 mb-2">Efecto Red Compuesto</h4>
                    <p class="text-orange-700 text-sm">Cada nuevo cliente mejora el servicio para todos: m√°s datos ‚Üí IA m√°s smart ‚Üí mejor servicio ‚Üí m√°s clientes ‚Üí m√°s datos.</p>
                  </div>
                  <div class="grid md:grid-cols-2 gap-4">
                    <div>
                      <h5 class="font-semibold mb-2">Flywheel Components:</h5>
                      <ul class="text-sm space-y-1">
                        <li>‚Ä¢ M√°s operadores ‚Üí m√°s datos</li>
                        <li>‚Ä¢ M√°s datos ‚Üí mejores modelos</li>
                        <li>‚Ä¢ Mejores modelos ‚Üí mejor servicio</li>
                        <li>‚Ä¢ Mejor servicio ‚Üí m√°s operadores</li>
                      </ul>
                    </div>
                    <div>
                      <h5 class="font-semibold mb-2">Network Effects:</h5>
                      <ul class="text-sm space-y-1">
                        <li>‚Ä¢ Marketplace: M√°s oferta/demanda</li>
                        <li>‚Ä¢ Datos: Benchmarking colectivo</li>
                        <li>‚Ä¢ Comunidad: Support peer-to-peer</li>
                        <li>‚Ä¢ Poder negociaci√≥n: Mejores rates</li>
                      </ul>
                    </div>
                  </div>
                </div>
              `
            }
          };

          const detailsContainer = document.getElementById('moat-details');
          const contentContainer = document.getElementById('moat-content');
          
          if (detailsContainer && contentContainer) {
            const moat = moatData[moatType];
            if (moat) {
              contentContainer.innerHTML = `
                <h3 class="text-xl font-bold mb-4 text-slate-800">${moat.title}</h3>
                ${moat.content}
                <div class="mt-6 p-4 bg-slate-100 rounded-lg">
                  <button onclick="hideMoatDetails()" class="text-slate-600 hover:text-slate-800 font-medium">
                    ‚Üê Volver a vista general
                  </button>
                </div>
              `;
              
              detailsContainer.classList.remove('hidden');
              detailsContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
          }
        }

        function hideMoatDetails() {
          const detailsContainer = document.getElementById('moat-details');
          if (detailsContainer) {
            detailsContainer.classList.add('hidden');
          }
        }

        // Make functions globally available
        window.showMoatDetails = showMoatDetails;
        window.hideMoatDetails = hideMoatDetails;

        // AGREGAR: Enhanced moat analysis functions
        function showMoatDetails(moatType) {
          const moatData = {
            datos: { title: 'Foso de Datos: Carta Aval de Ruta', content: `<div class="space-y-4"><div class="bg-blue-50 p-4 rounded-lg"><h4 class="font-bold text-blue-800 mb-2">Activo Propietario √önico</h4><p class="text-blue-700 text-sm">La "Carta Aval de Ruta" representa 20+ a√±os de conocimiento cultural del sector transportista mexicano, imposible de replicar por competidores tradicionales o fintechs.</p></div><div class="grid md:grid-cols-2 gap-4"><div><h5 class="font-semibold mb-2">Componentes √önicos:</h5><ul class="text-sm space-y-1"><li>‚Ä¢ Capital social comunitario digitalizado</li><li>‚Ä¢ Validaci√≥n por presidentes de ruta</li><li>‚Ä¢ Historial reputacional no-financiero</li><li>‚Ä¢ Network effects culturales</li></ul></div><div><h5 class="font-semibold mb-2">Barrera de Entrada:</h5><ul class="text-sm space-y-1"><li>‚Ä¢ Tiempo: 20+ a√±os para construir</li><li>‚Ä¢ Costo: Imposible monetizar</li><li>‚Ä¢ Acceso: Requiere confianza cultural</li><li>‚Ä¢ Competidores: Sin equivalente</li></ul></div></div></div>` },
            tech: { title: 'Foso Tecnol√≥gico: Arquitectura Multi-Agente', content: `<div class="space-y-4"><div class="bg-green-50 p-4 rounded-lg"><h4 class="font-bold text-green-800 mb-2">4 Agentes IA Sin√©rgicos</h4><p class="text-green-700 text-sm">Arquitectura √∫nica donde cada agente se especializa y retroalimenta a los dem√°s, creando un ecosistema de IA m√°s potente que la suma de sus partes.</p></div><div class="grid md:grid-cols-2 gap-4"><div><h5 class="font-semibold mb-2">Sinergia T√©cnica:</h5><ul class="text-sm space-y-1"><li>‚Ä¢ HASE ‚Üí scoring ‚Üí triggers PIA</li><li>‚Ä¢ Super-PMA ‚Üí datos ‚Üí mejora HASE</li><li>‚Ä¢ Asistente ‚Üí interacciones ‚Üí entrena PIA</li><li>‚Ä¢ RAG-DNA ‚Üí conocimiento ‚Üí todos</li></ul></div><div><h5 class="font-semibold mb-2">Ventaja Competitiva:</h5><ul class="text-sm space-y-1"><li>‚Ä¢ Fintechs: Monol√≠ticos, no especializados</li><li>‚Ä¢ Bancos: Legacy systems, no IA-nativo</li><li>‚Ä¢ Startups: Single-purpose, no ecosystem</li><li>‚Ä¢ RAG: Multi-agent, self-improving</li></ul></div></div></div>` },
            ops: { title: 'Foso Operacional: Escalabilidad sin Headcount', content: `<div class="space-y-4"><div class="bg-purple-50 p-4 rounded-lg"><h4 class="font-bold text-purple-800 mb-2">Automatizaci√≥n de Costos Variables</h4><p class="text-purple-700 text-sm">La IA convierte costos variables tradicionales (soporte, cobranza, mantenimiento) en inversi√≥n de capital fija, mejorando m√°rgenes conforme escala.</p></div><div class="grid md:grid-cols-2 gap-4"><div><h5 class="font-semibold mb-2">Reducciones Operativas:</h5><ul class="text-sm space-y-1"><li>‚Ä¢ Soporte: 40% menos agentes humanos</li><li>‚Ä¢ Cobranza: Autom√°tica + emp√°tica</li><li>‚Ä¢ Mantenimiento: 30% menos reparaciones</li><li>‚Ä¢ Diagn√≥sticos: 70% automatizados</li></ul></div><div><h5 class="font-semibold mb-2">Escalabilidad:</h5><ul class="text-sm space-y-1"><li>‚Ä¢ 10 veh√≠culos: Margen 25%</li><li>‚Ä¢ 100 veh√≠culos: Margen 35%</li><li>‚Ä¢ 1000 veh√≠culos: Margen 45%</li><li>‚Ä¢ AI mejora con m√°s datos</li></ul></div></div></div>` },
            network: { title: 'Foso de Red: Flywheel Auto-Reforzado', content: `<div class="space-y-4"><div class="bg-orange-50 p-4 rounded-lg"><h4 class="font-bold text-orange-800 mb-2">Efecto Red Compuesto</h4><p class="text-orange-700 text-sm">Cada nuevo cliente mejora el servicio para todos: m√°s datos ‚Üí IA m√°s smart ‚Üí mejor servicio ‚Üí m√°s clientes ‚Üí m√°s datos.</p></div><div class="grid md:grid-cols-2 gap-4"><div><h5 class="font-semibold mb-2">Flywheel Components:</h5><ul class="text-sm space-y-1"><li>‚Ä¢ M√°s operadores ‚Üí m√°s datos</li><li>‚Ä¢ M√°s datos ‚Üí mejores modelos</li><li>‚Ä¢ Mejores modelos ‚Üí mejor servicio</li><li>‚Ä¢ Mejor servicio ‚Üí m√°s operadores</li></ul></div><div><h5 class="font-semibold mb-2">Network Effects:</h5><ul class="text-sm space-y-1"><li>‚Ä¢ Marketplace: M√°s oferta/demanda</li><li>‚Ä¢ Datos: Benchmarking colectivo</li><li>‚Ä¢ Comunidad: Support peer-to-peer</li><li>‚Ä¢ Poder negociaci√≥n: Mejores rates</li></ul></div></div></div>` }
          };
          const detailsContainer = document.getElementById('moat-details'); const contentContainer = document.getElementById('moat-content');
          if (detailsContainer && contentContainer) {
            const moat = moatData[moatType];
            if (moat) { contentContainer.innerHTML = `<h3 class="text-xl font-bold mb-4 text-slate-800">${moat.title}</h3>${moat.content}<div class="mt-6 p-4 bg-slate-100 rounded-lg"><button onclick="hideMoatDetails()" class="text-slate-600 hover:text-slate-800 font-medium">‚Üê Volver a vista general</button></div>`; detailsContainer.classList.remove('hidden'); detailsContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' }); }
          }
        }
        function hideMoatDetails() { const detailsContainer = document.getElementById('moat-details'); if (detailsContainer) detailsContainer.classList.add('hidden'); }
        window.showMoatDetails = showMoatDetails; window.hideMoatDetails = hideMoatDetails;

        // Add scroll progress indicator
        const progressBar = document.createElement('div');
        progressBar.className = 'scroll-progress';
        document.body.insertAdjacentElement('afterbegin', progressBar);

        // --- INITIALIZATION ---
        // Initialize data and render base components (MANTENER existente)
        renderInvestmentChart();
        renderROIChart();
        renderDiferenciadores();
        renderFinancials();
        renderFinancialBreakdown();
        renderAgentes();
        renderArquitecturaDatos();
        renderWeeklyTimeline();
        renderKpisCorrelacionados();
        renderCompliance();
        renderTeamTable();
        renderProgressTrackers();
        setupModal();

        // AGREGAR: Initialize new systems
        console.log('üöÄ Inicializando sistemas avanzados...');
        
        // Initialize controllers in order
        try {
            window.audienceController = new AudienceController();
            console.log('‚úÖ Audience Controller initialized');
            
            window.phaseController = new PhaseController();
            console.log('‚úÖ Phase Controller initialized');
            
            window.scenarioCalculator = new ScenarioCalculator();
            console.log('‚úÖ Scenario Calculator initialized');
            
            window.progressTracker = new ProgressTracker();
            console.log('‚úÖ Progress Tracker initialized');
            
            window.crossReferenceController = new CrossReferenceController();
            console.log('‚úÖ Cross Reference Controller initialized');
            
            window.dataValidator = new DataValidator();
            console.log('‚úÖ Data Validator initialized');

            // Initialize testing in development mode
            if (window.location.hostname === 'localhost' || window.location.search.includes('test=true')) {
              setTimeout(() => {
                window.testingController = new TestingController();
                console.log('‚úÖ Testing Controller initialized');
              }, 2000);
            }
            
            // Setup global functions
            window.switchRole = (role) => window.audienceController.switchRole(role);
            window.filterByPhase = (phase) => window.phaseController.filterByPhase(phase);
            window.updateScenarioCalculation = () => window.scenarioCalculator.updateCalculation();
            
            console.log('üéâ Todos los sistemas inicializados correctamente');
            
            // Show success notification
            showInitializationSuccess();
            
        } catch (error) {
            console.error('‚ùå Error durante la inicializaci√≥n:', error);
            showInitializationError(error);
        }

        // MANTENER: Navigation and existing functionality
        setupActiveNavigation();
        setupViewToggle();

        // AGREGAR: Initialization feedback functions
        function showInitializationSuccess() {
          const notification = document.createElement('div');
          notification.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-500';
          notification.innerHTML = `
            <div class="flex items-center">
              <span class="text-xl mr-2">‚úÖ</span>
              <div>
                <div class="font-semibold">Plan Seed v5 Cargado</div>
                <div class="text-sm opacity-90">Todos los sistemas operativos</div>
              </div>
            </div>
          `;
          
          document.body.appendChild(notification);
          
          // Animate in
          setTimeout(() => {
            notification.style.transform = 'translateX(0)';
          }, 100);
          
          // Auto-hide after 3 seconds
          setTimeout(() => {
            notification.style.transform = 'translateX(full)';
            setTimeout(() => notification.remove(), 500);
          }, 3000);
        }

        function showInitializationError(error) {
          const notification = document.createElement('div');
          notification.className = 'fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
          notification.innerHTML = `
            <div class="flex items-center">
              <span class="text-xl mr-2">‚ùå</span>
              <div>
                <div class="font-semibold">Error de Inicializaci√≥n</div>
                <div class="text-sm opacity-90">${error.message}</div>
              </div>
            </div>
          `;
          
          document.body.appendChild(notification);
          
          // Keep visible until clicked
          notification.onclick = () => notification.remove();
        }

        // MANTENER: Existing navigation setup
        function setupActiveNavigation() {
          window.addEventListener('scroll', () => {
            let current = '';
            document.querySelectorAll('section').forEach(section => {
              if (window.pageYOffset >= section.offsetTop - 80) {
                current = section.getAttribute('id');
              }
            });

            document.querySelectorAll('.nav-link').forEach(link => {
              link.classList.remove('active');
              if (link.getAttribute('href').includes(current)) {
                link.classList.add('active');
              }
            });
          });
        }

        // MANTENER: Existing view toggle functionality
        function setupViewToggle() {
          const vistaEjecutivaBtn = document.getElementById('vista-ejecutiva-btn');
          const vistaOperacionalBtn = document.getElementById('vista-operacional-btn');
          const executiveView = document.getElementById('executive-view-content');
          const operationalView = document.getElementById('operational-view-content');

          if (vistaEjecutivaBtn && vistaOperacionalBtn && executiveView && operationalView) {
            vistaEjecutivaBtn.addEventListener('click', () => {
              executiveView.style.display = 'block';
              operationalView.style.display = 'none';
              vistaEjecutivaBtn.classList.add('bg-teal-600', 'text-white');
              vistaEjecutivaBtn.classList.remove('text-gray-600');
              vistaOperacionalBtn.classList.remove('bg-teal-600', 'text-white');
              vistaOperacionalBtn.classList.add('text-gray-600');
            });

            vistaOperacionalBtn.addEventListener('click', () => {
              executiveView.style.display = 'none';
              operationalView.style.display = 'block';
              vistaOperacionalBtn.classList.add('bg-teal-600', 'text-white');
              vistaOperacionalBtn.classList.remove('text-gray-600');
              vistaEjecutivaBtn.classList.remove('bg-teal-600', 'text-white');
              vistaEjecutivaBtn.classList.add('text-gray-600');
            });
          }
        }
    });
    </script>
</body>
</html>
