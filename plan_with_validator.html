<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan Maestro Interactivo: Rodando a Gas - With Validator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="validate_plan.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f7f4;
            color: #1f2937;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        .nav-link {
            transition: color 0.3s, border-color 0.3s;
        }
        .nav-link:hover, .nav-link.active {
            color: #c2410c;
            border-bottom-color: #c2410c;
        }
        .kpi-card {
            background-color: #ffffff;
            border-left: 5px solid #0d9488;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header & Navigation -->
    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <span class="font-bold text-xl text-slate-800">Rodando a Gas</span>
                    <span class="ml-2 text-sm font-medium text-slate-500">Plan Maestro Interactivo - WITH VALIDATOR</span>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#tesis" class="nav-link text-gray-700 hover:text-orange-700 px-3 py-2 rounded-md text-sm font-medium border-b-2 border-transparent">Tesis</a>
                        <a href="#financiero" class="nav-link text-gray-700 hover:text-orange-700 px-3 py-2 rounded-md text-sm font-medium border-b-2 border-transparent">Financiero</a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">

        <!-- 0. Tesis de Inversi√≥n -->
        <section id="tesis" class="mb-16 scroll-mt-16">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900 mb-2">Tesis de Inversi√≥n</h1>
            <p class="text-lg text-slate-600 mb-8">Test de funcionalidades con validador incluido.</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
                <div class="kpi-card p-5 rounded-lg shadow-sm">
                    <p class="text-sm font-medium text-slate-500">Inversi√≥n Tecnol√≥gica Inicial</p>
                    <p class="text-3xl font-bold text-slate-800">$2.33M</p>
                    <p class="text-xs text-slate-400">MXN en Core IA + SaaS Cr√≠tico (32.0%)</p>
                </div>
                <div class="kpi-card p-5 rounded-lg shadow-sm">
                    <p class="text-sm font-medium text-slate-500">Ahorros Anuales vs. Tradicional</p>
                    <p class="text-3xl font-bold text-slate-800">$6.3M</p>
                    <p class="text-xs text-slate-400">MXN vs tradicional (reemplaza +20 personas)</p>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="font-bold text-xl mb-4 text-teal-800">Inversi√≥n Semilla Solicitada: $7,260,000 MXN</h3>
                <p class="text-slate-600 mb-6">Test Chart - Investment Breakdown</p>
                <div class="chart-container h-64 md:h-80 max-h-80">
                    <canvas id="investmentDonutChart"></canvas>
                </div>
            </div>
        </section>

        <!-- 1. Plan Financiero -->
        <section id="financiero" class="mb-16 scroll-mt-16">
            <h2 class="text-3xl md:text-4xl font-bold text-slate-900 mb-2">Plan Financiero (CFO View)</h2>
            <p class="text-lg text-slate-600 mb-8">Test de interacciones.</p>
            
            <div class="bg-white p-6 rounded-lg shadow-md">
                 <h3 class="font-bold text-xl mb-2 text-teal-800">Flujo de Caja y Gasto Mensual</h3>
                 <p class="text-slate-600 mb-4">Test slider functionality.</p>

                <div class="mb-8">
                    <label for="month-slider" class="block text-sm font-medium text-slate-700 mb-2">Mes: <span id="month-label" class="font-bold text-orange-600">1</span></label>
                    <input id="month-slider" type="range" min="1" max="12" value="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                </div>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8 text-center">
                    <div class="bg-slate-50 p-3 rounded-lg">
                        <p class="text-sm text-slate-500">Gasto del Mes</p>
                        <p id="kpi-gasto-mes" class="text-2xl font-bold">$300k</p>
                    </div>
                    <div class="bg-slate-50 p-3 rounded-lg">
                        <p class="text-sm text-slate-500">Gasto Acumulado</p>
                        <p id="kpi-gasto-acumulado" class="text-2xl font-bold">$300k</p>
                    </div>
                    <div class="bg-slate-50 p-3 rounded-lg">
                        <p class="text-sm text-slate-500">Efectivo Restante</p>
                        <p id="kpi-efectivo" class="text-2xl font-bold">$6.96M</p>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="financialPlanChart"></canvas>
                </div>
            </div>
        </section>

    </main>

    <!-- Test Modal -->
    <div id="agent-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                <div class="sticky top-0 bg-white border-b p-6 flex justify-between items-center">
                    <h2 id="modal-title" class="text-2xl font-bold text-slate-800">Test Modal</h2>
                    <button id="close-modal" class="text-slate-500 hover:text-slate-700 text-2xl">&times;</button>
                </div>
                <div id="modal-content" class="p-6">
                    Test modal content
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîç Starting simplified validation test...');
            
            // Test data
            const financialData = {
                labels: Array.from({ length: 12 }, (_, i) => `Mes ${i + 1}`),
                gastoEquipo: [110000, 125000, 125000, 125000, 125000, 125000, 125000, 125000, 125000, 125000, 125000, 115000],
                gastoDesarrollo: [190000, 210000, 257143, 250143, 250143, 250143, 230143, 230143, 230143, 193333, 193333, 199333],
                gastoCapex: [0, 0, 0, 0, 0, 876667, 876667, 876666, 0, 0, 0, 0],
                gastoTotal: [300000, 335000, 382143, 375143, 375143, 1251810, 1231810, 1231809, 355143, 318333, 318333, 324333],
                gastoAcumulado: [300000, 635000, 1017143, 1392286, 1767429, 3019239, 4251049, 5482858, 5837001, 6155334, 6473667, 6798000],
                efectivoRestante: [6960000, 6625000, 6242857, 5867714, 5492571, 4240761, 3008951, 1777142, 1422001, 1103668, 785335, 476002]
            };

            const investmentData = {
                labels: ['Desarrollo Core IA + SaaS', 'Inversi√≥n Piloto (CAPEX)', 'Equipo y Operaciones', 'Reserva de Emergencia'],
                datasets: [{
                    data: [2326000, 2630000, 1828000, 476000],
                    backgroundColor: ['#0d9488', '#0f766e', '#115e59', '#f59e0b'],
                    borderColor: '#f8f7f4',
                    borderWidth: 4
                }]
            };

            // Test Chart.js availability
            if (typeof Chart === 'undefined') {
                console.error('‚ùå Chart.js not loaded!');
                return;
            }
            console.log('‚úÖ Chart.js loaded successfully');

            // Investment Donut Chart
            const donutCanvas = document.getElementById('investmentDonutChart');
            if (!donutCanvas) {
                console.error('‚ùå Investment donut chart canvas not found');
            } else {
                console.log('‚úÖ Investment donut chart canvas found');
                const donutCtx = donutCanvas.getContext('2d');
                if (!donutCtx) {
                    console.error('‚ùå Cannot get 2D context for investment donut chart');
                } else {
                    try {
                        new Chart(donutCtx, {
                            type: 'doughnut',
                            data: investmentData,
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                cutout: '60%',
                                plugins: {
                                    legend: {
                                        position: 'bottom',
                                        labels: {
                                            padding: 20,
                                            font: {
                                                size: 12
                                            }
                                        }
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                let label = context.label || '';
                                                if (label) {
                                                    label += ': ';
                                                }
                                                if (context.parsed !== null) {
                                                    label += new Intl.NumberFormat('es-MX', { style: 'currency', currency: 'MXN' }).format(context.parsed);
                                                }
                                                return label;
                                            }
                                        }
                                    }
                                }
                            }
                        });
                        console.log('‚úÖ Investment donut chart created successfully');
                    } catch (error) {
                        console.error('‚ùå Error creating investment donut chart:', error);
                    }
                }
            }

            // Financial Plan Chart
            const financialCanvas = document.getElementById('financialPlanChart');
            if (!financialCanvas) {
                console.error('‚ùå Financial plan chart canvas not found');
            } else {
                console.log('‚úÖ Financial plan chart canvas found');
                const financialCtx = financialCanvas.getContext('2d');
                if (!financialCtx) {
                    console.error('‚ùå Cannot get 2D context for financial plan chart');
                } else {
                    try {
                        const financialChart = new Chart(financialCtx, {
                            type: 'bar',
                            data: {
                                labels: financialData.labels,
                                datasets: [
                                    {
                                        label: 'Gasto en Equipo',
                                        data: financialData.gastoEquipo,
                                        backgroundColor: '#14b8a6',
                                        stack: 'Stack 0',
                                    },
                                    {
                                        label: 'Gasto en Desarrollo',
                                        data: financialData.gastoDesarrollo,
                                        backgroundColor: '#0d9488',
                                        stack: 'Stack 0',
                                    },
                                    {
                                        label: 'Gasto CAPEX',
                                        data: financialData.gastoCapex,
                                        backgroundColor: '#0f766e',
                                        stack: 'Stack 0',
                                    },
                                    {
                                        label: 'Efectivo Restante',
                                        data: financialData.efectivoRestante,
                                        type: 'line',
                                        borderColor: '#f97316',
                                        backgroundColor: 'rgba(249, 115, 22, 0.1)',
                                        fill: true,
                                        yAxisID: 'y1',
                                        tension: 0.3
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                let label = context.dataset.label || '';
                                                if (label) {
                                                    label += ': ';
                                                }
                                                if (context.parsed.y !== null) {
                                                    label += new Intl.NumberFormat('es-MX', { style: 'currency', currency: 'MXN', minimumFractionDigits: 0 }).format(context.parsed.y);
                                                }
                                                return label;
                                            }
                                        }
                                    },
                                    legend: {
                                        position: 'bottom'
                                    }
                                },
                                scales: {
                                    x: {
                                        stacked: true,
                                        grid: { display: false }
                                    },
                                    y: {
                                        stacked: true,
                                        beginAtZero: true,
                                        title: {
                                            display: true,
                                            text: 'Gasto Mensual (MXN)'
                                        },
                                        ticks: {
                                            callback: value => `${value / 1000}k`
                                        }
                                    },
                                    y1: {
                                        position: 'right',
                                        beginAtZero: true,
                                        title: {
                                            display: true,
                                            text: 'Efectivo Restante (MXN)'
                                        },
                                        grid: {
                                            drawOnChartArea: false, 
                                        },
                                        ticks: {
                                            callback: value => `${value / 1000000}M`
                                        }
                                    }
                                }
                            }
                        });
                        console.log('‚úÖ Financial plan chart created successfully');
                        
                        // Test slider functionality
                        const slider = document.getElementById('month-slider');
                        const monthLabel = document.getElementById('month-label');
                        const kpiGastoMes = document.getElementById('kpi-gasto-mes');
                        const kpiGastoAcumulado = document.getElementById('kpi-gasto-acumulado');
                        const kpiEfectivo = document.getElementById('kpi-efectivo');

                        function formatCurrency(value) {
                            if (value >= 1000000) return `$${(value / 1000000).toFixed(2)}M`;
                            if (value >= 1000) return `$${(value / 1000).toFixed(0)}k`;
                            return `$${value}`;
                        }

                        function updateFinancials(month) {
                            const index = month - 1;
                            monthLabel.textContent = month;
                            kpiGastoMes.textContent = formatCurrency(financialData.gastoTotal[index]);
                            kpiGastoAcumulado.textContent = formatCurrency(financialData.gastoAcumulado[index]);
                            kpiEfectivo.textContent = formatCurrency(financialData.efectivoRestante[index]);
                        }

                        if (slider) {
                            slider.addEventListener('input', (e) => updateFinancials(parseInt(e.target.value)));
                            updateFinancials(1);
                            console.log('‚úÖ Slider functionality working');
                        } else {
                            console.error('‚ùå Slider not found');
                        }
                        
                    } catch (error) {
                        console.error('‚ùå Error creating financial plan chart:', error);
                    }
                }
            }

            // Test modal functionality
            const modal = document.getElementById('agent-modal');
            const closeModal = document.getElementById('close-modal');
            
            if (modal && closeModal) {
                closeModal.addEventListener('click', () => {
                    modal.classList.add('hidden');
                });
                console.log('‚úÖ Modal functionality working');
            } else {
                console.error('‚ùå Modal elements not found');
            }

            console.log('üéâ Validation test completed! Check the console for results.');
        });
    </script>
</body>
</html>