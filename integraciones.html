<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Integraciones - Diagrama Interactivo</title>

    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      // Tailwind config (optional custom colors)
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              slate850: '#111827',
            },
            boxShadow: {
              soft: '0 10px 25px -10px rgba(0,0,0,0.25)'
            }
          }
        }
      }
    </script>

    <style>
      /* Animación para líneas */
      @keyframes dash {
        to { stroke-dashoffset: -1000; }
      }
      .animate-dash {
        stroke-dasharray: 6 6;
        animation: dash 10s linear infinite;
      }

      /* Scrollbar sutil */
      .thin-scrollbar::-webkit-scrollbar { width: 8px; height: 8px; }
      .thin-scrollbar::-webkit-scrollbar-thumb { background: rgba(100,116,139,0.5); border-radius: 9999px; }
      .thin-scrollbar::-webkit-scrollbar-track { background: transparent; }

      /* Modal backdrop blur fallback */
      .backdrop-blur-md { backdrop-filter: blur(8px); }

      /* Mobile: el diagrama se reemplaza por lista */
      @media (max-width: 767px) {
        .diagram-desktop { display: none; }
      }
      @media (min-width: 768px) {
        .diagram-mobile { display: none; }
      }
    </style>
  </head>
  <body class="bg-slate-900 text-slate-100 min-h-screen">
    <div id="root" class="min-h-screen"></div>

    <!-- React 18 -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
      console.log('Iniciando aplicación...');

      // Verificar que React cargó
      if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
        document.addEventListener('DOMContentLoaded', function() {
          const root = document.getElementById('root');
          if (root) root.innerHTML = '<div class="p-6"><h1 class="text-2xl font-bold text-red-400">Error: React no cargó</h1><p class="text-slate-300 mt-2">Verifica tu conexión a Internet y recarga la página.</p></div>';
        });
      } else {
        const { useEffect, useMemo, useRef, useState } = React;

        // 1) DATOS Y CONSTANTES FUERA DEL COMPONENTE
        // -------------------------------------------------------------------------------------------------
        const LANES = [
          { id: 'lane-ui', name: 'Aplicaciones / UI' },
          { id: 'lane-orch', name: 'Orquestación' },
          { id: 'lane-svc', name: 'Servicios Internos' },
          { id: 'lane-prov', name: 'Proveedores Externos' },
          { id: 'lane-data', name: 'Datos y Storage' },
          { id: 'lane-analytics', name: 'Analytics / BI' }
        ];

        // Tipos de nodo: app, orchestrator, service, provider, db, analytics
        const COLORS = {
          app: {
            bg: 'from-indigo-500/20 to-indigo-700/20',
            ring: 'ring-indigo-500/40',
            text: 'text-indigo-200'
          },
          orchestrator: {
            bg: 'from-violet-500/20 to-fuchsia-600/20',
            ring: 'ring-violet-500/40',
            text: 'text-violet-200'
          },
          service: {
            bg: 'from-emerald-500/20 to-teal-600/20',
            ring: 'ring-emerald-500/40',
            text: 'text-emerald-200'
          },
          provider: {
            bg: 'from-amber-500/20 to-orange-600/20',
            ring: 'ring-amber-500/40',
            text: 'text-amber-200'
          },
          db: {
            bg: 'from-sky-500/20 to-blue-600/20',
            ring: 'ring-sky-500/40',
            text: 'text-sky-200'
          },
          analytics: {
            bg: 'from-pink-500/20 to-rose-600/20',
            ring: 'ring-pink-500/40',
            text: 'text-pink-200'
          }
        };

        const TOOL_DETAILS = {
          metamap: {
            title: 'MetaMap (KYC)',
            description: 'Proveedor KYC para verificación de identidad y validaciones documentales.',
            link: 'https://www.metamap.com',
            inputs: ['Datos de identificación', 'Selfie', 'Documento'],
            outputs: ['Resultado KYC', 'Riesgos', 'Evidencias']
          },
          mifiel: {
            title: 'Mifiel (Firma electrónica)',
            description: 'Firma electrónica avanzada de contratos y documentos.',
            link: 'https://www.mifiel.com',
            inputs: ['Documento PDF', 'Datos del firmante'],
            outputs: ['Documento firmado', 'Evidencias de firma']
          },
          stripe: {
            title: 'Stripe (Pagos)',
            description: 'Procesamiento de pagos y cobros.',
            link: 'https://stripe.com',
            inputs: ['Intención de pago', 'Datos tarjeta'],
            outputs: ['Pago confirmado', 'Eventos Webhook']
          },
          bank: {
            title: 'Banco (Desembolso)',
            description: 'Desembolso de fondos a cuentas bancarias.',
            link: 'https://www.example-bank.com',
            inputs: ['Cuenta destino', 'Monto', 'Referencia'],
            outputs: ['Transferencia enviada', 'Comprobante']
          },
          metabase: {
            title: 'Metabase (BI)',
            description: 'Exploración y visualización de datos.',
            link: 'https://www.metabase.com',
            inputs: ['Tablas transaccionales'],
            outputs: ['Dashboards', 'Consultas']
          }
        };

        const NODES = [
          // UI
          { id: 'app-mobile', label: 'App Conductores', laneId: 'lane-ui', col: 1, type: 'app', toolKey: null, inputs: ['Eventos UI'], outputs: ['Solicitudes API'] },
          { id: 'app-admin', label: 'Admin Web', laneId: 'lane-ui', col: 2, type: 'app', toolKey: null, inputs: ['Gestión'], outputs: ['Solicitudes API'] },

          // Orchestrator
          { id: 'orchestrator', label: 'Orquestador', laneId: 'lane-orch', col: 2, type: 'orchestrator', toolKey: null, inputs: ['Eventos', 'Webhooks'], outputs: ['Jobs', 'Notificaciones'] },

          // Services
          { id: 'api-core', label: 'Core API', laneId: 'lane-svc', col: 3, type: 'service', toolKey: null, inputs: ['HTTP'], outputs: ['Negocio', 'Persistencia'] },
          { id: 'svc-kyc', label: 'KYC Service', laneId: 'lane-svc', col: 4, type: 'service', toolKey: null, inputs: ['Datos usuario'], outputs: ['Estado KYC'] },
          { id: 'svc-sign', label: 'Firma Service', laneId: 'lane-svc', col: 5, type: 'service', toolKey: null, inputs: ['Contrato'], outputs: ['Documento firmado'] },
          { id: 'svc-pay', label: 'Pagos Service', laneId: 'lane-svc', col: 6, type: 'service', toolKey: null, inputs: ['Intención de pago'], outputs: ['Recibo'] },

          // Providers
          { id: 'prov-metamap', label: 'MetaMap', laneId: 'lane-prov', col: 4, type: 'provider', toolKey: 'metamap', inputs: ['Datos + docs'], outputs: ['Resultado KYC'] },
          { id: 'prov-mifiel', label: 'Mifiel', laneId: 'lane-prov', col: 5, type: 'provider', toolKey: 'mifiel', inputs: ['PDF + firmante'], outputs: ['PDF firmado'] },
          { id: 'prov-stripe', label: 'Stripe', laneId: 'lane-prov', col: 6, type: 'provider', toolKey: 'stripe', inputs: ['Tarjeta + monto'], outputs: ['Pago OK / fallo'] },
          { id: 'prov-bank', label: 'Banco', laneId: 'lane-prov', col: 6, type: 'provider', toolKey: 'bank', inputs: ['Cuenta + monto'], outputs: ['Transferencia'] },

          // Data
          { id: 'db-users', label: 'Usuarios DB', laneId: 'lane-data', col: 2, type: 'db', toolKey: null, inputs: ['Insert/Update'], outputs: ['Selects'] },
          { id: 'db-tx', label: 'Transacciones DB', laneId: 'lane-data', col: 3, type: 'db', toolKey: null, inputs: ['Insert'], outputs: ['Consultas'] },

          // Analytics
          { id: 'bi-metabase', label: 'Metabase', laneId: 'lane-analytics', col: 3, type: 'analytics', toolKey: 'metabase', inputs: ['Datos'], outputs: ['Dashboards'] },
        ];

        const FLOWS = {
          All: { name: 'Todos', edges: [] },
          Onboarding: { name: 'Onboarding', edges: ['e1','e2','e3','e4','e11'] },
          Desembolso: { name: 'Desembolso', edges: ['e5','e6','e7'] },
          Cobro: { name: 'Cobro', edges: ['e8','e9'] },
          Analytics: { name: 'Analytics', edges: ['e10','e11'] }
        };

        // Conexiones (edges). Los IDs se usan en FLOWS.
        const EDGES = [
          { id: 'e1', from: 'app-mobile', to: 'api-core' },
          { id: 'e2', from: 'api-core', to: 'svc-kyc' },
          { id: 'e3', from: 'svc-kyc', to: 'prov-metamap' },
          { id: 'e4', from: 'api-core', to: 'svc-sign' },
          { id: 'e5', from: 'api-core', to: 'svc-pay' },
          { id: 'e6', from: 'svc-pay', to: 'prov-bank' },
          { id: 'e7', from: 'svc-pay', to: 'prov-stripe' },
          { id: 'e8', from: 'app-admin', to: 'api-core' },
          { id: 'e9', from: 'orchestrator', to: 'api-core' },
          { id: 'e10', from: 'db-tx', to: 'bi-metabase' },
          { id: 'e11', from: 'db-users', to: 'bi-metabase' },
        ];

        console.log('NODES definidos:', NODES.length);
        console.log('LANES definidos:', LANES.length);

        // 2) ICONOS INLINE (sin Lucide)
        // -------------------------------------------------------------------------------------------------
        const Icons = {
          Layers: () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
              <path d="M12 2L2 7l10 5 10-5-10-5z" />
              <path d="M2 12l10 5 10-5" />
              <path d="M2 17l10 5 10-5" />
            </svg>
          ),
          Link: () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
              <path d="M10 13a5 5 0 0 0 7 0l3-3a5 5 0 1 0-7-7l-1 1" />
              <path d="M14 11a5 5 0 0 0-7 0l-3 3a5 5 0 1 0 7 7l1-1" />
            </svg>
          ),
          Info: () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
              <circle cx="12" cy="12" r="10" />
              <line x1="12" y1="16" x2="12" y2="12" />
              <line x1="12" y1="8" x2="12.01" y2="8" />
            </svg>
          ),
          Close: () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          ),
          Node: () => (
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <circle cx="12" cy="12" r="6" />
            </svg>
          )
        };

        // 3) HELPERS
        // -------------------------------------------------------------------------------------------------
        function classNames(...parts) {
          return parts.filter(Boolean).join(' ');
        }

        function getNodeById(id) {
          return NODES.find(n => n.id === id);
        }

        function getColorClassesForType(type) {
          const c = COLORS[type] || COLORS.service;
          return {
            bg: `bg-gradient-to-br ${c.bg}`,
            ring: c.ring,
            text: c.text
          };
        }

        function useResizeObserver(targetRef, onResize) {
          useEffect(() => {
            if (!targetRef.current) return;
            const ro = new ResizeObserver(() => onResize());
            ro.observe(targetRef.current);
            window.addEventListener('resize', onResize);
            return () => {
              ro.disconnect();
              window.removeEventListener('resize', onResize);
            };
          }, [targetRef, onResize]);
        }

        // 4) COMPONENTE PRINCIPAL
        // -------------------------------------------------------------------------------------------------
        function ConductoresIntegrationsMap() {
          const containerRef = useRef(null);
          const nodeRefs = useRef({});

          const [hiddenLaneIds, setHiddenLaneIds] = useState(new Set());
          const [selectedFlowKey, setSelectedFlowKey] = useState('All');
          const [edgePositions, setEdgePositions] = useState([]); // {id, x1,y1,x2,y2}
          const [selectedNodeId, setSelectedNodeId] = useState(null);
          const [modalToolKey, setModalToolKey] = useState(null);

          const lanesVisible = useMemo(() => LANES.filter(l => !hiddenLaneIds.has(l.id)), [hiddenLaneIds]);

          const nodesByLane = useMemo(() => {
            const map = new Map();
            LANES.forEach(l => map.set(l.id, []));
            for (const n of NODES) {
              if (!map.has(n.laneId)) map.set(n.laneId, []);
              map.get(n.laneId).push(n);
            }
            for (const [, arr] of map) arr.sort((a,b) => a.col - b.col);
            return map;
          }, []);

          const highlightedEdgeIds = useMemo(() => {
            const flow = FLOWS[selectedFlowKey];
            if (!flow || selectedFlowKey === 'All') return new Set(EDGES.map(e => e.id));
            return new Set(flow.edges);
          }, [selectedFlowKey]);

          function recomputeEdges() {
            const container = containerRef.current;
            if (!container) return;
            const crect = container.getBoundingClientRect();
            const next = [];
            for (const e of EDGES) {
              const fromEl = nodeRefs.current[e.from];
              const toEl = nodeRefs.current[e.to];
              if (!fromEl || !toEl) continue;
              const fr = fromEl.getBoundingClientRect();
              const tr = toEl.getBoundingClientRect();
              const x1 = fr.right - crect.left; // desde el centro derecho del from
              const y1 = fr.top + fr.height / 2 - crect.top;
              const x2 = tr.left - crect.left; // hacia el centro izquierdo del to
              const y2 = tr.top + tr.height / 2 - crect.top;
              next.push({ id: e.id, x1, y1, x2, y2 });
            }
            setEdgePositions(next);
          }

          useEffect(() => {
            // Recompute on first paint
            const t = setTimeout(recomputeEdges, 0);
            return () => clearTimeout(t);
          }, [selectedFlowKey, hiddenLaneIds]);

          useResizeObserver(containerRef, recomputeEdges);

          function toggleLaneVisibility(laneId) {
            setHiddenLaneIds(prev => {
              const next = new Set(prev);
              if (next.has(laneId)) next.delete(laneId); else next.add(laneId);
              return next;
            });
          }

          function onNodeClick(node) {
            setSelectedNodeId(node.id);
            if (node.toolKey) setModalToolKey(node.toolKey);
          }

          const selectedNode = useMemo(
            () => NODES.find(n => n.id === selectedNodeId) || null,
            [selectedNodeId]
          );

          // Mobile list rendering (simple)
          function MobileList() {
            return (
              <div className="diagram-mobile p-4 space-y-4">
                <div className="flex items-center gap-2">
                  <Icons.Layers />
                  <h2 className="text-lg font-semibold">Diagrama (vista móvil)</h2>
                </div>
                {lanesVisible.map(lane => (
                  <div key={lane.id} className="bg-slate-800/60 rounded-xl p-3 border border-slate-700/60">
                    <div className="flex items-center justify-between mb-2">
                      <h3 className="font-semibold text-slate-200">{lane.name}</h3>
                      <span className="text-xs text-slate-400">{(nodesByLane.get(lane.id) || []).length} nodos</span>
                    </div>
                    <div className="grid grid-cols-1 gap-2">
                      {(nodesByLane.get(lane.id) || []).map(node => (
                        <NodeCard key={node.id} node={node} onClick={() => onNodeClick(node)} />
                      ))}
                    </div>
                  </div>
                ))}
              </div>
            );
          }

          function DesktopDiagram() {
            return (
              <div ref={containerRef} className="diagram-desktop relative">
                {/* SVG de conexiones */}
                <svg className="absolute inset-0 w-full h-full pointer-events-none" xmlns="http://www.w3.org/2000/svg">
                  {edgePositions.map(edge => {
                    // Ocultar si algún extremo es de un lane oculto
                    const fromNode = getNodeById(EDGES.find(e => e.id === edge.id).from);
                    const toNode = getNodeById(EDGES.find(e => e.id === edge.id).to);
                    if (hiddenLaneIds.has(fromNode.laneId) || hiddenLaneIds.has(toNode.laneId)) return null;

                    const isHighlighted = highlightedEdgeIds.has(edge.id);

                    // Curva suave: control points en tercio
                    const cx1 = edge.x1 + Math.max(40, (edge.x2 - edge.x1) / 3);
                    const cy1 = edge.y1;
                    const cx2 = edge.x2 - Math.max(40, (edge.x2 - edge.x1) / 3);
                    const cy2 = edge.y2;

                    const d = `M ${edge.x1},${edge.y1} C ${cx1},${cy1} ${cx2},${cy2} ${edge.x2},${edge.y2}`;

                    return (
                      <path
                        key={edge.id}
                        d={d}
                        fill="none"
                        stroke={isHighlighted ? 'rgba(125,211,252,0.9)' : 'rgba(100,116,139,0.5)'}
                        strokeWidth={isHighlighted ? 2.5 : 1.5}
                        className={classNames('transition-opacity duration-500', isHighlighted ? 'opacity-100 animate-dash' : 'opacity-60')}
                      />
                    );
                  })}
                </svg>

                {/* Lanes (filas) */}
                <div className="space-y-4">
                  {lanesVisible.map(lane => (
                    <div key={lane.id} className="">
                      <div className="flex items-center gap-2 mb-2 pl-1">
                        <button
                          onClick={() => toggleLaneVisibility(lane.id)}
                          className="text-xs px-2 py-1 rounded-md bg-slate-800/80 hover:bg-slate-700/70 border border-slate-700 text-slate-300"
                          title="Ocultar lane"
                        >
                          {hiddenLaneIds.has(lane.id) ? 'Mostrar' : 'Ocultar'}
                        </button>
                        <h3 className="text-sm font-semibold text-slate-200">{lane.name}</h3>
                      </div>
                      <div className="grid grid-cols-6 gap-4">
                        {(nodesByLane.get(lane.id) || []).map(node => (
                          <div key={node.id} style={{ gridColumnStart: node.col, gridColumnEnd: 'span 1' }}>
                            <NodeCard node={node} onClick={() => onNodeClick(node)} refCb={(el) => nodeRefs.current[node.id] = el} />
                          </div>
                        ))}
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            );
          }

          return (
            <div className="max-w-7xl mx-auto px-4 py-6">
              {/* Header */}
              <div className="flex items-center justify-between mb-6">
                <div className="flex items-center gap-3">
                  <div className="p-2 rounded-lg bg-slate-800 border border-slate-700">
                    <Icons.Layers />
                  </div>
                  <div>
                    <h1 className="text-xl md:text-2xl font-bold">Mapa de Integraciones</h1>
                    <p className="text-slate-400 text-sm">Diagrama interactivo de arquitectura y flujos</p>
                  </div>
                </div>
                <a
                  href="#"
                  className="hidden md:inline-flex items-center gap-2 text-xs px-3 py-1.5 rounded-md border border-slate-700 bg-slate-800 hover:bg-slate-700 text-slate-200"
                  onClick={(e) => { e.preventDefault(); alert('Este es un prototipo en un solo archivo HTML.'); }}
                >
                  <Icons.Info />
                  Acerca de
                </a>
              </div>

              {/* Controles */}
              <div className="bg-slate-800/70 border border-slate-700 rounded-xl p-4 mb-6">
                <div className="flex flex-col md:flex-row gap-4 md:items-center md:justify-between">
                  <div className="flex items-center gap-3">
                    <label htmlFor="flow" className="text-sm text-slate-300">Flujo</label>
                    <select
                      id="flow"
                      value={selectedFlowKey}
                      onChange={(e) => setSelectedFlowKey(e.target.value)}
                      className="bg-slate-900/70 text-slate-100 text-sm rounded-md border border-slate-700 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-500"
                    >
                      {Object.keys(FLOWS).map(key => (
                        <option key={key} value={key}>{FLOWS[key].name}</option>
                      ))}
                    </select>
                  </div>

                  <div className="flex flex-wrap gap-2">
                    {LANES.map(l => (
                      <button
                        key={l.id}
                        onClick={() => toggleLaneVisibility(l.id)}
                        className={classNames(
                          'text-xs px-2.5 py-1.5 rounded-md border',
                          hiddenLaneIds.has(l.id)
                            ? 'bg-slate-900 text-slate-400 border-slate-700'
                            : 'bg-slate-700/60 text-slate-100 border-slate-600 hover:bg-slate-600/60'
                        )}
                        title={hiddenLaneIds.has(l.id) ? 'Mostrar lane' : 'Ocultar lane'}
                      >
                        {l.name}
                      </button>
                    ))}
                  </div>
                </div>
              </div>

              {/* Diagrama desktop */}
              <div className="diagram-desktop relative bg-slate-900/60 rounded-2xl border border-slate-800 p-4 overflow-hidden">
                <DesktopDiagram />
              </div>

              {/* Vista móvil simplificada */}
              <div className="diagram-mobile">
                <MobileList />
              </div>

              {/* Inspector */}
              <Inspector node={selectedNode} onClose={() => setSelectedNodeId(null)} />

              {/* Modal de herramienta */}
              {modalToolKey && (
                <ToolModal toolKey={modalToolKey} onClose={() => setModalToolKey(null)} />
              )}
            </div>
          );
        }

        // 5) SUBCOMPONENTES
        // -------------------------------------------------------------------------------------------------
        function NodeCard({ node, onClick, refCb }) {
          const c = getColorClassesForType(node.type);
          return (
            <div
              ref={refCb}
              onClick={onClick}
              className={classNames(
                'group cursor-pointer select-none rounded-xl border p-3 shadow-soft transition transform hover:-translate-y-0.5 hover:shadow-xl',
                'backdrop-blur-md',
                c.bg, c.ring, 'border-slate-700/60'
              )}
            >
              <div className="flex items-start justify-between gap-2">
                <div className="flex items-center gap-2">
                  <div className={classNames('p-1.5 rounded-lg bg-slate-900/40', c.ring)}>
                    <Icons.Node />
                  </div>
                  <div>
                    <div className={classNames('text-sm font-semibold leading-tight', c.text)}>{node.label}</div>
                    <div className="text-[11px] text-slate-300/80">{node.type}</div>
                  </div>
                </div>
                {node.toolKey && (
                  <span className="text-[10px] px-2 py-1 bg-slate-900/40 border border-slate-700/60 rounded-full text-slate-300">tool</span>
                )}
              </div>
              <div className="mt-2 flex items-center gap-2 text-[11px] text-slate-300/80">
                <Icons.Link />
                <span>{(node.inputs?.length || 0)} inputs</span>
                <span>·</span>
                <span>{(node.outputs?.length || 0)} outputs</span>
              </div>
            </div>
          );
        }

        function Inspector({ node, onClose }) {
          if (!node) return null;
          return (
            <div className="mt-6 bg-slate-800/70 border border-slate-700 rounded-xl p-4">
              <div className="flex items-center justify-between">
                <h3 className="text-sm font-semibold text-slate-200">Inspector de Nodo</h3>
                <button onClick={onClose} className="text-slate-300 hover:text-white text-sm">Cerrar</button>
              </div>
              <div className="mt-3 grid md:grid-cols-3 gap-4 text-sm">
                <div>
                  <div className="text-slate-400">Etiqueta</div>
                  <div className="font-medium">{node.label}</div>
                </div>
                <div>
                  <div className="text-slate-400">Tipo</div>
                  <div className="font-medium">{node.type}</div>
                </div>
                <div>
                  <div className="text-slate-400">Lane</div>
                  <div className="font-medium">{LANES.find(l => l.id === node.laneId)?.name || node.laneId}</div>
                </div>
              </div>
              <div className="mt-4 grid md:grid-cols-2 gap-4">
                <div className="bg-slate-900/40 border border-slate-700/60 rounded-lg p-3">
                  <div className="text-slate-300 text-xs mb-1">Inputs</div>
                  <ul className="list-disc list-inside text-slate-200 text-sm">
                    {(node.inputs || []).map((it, idx) => (
                      <li key={idx}>{it}</li>
                    ))}
                  </ul>
                </div>
                <div className="bg-slate-900/40 border border-slate-700/60 rounded-lg p-3">
                  <div className="text-slate-300 text-xs mb-1">Outputs</div>
                  <ul className="list-disc list-inside text-slate-200 text-sm">
                    {(node.outputs || []).map((it, idx) => (
                      <li key={idx}>{it}</li>
                    ))}
                  </ul>
                </div>
              </div>
              {node.toolKey && TOOL_DETAILS[node.toolKey] && (
                <div className="mt-4">
                  <a
                    href={TOOL_DETAILS[node.toolKey].link}
                    target="_blank"
                    rel="noreferrer"
                    className="inline-flex items-center gap-2 text-xs px-3 py-1.5 rounded-md border border-sky-600/40 bg-sky-900/20 text-sky-200 hover:bg-sky-900/30"
                  >
                    <Icons.Link />
                    Ver herramienta: {TOOL_DETAILS[node.toolKey].title}
                  </a>
                </div>
              )}
            </div>
          );
        }

        function ToolModal({ toolKey, onClose }) {
          const tool = TOOL_DETAILS[toolKey];
          if (!tool) return null;
          return (
            <div className="fixed inset-0 z-[100] flex items-center justify-center p-4">
              <div className="absolute inset-0 bg-slate-900/70 backdrop-blur-md" onClick={onClose} />
              <div className="relative w-full max-w-lg bg-slate-900 border border-slate-700 rounded-2xl p-5 shadow-xl">
                <div className="flex items-start justify-between">
                  <div>
                    <div className="text-sm text-slate-300">Detalle de herramienta</div>
                    <h3 className="text-lg font-semibold text-white">{tool.title}</h3>
                  </div>
                  <button
                    onClick={onClose}
                    className="p-2 rounded-lg bg-slate-800 hover:bg-slate-700 border border-slate-700 text-slate-200"
                    aria-label="Cerrar"
                  >
                    <Icons.Close />
                  </button>
                </div>
                <p className="mt-3 text-slate-300 text-sm">{tool.description}</p>
                <div className="mt-4 grid md:grid-cols-2 gap-3">
                  <div className="bg-slate-800/70 p-3 rounded-lg border border-slate-700">
                    <div className="text-xs text-slate-300 mb-1">Inputs</div>
                    <ul className="list-disc list-inside text-sm text-slate-100">
                      {tool.inputs.map((x, i) => <li key={i}>{x}</li>)}
                    </ul>
                  </div>
                  <div className="bg-slate-800/70 p-3 rounded-lg border border-slate-700">
                    <div className="text-xs text-slate-300 mb-1">Outputs</div>
                    <ul className="list-disc list-inside text-sm text-slate-100">
                      {tool.outputs.map((x, i) => <li key={i}>{x}</li>)}
                    </ul>
                  </div>
                </div>
                <div className="mt-4">
                  <a
                    href={tool.link}
                    target="_blank"
                    rel="noreferrer"
                    className="inline-flex items-center gap-2 text-xs px-3 py-1.5 rounded-md border border-slate-600 bg-slate-800 text-slate-200 hover:bg-slate-700"
                  >
                    <Icons.Link />
                    Visitar sitio
                  </a>
                </div>
              </div>
            </div>
          );
        }

        // 6) RENDER
        // -------------------------------------------------------------------------------------------------
        const root = document.getElementById('root');
        const rootContainer = ReactDOM.createRoot(root);
        rootContainer.render(<ConductoresIntegrationsMap />);
      }
    </script>
  </body>
</html>
