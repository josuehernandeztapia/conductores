<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Arquitectura de Integraciones</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* Cross-browser scroll container */
    .diagram-scroll-container {
      width: 100%;
      height: calc(100vh - 250px);
      overflow-x: scroll !important;
      overflow-y: auto;
      position: relative;

      /* Firefox */
      scrollbar-width: thin;
      scrollbar-color: #475569 #1e293b;

      /* Safari/WebKit */
      -webkit-overflow-scrolling: touch !important;
    }

    /* Chrome/Edge WebKit scrollbars */
    .diagram-scroll-container::-webkit-scrollbar {
      width: 14px;
      height: 14px;
    }
    .diagram-scroll-container::-webkit-scrollbar-track {
      background: #1e293b;
      border-radius: 4px;
    }
    .diagram-scroll-container::-webkit-scrollbar-thumb {
      background: #475569;
      border-radius: 4px;
      border: 2px solid #1e293b;
    }
    .diagram-scroll-container::-webkit-scrollbar-corner {
      background: #1e293b;
    }

    /* Inner canvas to force horizontal scrolling */
    .diagram-inner-canvas {
      min-width: 2400px !important;
      width: max-content;
      padding-bottom: 50px;
      position: relative;
      display: block;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.8; transform: scale(1.02); }
    }

    /* Headers sticky mejorados */
    .column-headers {
      position: sticky;
      top: 60px;
      z-index: 25;
      background: linear-gradient(to bottom, 
        rgba(15, 23, 42, 0.98) 0%, 
        rgba(15, 23, 42, 0.95) 90%,
        transparent 100%);
      backdrop-filter: blur(10px);
    }
  </style>

</head>
<body class="bg-slate-950">
  <div id="root"></div>

  <script type="text/babel">
    const { useMemo, useState, useEffect } = React;
    // Icon placeholders (lucide-react no UMD en navegador)
    const PlaceholderIcon = ({ className }) => <span className={className} style={{ display: 'inline-block' }}>‚óè</span>;
    const Layers = ({ className }) => <span className={className}>‚¨¢</span>;
    const PlayCircle = ({ className }) => <span className={className}>‚ñ∂</span>;
    const ArrowRightLeft = ({ className }) => <span className={className}>‚áÑ</span>;
    const ShieldCheck = ({ className }) => <span className={className}>üõ°</span>;
    const Cable = ({ className }) => <span className={className}>üîå</span>;
    const Users = ({ className }) => <span className={className}>üë•</span>;
    const ServerCog = ({ className }) => <span className={className}>‚öô</span>;
    const Database = ({ className }) => <span className={className}>üíæ</span>;
    const BarChart3 = ({ className }) => <span className={className}>üìä</span>;
    const FileSignature = ({ className }) => <span className={className}>‚úç</span>;
    const CreditCard = ({ className }) => <span className={className}>üí≥</span>;
    const MessageSquare = ({ className }) => <span className={className}>üí¨</span>;
    const Fuel = ({ className }) => <span className={className}>‚õΩ</span>;
    const Bot = ({ className }) => <span className={className}>ü§ñ</span>;
    const Zap = ({ className }) => <span className={className}>‚ö°</span>;
    const AlertTriangle = ({ className }) => <span className={className}>‚ö†</span>;
    const Workflow = ({ className }) => <span className={className}>‚öô</span>;
    const GitBranch = ({ className }) => <span className={className}>üîÄ</span>;

    const LANE_WIDTH = 320;
    const LANE_GAP = 28;
    const ROW_HEIGHT = 132;
    const CARD_W = 290;
    const CARD_H = 86;
    const PADDING_X = 24;
    const PADDING_Y = 96;

    const COLORS = {
      external: "from-sky-500/20 to-sky-400/10 border-sky-400/40",
      internal: "from-emerald-500/20 to-emerald-400/10 border-emerald-400/40",
      data: "from-fuchsia-500/20 to-fuchsia-400/10 border-fuchsia-400/40",
      orchestration: "from-amber-500/20 to-amber-400/10 border-amber-400/40",
      telematics: "from-cyan-500/20 to-cyan-400/10 border-cyan-400/40",
      front: "from-teal-500/20 to-teal-400/10 border-teal-400/40",
    };

    const LANES = [
      { id: "front", title: "Fronts / Canales", icon: <Layers className="w-4 h-4" /> },
      { id: "orchestration", title: "Orquestaci√≥n (iPaaS)", icon: <Workflow className="w-4 h-4" /> },
      { id: "external", title: "Servicios Externos (SaaS / Partners)", icon: <Cable className="w-4 h-4" /> },
      { id: "telematics", title: "Telem√°tica / Operaci√≥n", icon: <ServerCog className="w-4 h-4" /> },
      { id: "internal", title: "Plataforma Interna (Core)", icon: <Users className="w-4 h-4" /> },
      { id: "data", title: "Datos, IA y BI", icon: <Database className="w-4 h-4" /> },
    ];

    const NODES = [
      {
        id: "portal",
        lane: "front",
        row: 0,
        title: "Portal Cliente (Web/App)",
        subtitle: "Onboarding + Panel b√°sico",
        type: "front",
        icon: <PlayCircle className="w-4 h-4" />,
        io: {
          in: ["Links Mifiel / Pago", "Mensajes Asistente"],
          out: ["Datos KYC", "Documentos", "Eventos UI"],
        },
        ficha: {
          proceso: "Canal digital (Web/App) de onboarding y postventa",
          costo: "N/A (propio)",
          justificacion: "Punto de entrada del cliente; integra KYC (Metamap), pagos (Conekta) y firma (Mifiel) v√≠a iPaaS para cerrar el contrato sin fricci√≥n."
        }
      },
      {
        id: "whatsapp",
        lane: "front",
        row: 1,
        title: "WhatsApp Asistente (Flowise)",
        subtitle: "Soporte y postventa",
        type: "front",
        icon: <MessageSquare className="w-4 h-4" />,
        io: {
          in: ["Alertas PMA/PIA", "Recordatorios pago"],
          out: ["Respuestas cliente", "Tickets postventa"],
        },
        ficha: {
          proceso: "Comunicaciones (CPaaS) & Desarrollo Low-Code de IA",
          costo: "~$0.005 USD / mensaje (Twilio) + Tarifa de Meta | Costo de Infraestructura + APIs LLM (Flowise)",
          justificacion: "Es la columna vertebral de nuestros agentes PIA y Asistente Digital. Usamos el canal nativo del operador (WhatsApp) y Flowise como la plataforma visual donde nuestro equipo construye, prueba y despliega r√°pidamente nuestros agentes conversacionales."
        }
      },
      {
        id: "ipaas",
        lane: "orchestration",
        row: 0,
        title: "Make / n8n / Zapier",
        subtitle: "Flujos y conectores",
        type: "orchestration",
        icon: <GitBranch className="w-4 h-4" />,
        io: {
          in: ["Webhooks Samsara/Conekta", "Eventos Portal"],
          out: ["Acciones en Odoo/Airtable", "Notificaciones Asistente"],
        },
        ficha: {
          proceso: "Orquestaci√≥n y Automatizaci√≥n (iPaaS)",
          costo: "$30k MXN / a√±o (Presupuestado)",
          justificacion: "El 'Pegamento Digital'. Conecta todas nuestras APIs externas (Conekta, Samsara, Mifiel) con nuestros sistemas internos (Odoo, Agentes IA). Nos permite automatizar flujos en horas, no semanas."
        }
      },
      {
        id: "metamap",
        lane: "external",
        row: 0,
        title: "Metamap (KYC)",
        subtitle: "INE/CURP/biometr√≠a",
        type: "external",
        icon: <ShieldCheck className="w-4 h-4" />,
        io: {
          in: ["Datos del solicitante"],
          out: ["Resultado KYC", "Pruebas biom√©tricas"],
        },
        ficha: {
          proceso: "Onboarding y Verificaci√≥n (KYC)",
          costo: "$1 - $2.50 USD / verificaci√≥n",
          justificacion: "Prevenci√≥n de Fraude. Valida la identidad del operador (INE, biometr√≠a) antes de firmar. Es nuestro primer filtro de seguridad."
        }
      },
      {
        id: "kiban",
        lane: "external",
        row: 1,
        title: "KIBAN ‚Üî C√≠rculo de Cr√©dito",
        subtitle: "Consulta y Reporte",
        type: "external",
        icon: <BarChart3 className="w-4 h-4" />,
        io: {
          in: ["Identificadores solicitante", "Estado de cuenta (opcional)", "Eventos de pago"],
          out: ["Reporte de cr√©dito (consulta)", "Estatus de env√≠o (reporte mensual)"]
        },
        ficha: {
          proceso: "Acelerador de Cr√©dito y Cumplimiento",
          costo: "~$30,000 - $40,000 MXN / mes",
          justificacion: "Eficiencia Regulatoria. Lo usamos como un 'plug-in' para dos tareas complejas: consultar el historial del Bur√≥/C√≠rculo de Cr√©dito (como un input para HASE) y automatizar el reporte mensual de nuestra cartera, quit√°ndonos una carga de cumplimiento masiva."
        }
      },
      {
        id: "mifiel",
        lane: "external",
        row: 2,
        title: "Mifiel",
        subtitle: "Firma electr√≥nica avanzada",
        type: "external",
        icon: <FileSignature className="w-4 h-4" />,
        io: {
          in: ["Contrato generado (PDF)", "Datos firmantes"],
          out: ["Evidencia y hash", "Webhook de estatus"],
        },
        ficha: {
          proceso: "Firma Electr√≥nica de Contratos",
          costo: "~$15 - $90 MXN / contrato",
          justificacion: "Certeza Jur√≠dica. Para firmar el contrato de arrendamiento y la daci√≥n en pago con validez legal irrefutable en M√©xico (NOM-151 y e.firma). Es el pilar de nuestra cartera de activos."
        }
      },
      {
        id: "conekta",
        lane: "external",
        row: 3,
        title: "Conekta",
        subtitle: "Cobros (tarjeta / OXXO)",
        type: "external",
        icon: <CreditCard className="w-4 h-4" />,
        io: {
          in: ["Orden de pago", "Referencia OXXO"],
          out: ["Webhook pago/fracaso/refund", "Liquidaciones"],
        },
        ficha: {
          proceso: "Procesamiento de Pagos",
          costo: "~3.4% + $3 MXN (tarjeta) | ~2.6% + $3 MXN (efectivo)",
          justificacion: "Flujo de Caja. Su red de pagos en efectivo es indispensable para nuestro mercado no bancarizado."
        }
      },
      {
        id: "gnv",
        lane: "external",
        row: 4,
        title: "APIs Estaciones GNV",
        subtitle: "Consumo / Carga",
        type: "external",
        icon: <Fuel className="w-4 h-4" />,
        io: {
          in: ["ID unidad / tag"],
          out: ["Volumen/importe/estaci√≥n", "Timestamp"],
        },
        ficha: {
          proceso: "Consumo de GNV y recaudo autom√°tico",
          costo: "Variable por estaci√≥n (no consolidado)",
          justificacion: "Habilita el esquema 'se paga solo' aplicando recaudo autom√°tico del ahorro de combustible y alimenta PMA/BI con h√°bitos de carga."
        }
      },
      {
        id: "samsara",
        lane: "telematics",
        row: 0,
        title: "Samsara (VG55 / EI21)",
        subtitle: "GPS, OBD-II, C√≥digos falla, Inmovilizador",
        type: "telematics",
        icon: <Zap className="w-4 h-4" />,
        io: {
          in: ["Config / tags", "√ìrdenes de inmovilizaci√≥n"],
          out: [
            "Ubicaci√≥n/velocidad/RPM",
            "C√≥digos DTC y DVIR",
            "Webhooks eventos",
          ],
        },
        ficha: {
          proceso: "Telem√°tica e IoT",
          costo: "$100-150 USD / hardware (√∫nico) | $20-40 USD / mes (incluye datos)",
          justificacion: "Generaci√≥n de Datos. Es el 'sistema nervioso' de nuestras vagonetas. Nos provee los datos del OBD-II para alimentar a HASE y Super-PMA y la capacidad de paro de motor remoto nativa."
        }
      },
      {
        id: "odoo",
        lane: "internal",
        row: 0,
        title: "Odoo (ERP / CRM / Field Service)",
        subtitle: "Clientes, contratos, cartera, servicios",
        type: "internal",
        icon: <ArrowRightLeft className="w-4 h-4" />,
        io: {
          in: [
            "Resultado KYC/Cr√©dito",
            "Webhook firma y pagos",
            "Alertas PMA/PIA",
          ],
          out: [
            "Contrato (PDF)",
            "Facturas / estados de cuenta",
            "√ìrdenes de servicio",
          ],
        },
        ficha: {
          proceso: "ERP y Core Operativo",
          costo: "~$274 MXN / usuario / mes (Plan Personalizado)",
          justificacion: "El Coraz√≥n de la Operaci√≥n. Es nuestro 'sistema operativo central' con m√≥dulos nativos de Inventario, Servicios y CRM dise√±ados para la complejidad de nuestra postventa. Su API externa es indispensable para que nuestra IA se comunique con la operaci√≥n."
        }
      },
      {
        id: "airtable",
        lane: "internal",
        row: 1,
        title: "Airtable (Ops Board)",
        subtitle: "Backoffice, colas, SLAs",
        type: "internal",
        icon: <Layers className="w-4 h-4" />,
        io: {
          in: ["Eventos iPaaS", "Datos Odoo"],
          out: ["Tareas y estados", "Feeds de control"],
        },
        ficha: {
          proceso: "Backoffice y coordinaci√≥n operativa (Ops Board)",
          costo: "Depende de asientos/plan",
          justificacion: "Tablero t√°ctico para colas, SLAs y control operativo; se integra v√≠a iPaaS con Odoo y agentes para acelerar la operaci√≥n sin desarrollar herramientas internas."
        }
      },
      {
        id: "hase",
        lane: "data",
        row: 0,
        title: "HASE (Scoring operativo)",
        subtitle: "Score hiper-adaptativo",
        type: "data",
        icon: <Bot className="w-4 h-4" />,
        io: {
          in: ["KYC Metamap", "Consulta KIBAN", "Colateral social"],
          out: ["Decisi√≥n + explicabilidad", "Recomendaci√≥n de t√©rminos"],
        },
        ficha: {
          proceso: "Scoring hiper-adaptativo (IA propietaria)",
          costo: "N/A (propio)",
          justificacion: "Nuestro 'cerebro' para evaluar riesgo y proponer t√©rminos usando se√±ales de Metamap, KIBAN y telem√°tica; alimenta Odoo para ejecuci√≥n."
        }
      },
      {
        id: "pia",
        lane: "data",
        row: 1,
        title: "PIA (Intervenci√≥n proactiva)",
        subtitle: "Cobranza emp√°tica",
        type: "data",
        icon: <AlertTriangle className="w-4 h-4" />,
        io: {
          in: ["Eventos de pago Conekta", "Telem√°tica / h√°bitos"],
          out: ["Planes flexibles", "Mensajes Asistente"],
        },
        ficha: {
          proceso: "Cobranza emp√°tica (IA + CPaaS)",
          costo: "Variable CPaaS (Twilio/Meta) + Infra IA",
          justificacion: "Interviene proactivamente con planes flexibles y mensajes personalizados; se orquesta con Flowise y opera en WhatsApp (Twilio)."
        }
      },
      {
        id: "pma",
        lane: "data",
        row: 2,
        title: "PMA (Mto. predictivo)",
        subtitle: "Alertas y √≥rdenes",
        type: "data",
        icon: <ServerCog className="w-4 h-4" />,
        io: {
          in: ["DTCs / RPM / temperaturas", "DVIR, consumo GNV"],
          out: ["Orden de servicio Odoo", "Tips Asistente"],
        },
        ficha: {
          proceso: "Mantenimiento Predictivo Asistido",
          costo: "N/A (propio) + Telemetr√≠a",
          justificacion: "Detecta anomal√≠as y genera √≥rdenes de servicio en Odoo a partir de DTCs/telemetr√≠a (Samsara) y h√°bitos de consumo GNV."
        }
      },
      {
        id: "assistant",
        lane: "data",
        row: 3,
        title: "Asistente Postventa (Flowise)",
        subtitle: "WhatsApp + flujos",
        type: "data",
        icon: <MessageSquare className="w-4 h-4" />,
        io: {
          in: ["Alertas PIA/PMA", "Datos de contrato"],
          out: ["Conversaciones", "Confirmaciones"],
        },
        ficha: {
          proceso: "Comunicaciones (CPaaS) & Desarrollo Low-Code de IA",
          costo: "~$0.005 USD / mensaje (Twilio) + Tarifa de Meta | Costo de Infraestructura + APIs LLM (Flowise)",
          justificacion: "Es la columna vertebral de nuestros agentes PIA y Asistente Digital. Usamos el canal nativo del operador (WhatsApp) y Flowise como la plataforma visual donde nuestro equipo construye, prueba y despliega r√°pidamente nuestros agentes conversacionales."
        }
      },
      {
        id: "warehouse",
        lane: "data",
        row: 4,
        title: "Data Lake / Warehouse",
        subtitle: "Historificaci√≥n + BI",
        type: "data",
        icon: <Database className="w-4 h-4" />,
        io: {
          in: ["Batch/Streams telem√°tica", "ERP/finanzas"],
          out: ["Dashboards, XAI, stress tests"],
        },
        ficha: {
          proceso: "Historificaci√≥n y anal√≠tica (SSOT)",
          costo: "Depende de stack (almacenamiento/compute)",
          justificacion: "Fuente √∫nica de verdad para BI/XAI y pruebas de estr√©s; ingiere streams de telem√°tica y datos operativos para modelado y reporting."
        }
      },
      {
        id: "bi",
        lane: "data",
        row: 5,
        title: "BI (Looker/Power BI)",
        subtitle: "KPIs y reporting",
        type: "data",
        icon: <BarChart3 className="w-4 h-4" />,
        io: {
          in: ["Modelos sem√°nticos"],
          out: ["Tableros Operaci√≥n/Finanzas/Calidad"],
        },
        ficha: {
          proceso: "KPIs y reporting ejecutivo",
          costo: "Licenciamiento seg√∫n herramienta (Looker/Power BI)",
          justificacion: "Tableros accionables sobre modelos sem√°nticos del warehouse para operaci√≥n, finanzas y calidad."
        }
      },
    ];

    function computePositions(nodes) {
      const laneIndex = Object.fromEntries(LANES.map((l, i) => [l.id, i]));
      const positions = {};
      nodes.forEach((n) => {
        const x =
          PADDING_X +
          laneIndex[n.lane] * (LANE_WIDTH + LANE_GAP) +
          (LANE_WIDTH - CARD_W) / 2;
        const y = PADDING_Y + n.row * ROW_HEIGHT;
        positions[n.id] = { x, y };
      });
      return positions;
    }

    const FLOWS = {
      "Onboarding & Scoring": [
        ["portal", "metamap"],
        ["metamap", "ipaas"],
        ["ipaas", "kiban"],
        ["kiban", "hase"],
        ["hase", "odoo"],
        ["odoo", "mifiel"],
        ["mifiel", "ipaas"],
        ["ipaas", "odoo"],
      ],
      "Desembolso & Entrega": [
        ["odoo", "conekta"],
        ["conekta", "ipaas"],
        ["ipaas", "odoo"],
        ["odoo", "samsara"],
        ["odoo", "whatsapp"],
      ],
      "Operaci√≥n & PMA": [
        ["samsara", "ipaas"],
        ["ipaas", "pma"],
        ["pma", "odoo"],
        ["pma", "assistant"],
        ["gnv", "warehouse"],
        ["samsara", "warehouse"],
        ["warehouse", "bi"],
      ],
      "Cobranza & PIA": [
        ["conekta", "ipaas"],
        ["ipaas", "pia"],
        ["pia", "assistant"],
        ["assistant", "odoo"],
      ],
      "Garant√≠as & Postventa": [
        ["samsara", "pma"],
        ["pma", "odoo"],
        ["assistant", "odoo"],
      ],
      "Reporte Bur√≥ (mensual)": [
        ["odoo", "kiban"],
        ["kiban", "odoo"],
      ],
    };

    function Edge({ from, to, positions, active }) {
      const a = positions[from];
      const b = positions[to];
      if (!a || !b) return null;
      const x1 = a.x + CARD_W;
      const y1 = a.y + CARD_H / 2;
      const x2 = b.x;
      const y2 = b.y + CARD_H / 2;
      const dx = Math.max(80, (x2 - x1) * 0.5);
      const path = `M ${x1} ${y1} C ${x1 + dx} ${y1}, ${x2 - dx} ${y2}, ${x2} ${y2}`;
      return (
        <path
          d={path}
          className={
            active
              ? "stroke-teal-400/80 [filter:drop-shadow(0_0_6px_rgba(45,212,191,0.6))]"
              : "stroke-slate-400/30"
          }
          strokeWidth={active ? 3 : 2}
          fill="none"
        />
      );
    }

    function NodeCard({ node, pos, selected, onSelect }) {
      const color = COLORS[node.type];
      return (
        <div
          onClick={() => onSelect?.(node)}
          title={node.subtitle}
          className={`absolute rounded-2xl border backdrop-blur px-3.5 py-3 cursor-pointer transition-all duration-200 hover:scale-[1.02] hover:shadow-xl hover:border-teal-400/50 bg-gradient-to-br ${color} ${
            selected ? "ring-2 ring-teal-400/70" : "ring-0"
          }`}
          style={{ left: pos.x, top: pos.y, width: CARD_W, height: CARD_H }}
        >
          <div className="flex items-start gap-2">
            <div className="shrink-0 mt-0.5 text-slate-300">{node.icon}</div>
            <div className="min-w-0">
              <div className="text-slate-100 font-semibold leading-tight text-[13px] truncate">
                {node.title}
              </div>
              <div className="text-slate-300/80 text-[12px] truncate">{node.subtitle}</div>
            </div>
          </div>
          <div className="mt-2 grid grid-cols-2 gap-2 text-[11px] text-slate-300/90">
            <div>
              <div className="uppercase tracking-wide text-[10px] text-slate-400">IN</div>
              <div className="space-y-0.5">
                {node.io.in.slice(0, 2).map((t, i) => (
                  <div key={i} className="truncate">‚Ä¢ {t}</div>
                ))}
              </div>
            </div>
            <div>
              <div className="uppercase tracking-wide text-[10px] text-slate-400">OUT</div>
              <div className="space-y-0.5">
                {node.io.out.slice(0, 2).map((t, i) => (
                  <div key={i} className="truncate">‚Ä¢ {t}</div>
                ))}
              </div>
            </div>
          </div>
        </div>
      );
    }

    function ConductoresIntegrationsMap() {
      const [flow, setFlow] = useState("Onboarding & Scoring");
      const [visibleLanes, setVisibleLanes] = useState(
        Object.fromEntries(LANES.map((l) => [l.id, true]))
      );
      const [selected, setSelected] = useState(null);

      const [showTimeline, setShowTimeline] = useState(false);
      const [currentPhase, setCurrentPhase] = useState(null);
      const [currentWeek, setCurrentWeek] = useState(1);
      const [hoveredWeek, setHoveredWeek] = useState(null);

      const TIMELINE_PHASES = {
        "Mes 1: Ignici√≥n Inmediata": {
          semanas: [1, 2, 3, 4],
          color: "from-red-500/20 to-orange-500/10",
          borderColor: "border-red-400/40",
          nodos_activos: ["samsara", "metamap", "kiban", "conekta", "mifiel", "odoo"],
          detalles: [
            {
              semana: 1,
              titulo: "Kick-off Hardware y Alianzas",
              herramientas_ids: ["samsara", "metamap", "kiban", "conekta", "mifiel"],
              tareas: [
                "Orden de compra 17 dispositivos Samsara (VG55 + EI21)",
                "Instalaci√≥n inmediata en flota Higer 17",
                "Firma contratos con Metamap, KIBAN, Conekta, Mifiel",
                "Inicio integraciones API"
              ],
              herramientas: ["Samsara", "Metamap", "KIBAN", "Conekta", "Mifiel"],
              hito: "¬°Telemetr√≠a en tiempo real desde d√≠a 7!"
            },
                        {
               semana: 2,
               titulo: "Arranque T√©cnico y de Mercado",
               herramientas_ids: ["odoo"],
               tareas: [
                 "Despliegue Odoo Enterprise Plan Personalizado",
                 "Configuraci√≥n m√≥dulos CRM y Core Bancario simplificado",
                 "Ofertas formales a COO/PMO y Head of Growth"
               ],
               herramientas: ["Odoo Enterprise"],
               hito: "Plataforma interna lista para primer cliente"
             },
                        {
               semana: 3,
               titulo: "Ingesta de Datos y Entrenamiento IA",
               herramientas_ids: ["samsara", "gnv", "warehouse"],
               tareas: [
                 "HASE y Super-PMA en modo escucha",
                 "Ingesta datos Samsara de flota Higer",
                 "Construcci√≥n base de datos propietaria",
                 "Integraci√≥n APIs estaciones GNV"
               ],
               herramientas: ["AWS/Google Cloud", "Samsara API", "APIs GNV"],
               hito: "Primeros datos flota y consumo correlacionados"
             },
                        {
               semana: 4,
               titulo: "Ensamble del Stack Operativo",
               herramientas_ids: ["odoo", "metamap", "kiban", "conekta", "mifiel"],
               tareas: [
                 "Integraci√≥n end-to-end completa",
                 "Odoo ‚Üî Metamap ‚Üî KIBAN ‚Üî Conekta ‚Üî Mifiel",
                 "MVP del Asistente Digital avanza",
                 "17 operadores como cliente objetivo"
               ],
               herramientas: ["Odoo", "Metamap", "KIBAN", "Conekta", "Mifiel APIs"],
               hito: "Stack de originaci√≥n 100% funcional"
             }
          ]
        },
        "Mes 2: Validaci√≥n en Campo": {
          semanas: [5, 6, 7, 8],
          color: "from-yellow-500/20 to-green-500/10",
          borderColor: "border-yellow-400/40",
          nodos_activos: ["whatsapp", "assistant", "ipaas", "pia", "hase"],
          detalles: [
                        {
               semana: 5,
               titulo: "Lanzamiento MVP Higer 17",
               herramientas_ids: ["whatsapp", "assistant", "ipaas"],
               tareas: [
                 "Despliegue oficial Asistente Digital",
                 "17 operadores flota Higer como usuarios",
                 "Comunicaci√≥n v√≠a API Twilio"
               ],
               herramientas: ["Twilio", "Flowise", "Make/n8n"],
               hito: "MVP en producci√≥n"
             },
                        {
               semana: 6,
               titulo: "Medici√≥n KPIs Validaci√≥n",
               herramientas_ids: ["warehouse"],
               tareas: [
                 "Medici√≥n en entorno real y controlado",
                 ">70% automatizaci√≥n",
                 ">95% precisi√≥n OCR",
                 "Recolecci√≥n feedback operadores"
               ],
               herramientas: ["Analytics", "Looker Studio"],
               hito: "Validaci√≥n tecnol√≥gica en campo iniciada"
             },
                        {
               semana: 7,
               titulo: "Evangelizaci√≥n del Pipeline",
               herramientas_ids: ["odoo", "warehouse"],
               tareas: [
                 "Head of Growth visita 12 rutas pipeline",
                 "Demos funcionales Asistente IA",
                 "Dashboards Looker con datos reales Higer",
                 "Evidencia tangible, no promesas"
               ],
               herramientas: ["Odoo CRM", "Looker Studio"],
               hito: "Pipeline activado con evidencia real"
             },
                        {
               semana: 8,
               titulo: "Pre-calificaci√≥n Masiva",
               herramientas_ids: ["metamap", "odoo"],
               tareas: [
                 "Preparaci√≥n primeros 50 expedientes",
                 "Flujo Manual Underwriting 1.0",
                 "Recolecci√≥n documentaci√≥n",
                 "KYC inicial de prospectos"
               ],
               herramientas: ["Metamap", "Odoo CRM"],
               hito: "50 operadores pipeline pre-calificados"
             }
          ]
        },
        "Mes 3: Ignici√≥n y Despliegue": {
          semanas: [9, 10, 11, 12],
          color: "from-green-500/20 to-blue-500/10",
          borderColor: "border-green-400/40",
          nodos_activos: ["odoo", "mifiel", "conekta", "samsara", "pia", "pma", "warehouse"],
          detalles: [
            {
              semana: 9,
              titulo: "Primer Comit√© de Cr√©dito",
              herramientas_ids: ["metamap", "kiban", "odoo"],
              tareas: [
                "Presentaci√≥n 20-30 expedientes",
                "KYC Metamap completo",
                "Reporte Bur√≥ v√≠a KIBAN",
                "Scorecard Cualitativo (HASE v0.1)"
              ],
              herramientas: ["Metamap", "KIBAN", "Odoo"],
              hito: "Primeras aprobaciones de cr√©dito"
            },
                        {
               semana: 10,
               titulo: "Cierre y Firma Digital",
               herramientas_ids: ["mifiel", "conekta"],
               tareas: [
                 "Comit√© aprueba primer lote",
                 "Env√≠o contratos v√≠a Mifiel",
                 "Recepci√≥n enganches v√≠a Conekta",
                 "10-20 contratos firmados"
               ],
               herramientas: ["Mifiel", "Conekta"],
               hito: "20 contratos firmados digitalmente"
             },
                        {
               semana: 11,
               titulo: "Ejecuci√≥n √ìrdenes de Compra",
               herramientas_ids: ["samsara", "odoo"],
               tareas: [
                 "Orden de compra 10-20 vagonetas",
                 "Instalaci√≥n Samsara pre-entrega",
                 "Configuraci√≥n unidades",
                 "Preparaci√≥n log√≠stica entrega"
               ],
               herramientas: ["Samsara", "Odoo"],
               hito: "Vagonetas listas para entrega"
             },
                        {
               semana: 12,
               titulo: "Primeras Unidades en Calle",
               herramientas_ids: ["samsara", "pia", "whatsapp"],
               tareas: [
                 "Entrega vagonetas a operadores",
                 "Samsara transmitiendo en tiempo real",
                 "PIA v1.0 activado - recordatorios pago",
                 "Gesti√≥n comunicaci√≥n inicial"
               ],
               herramientas: ["Samsara", "PIA", "Twilio"],
               hito: "Flota operando y generando revenue + datos"
             }
          ]
        }
      };

      const IA_STATUS_90_DAYS = {
        HASE: {
          estado: "Cerebro Dual Activo",
          descripcion: "3 meses datos operativos flota Higer + nueva flota propia",
          progreso: 75
        },
        PIA: {
          estado: "v1.0 en Producci√≥n",
          descripcion: "Recordatorios automatizados v√≠a Twilio con referencias Conekta",
          progreso: 60
        },
        "Super-PMA": {
          estado: "Modo Escucha Avanzado",
          descripcion: "Base de datos rica, iniciando modelos predictivos",
          progreso: 40
        }
      };

      useEffect(() => {
        const container = document.querySelector('.diagram-scroll-container');
        if (container) {
          console.log('Container width:', container.clientWidth);
          console.log('Content width:', container.scrollWidth);
          console.log('Can scroll:', container.scrollWidth > container.clientWidth);
          if (container.scrollWidth <= container.clientWidth) {
            const innerCanvas = container.querySelector('.diagram-inner-canvas');
            if (innerCanvas) {
              innerCanvas.style.minWidth = '2400px';
              innerCanvas.style.width = '2400px';
            }
          }
        }
      }, []);

      const filteredNodes = useMemo(
        () => NODES.filter((n) => visibleLanes[n.lane]),
        [visibleLanes]
      );
      const positions = useMemo(() => computePositions(filteredNodes), [filteredNodes]);

      const activeEdges = FLOWS[flow] || [];

      const width = Math.max(2400, PADDING_X * 2 + LANES.length * (LANE_WIDTH + LANE_GAP));
      const maxRow = Math.max(...filteredNodes.map((n) => n.row));
      const height = PADDING_Y * 2 + (maxRow + 1) * ROW_HEIGHT;

      return (
        <div className="min-h-screen bg-slate-950 text-slate-100">
          <div className="sticky top-0 z-30 bg-slate-950/80 backdrop-blur border-b border-slate-800">
            <div className="max-w-[1400px] mx-auto px-6 py-4 flex items-center gap-3">
              <ServerCog className="w-5 h-5 text-teal-400" />
              <h1 className="text-lg md:text-xl font-extrabold tracking-tight">
                Arquitectura de Integraciones ‚Äî Conductores
              </h1>
              <div className="ml-auto flex items-center gap-2 overflow-x-auto">
                {Object.keys(FLOWS).map((f) => (
                  <button
                    key={f}
                    className={`px-3 py-1.5 rounded-lg border text-[12px] whitespace-nowrap transition ${
                      f === flow
                        ? "bg-teal-500/20 border-teal-400 text-teal-200"
                        : "bg-slate-900 border-slate-700 text-slate-300 hover:border-teal-500/40"
                    }`}
                    onClick={() => {
                      setFlow(f);
                      setShowTimeline(false);
                      setSelected(null);
                    }}
                  >
                    {f}
                  </button>
                ))}
                <div className="h-8 w-px bg-slate-700 mx-2" />
                <button
                  className={`px-6 py-2 rounded-xl border-2 flex items-center gap-2 text-sm font-bold transition-all transform hover:scale-105 ${
                    showTimeline
                      ? "bg-gradient-to-r from-purple-600 to-blue-600 border-purple-400 text-white shadow-xl shadow-purple-500/30 ring-2 ring-purple-400/50"
                      : "bg-gradient-to-r from-purple-900/50 to-blue-900/50 border-purple-500 text-purple-200 hover:shadow-lg hover:shadow-purple-500/20"
                  }`}
                  onClick={() => {
                    setShowTimeline(!showTimeline);
                    if (!showTimeline) {
                      setFlow(null);
                      setCurrentPhase("Mes 1: Ignici√≥n Inmediata");
                      setCurrentWeek(1);
                    }
                  }}
                >
                  <span className="text-xl">üöÄ</span>
                  <span>Blueprint 90 D√≠as</span>
                  {showTimeline && <span className="text-xs bg-white/20 px-2 py-0.5 rounded-full">ACTIVO</span>}
                </button>
              </div>
            </div>
          </div>

          {showTimeline && (
            <div className="fixed top-[120px] left-0 right-0 z-30 bg-gradient-to-b from-purple-900/40 to-transparent backdrop-blur-sm">
              <div className="max-w-[1400px] mx-auto px-6 py-3">
                <div className="flex items-center gap-4">
                  <div className="bg-purple-500/20 rounded-lg px-4 py-2 border border-purple-400/50">
                    <div className="text-lg font-bold text-purple-200">
                      {currentPhase}
                    </div>
                    <div className="text-sm text-purple-300">
                      Semana {currentWeek} de 12
                    </div>
                  </div>
                  
                  <div className="flex-1 flex gap-1">
                    {[...Array(12)].map((_, i) => {
                      const week = i + 1;
                      const phase = Object.entries(TIMELINE_PHASES).find(([_, data]) => 
                        data.semanas.includes(week)
                      );
                      return (
                        <button
                          key={week}
                          onClick={() => {
                            setCurrentWeek(week);
                            setCurrentPhase(phase[0]);
                          }}
                          className={`flex-1 h-8 rounded transition-all ${
                            week === currentWeek 
                              ? 'bg-purple-500 shadow-lg shadow-purple-500/50' 
                              : week <= currentWeek 
                                ? 'bg-purple-600/50' 
                                : 'bg-slate-700/50 hover:bg-slate-600/50'
                          }`}
                          title={`Semana ${week}`}
                        >
                          <span className="text-xs">{week}</span>
                        </button>
                      );
                    })}
                  </div>
                </div>
              </div>
            </div>
          )}

          <div className="max-w-[1400px] mx-auto px-6 py-6 grid grid-cols-12 gap-6">
            <aside className="col-span-12 lg:col-span-3 space-y-4">
              <div className="rounded-2xl border border-slate-800 bg-slate-900/40 p-4">
                <div className="flex items-center gap-2 mb-2">
                  <Layers className="w-4 h-4 text-slate-300" />
                  <div className="font-semibold">Capas visibles</div>
                </div>
                <div className="space-y-2">
                  {LANES.map((l) => (
                    <label
                      key={l.id}
                      className="flex items-center justify-between py-1 text-sm"
                    >
                      <span className="flex items-center gap-2 text-slate-300">
                        <span className="text-slate-400">{l.icon}</span>
                        {l.title}
                      </span>
                      <input
                        type="checkbox"
                        className="accent-teal-500"
                        checked={visibleLanes[l.id]}
                        onChange={(e) =>
                          setVisibleLanes((v) => ({ ...v, [l.id]: e.target.checked }))
                        }
                      />
                    </label>
                  ))}
                </div>
                <div className="mt-3 text-[12px] text-slate-400">
                  Consejo: Activa solo las capas que necesites para cada demo.
                </div>
              </div>

              <div className="rounded-2xl border border-slate-800 bg-slate-900/40 p-4">
                <div className="flex items-center gap-2 mb-2">
                  <BarChart3 className="w-4 h-4 text-slate-300" />
                  <div className="font-semibold">Leyenda de color</div>
                </div>
                <ul className="space-y-1 text-sm">
                  <li><span className="inline-block w-3 h-3 rounded bg-gradient-to-br from-teal-500/20 to-teal-400/10 mr-2 align-middle border border-teal-400/40"/>Fronts / Canales</li>
                  <li><span className="inline-block w-3 h-3 rounded bg-gradient-to-br from-amber-500/20 to-amber-400/10 mr-2 align-middle border border-amber-400/40"/>Orquestaci√≥n</li>
                  <li><span className="inline-block w-3 h-3 rounded bg-gradient-to-br from-sky-500/20 to-sky-400/10 mr-2 align-middle border border-sky-400/40"/>Servicios Externos</li>
                  <li><span className="inline-block w-3 h-3 rounded bg-gradient-to-br from-cyan-500/20 to-cyan-400/10 mr-2 align-middle border border-cyan-400/40"/>Telem√°tica</li>
                  <li><span className="inline-block w-3 h-3 rounded bg-gradient-to-br from-emerald-500/20 to-emerald-400/10 mr-2 align-middle border border-emerald-400/40"/>Plataforma Interna</li>
                  <li><span className="inline-block w-3 h-3 rounded bg-gradient-to-br from-fuchsia-500/20 to-fuchsia-400/10 mr-2 align-middle border border-fuchsia-400/40"/>Datos / IA / BI</li>
                </ul>
              </div>

              <div className="rounded-2xl border border-slate-800 bg-slate-900/40 p-4">
                <div className="flex items-center gap-2 mb-2">
                  <ShieldCheck className="w-4 h-4 text-slate-300" />
                  <div className="font-semibold">Puntos cr√≠ticos</div>
                </div>
                <ul className="list-disc pl-5 text-sm space-y-1 text-slate-300/90">
                  <li><b>KIBAN ‚Üí C√≠rculo de Cr√©dito</b> se usa <i>siempre</i> en Onboarding (consulta) y cada mes en <b>Reporte</b>.</li>
                  <li><b>Samsara</b> provee webhooks/stream para PMA/PIA y control de inmovilizador.</li>
                  <li><b>Odoo</b> es la fuente operativa: contratos, cartera, OS y facturaci√≥n.</li>
                  <li><b>Warehouse/BI</b> consolida hist√≥rico para XAI y stress testing.</li>
                </ul>
              </div>

              {showTimeline && (
                <div className="rounded-2xl border border-purple-800 bg-gradient-to-br from-purple-900/20 to-blue-900/20 p-4">
                  <div className="flex items-center gap-2 mb-3">
                    <span className="text-2xl">üöÄ</span>
                    <div>
                      <div className="font-bold text-purple-200">Blueprint Fast Track</div>
                      <div className="text-[10px] text-purple-300">De la Inversi√≥n a la Operaci√≥n</div>
                    </div>
                  </div>

                  <div className="space-y-2 mb-4">
                    {Object.entries(TIMELINE_PHASES).map(([fase, data]) => (
                      <button
                        key={fase}
                        onClick={() => {
                          setCurrentPhase(fase);
                          setCurrentWeek(data.semanas[0]);
                        }}
                        className={`w-full text-left p-3 rounded-lg transition-all ${
                          currentPhase === fase 
                            ? `bg-gradient-to-r ${data.color} ${data.borderColor} border shadow-lg` 
                            : 'bg-slate-900/50 border border-slate-700 hover:border-purple-500/50'
                        }`}
                      >
                        <div className="font-semibold text-sm">{fase}</div>
                        <div className="text-[10px] text-slate-400 mt-1">
                          Herramientas: {data.nodos_activos.length} activas
                        </div>
                      </button>
                    ))}
                  </div>

                  {currentPhase && (
                    <div className="space-y-3">
                      <div className="flex gap-1">
                        {TIMELINE_PHASES[currentPhase].semanas.map(semana => (
                          <button
                            key={semana}
                            onClick={() => setCurrentWeek(semana)}
                            className={`flex-1 py-1 px-2 rounded text-[10px] transition ${
                              currentWeek === semana
                                ? 'bg-purple-500/30 text-purple-200 border border-purple-400'
                                : 'bg-slate-800/50 text-slate-400 hover:bg-slate-700/50'
                            }`}
                          >
                            S{semana}
                          </button>
                        ))}
                      </div>

                      {TIMELINE_PHASES[currentPhase].detalles
                        .filter(d => d.semana === currentWeek)
                        .map(detalle => (
                          <div key={detalle.semana} className="bg-slate-900/50 rounded-lg p-3">
                            <div className="font-semibold text-sm text-purple-200 mb-2">
                              Semana {detalle.semana}: {detalle.titulo}
                            </div>
                            <div className="space-y-2">
                              <div>
                                <div className="text-[10px] uppercase tracking-wide text-slate-400 mb-1">
                                  Tareas Cr√≠ticas
                                </div>
                                <ul className="text-[11px] text-slate-300 space-y-0.5">
                                  {detalle.tareas.map((tarea, i) => (
                                    <li key={i} className="flex items-start gap-1">
                                      <span className="text-purple-400 mt-0.5">‚Ä¢</span>
                                      <span>{tarea}</span>
                                    </li>
                                  ))}
                                </ul>
                              </div>
                              <div>
                                <div className="text-[10px] uppercase tracking-wide text-slate-400 mb-1">
                                  Stack Involucrado
                                </div>
                                <div className="flex flex-wrap gap-1">
                                  {detalle.herramientas.map(h => (
                                    <span key={h} className="px-2 py-0.5 bg-purple-500/20 border border-purple-400/30 rounded text-[10px] text-purple-300">
                                      {h}
                                    </span>
                                  ))}
                                </div>
                              </div>
                              <div className="pt-2 border-t border-slate-700">
                                <div className="flex items-center gap-1">
                                  <span className="text-green-400">‚úì</span>
                                  <span className="text-[11px] font-semibold text-green-300">
                                    HITO: {detalle.hito}
                                  </span>
                                </div>
                              </div>
                            </div>
                          </div>
                        ))}
                    </div>
                  )}

                  <div className="mt-4 p-3 bg-gradient-to-br from-slate-900/70 to-purple-900/20 rounded-lg border border-purple-800/30">
                    <div className="text-xs font-bold text-purple-200 mb-2 flex items-center gap-1">
                      <span>ü§ñ</span> Estado IAs al D√≠a 90
                    </div>
                    {Object.entries(IA_STATUS_90_DAYS).map(([ia, status]) => (
                      <div key={ia} className="mb-2">
                        <div className="flex justify-between items-center mb-1">
                          <span className="text-[11px] font-semibold text-purple-300">{ia}</span>
                          <span className="text-[10px] text-slate-400">{status.progreso}%</span>
                        </div>
                        <div className="h-1.5 bg-slate-800 rounded-full overflow-hidden">
                          <div 
                            className="h-full bg-gradient-to-r from-purple-500 to-blue-500 transition-all duration-500"
                            style={{ width: `${status.progreso}%` }}
                          />
                        </div>
                        <div className="text-[10px] text-slate-400 mt-0.5">{status.descripcion}</div>
                      </div>
                    ))}
                  </div>

                  <div className="mt-3 p-2 bg-green-900/20 border border-green-800/30 rounded-lg">
                    <div className="text-[10px] font-bold text-green-300 mb-1">üéØ KPIs al D√≠a 90</div>
                    <div className="grid grid-cols-2 gap-1 text-[10px]">
                      <div className="text-green-200">‚Ä¢ 20-30 unidades</div>
                      <div className="text-green-200">‚Ä¢ 3 meses datos</div>
                      <div className="text-green-200">‚Ä¢ Pipeline 50+</div>
                      <div className="text-green-200">‚Ä¢ Stack 100%</div>
                    </div>
                  </div>
                </div>
              )}
            </aside>

            <main className="col-span-12 lg:col-span-9 space-y-4">
              <div className="sticky top-0 z-20 bg-slate-950/95 backdrop-blur-xl border-b border-slate-800">
                <div style={{width: '2400px', display: 'flex', paddingLeft: '24px'}}>
                  {LANES.map((lane, idx) => (
                    <div key={lane.id} 
                         style={{
                           width: '320px',
                           marginLeft: idx > 0 ? '28px' : '0',
                           padding: '12px 0',
                           textAlign: 'center'
                         }}
                         className="text-sm font-semibold text-slate-300 border-x border-slate-700/50">
                      {lane.icon}
                      <span className="ml-2">{lane.title}</span>
                    </div>
                  ))}
                </div>
              </div>
              <div
                className="diagram-scroll-container rounded-2xl border border-slate-800 bg-gradient-to-b from-slate-900 to-slate-950"
                style={{ width: '100%', height: 'calc(100vh - 250px)', overflowX: 'scroll', overflowY: 'auto', position: 'relative' }}
              >
                <div className="diagram-inner-canvas relative" style={{ minWidth: '2400px', position: 'relative' }}>


                  <svg width={width} height={height} className="block">
                    {LANES.map((lane, idx) => {
                      const xPosition = PADDING_X + idx * (LANE_WIDTH + LANE_GAP) + (LANE_WIDTH / 2);
                      return visibleLanes[lane.id] && (
                        <text
                          key={lane.id}
                          x={xPosition}
                          y={70}
                          textAnchor="middle"
                          className="fill-slate-300"
                          fontSize="13"
                          fontWeight="500"
                        >
                          {lane.title}
                        </text>
                      );
                    })}
                    {Object.values(FLOWS).flat().map(([a, b], i) => (
                      <Edge
                        key={i}
                        from={a}
                        to={b}
                        positions={positions}
                        active={!!flow && FLOWS[flow].some(([x, y]) => x === a && y === b)}
                      />
                    ))}
                  </svg>

                  {showTimeline && (
                    <>


                      {currentPhase && filteredNodes.map(node => {
                        const phaseData = TIMELINE_PHASES[currentPhase];
                        const weekData = phaseData.detalles.find(d => d.semana === currentWeek);
                        const isActive = weekData?.herramientas_ids?.includes(node.id);
                        
                        if (!isActive) return null;
                        
                        return (
                          <div
                            key={`highlight-${node.id}`}
                            className="absolute pointer-events-none"
                            style={{
                              left: positions[node.id].x - 6,
                              top: positions[node.id].y - 6,
                              width: CARD_W + 12,
                              height: CARD_H + 12,
                              borderRadius: '24px',
                              border: '3px solid rgba(168, 85, 247, 0.9)',
                              background: 'linear-gradient(135deg, rgba(168, 85, 247, 0.3) 0%, rgba(59, 130, 246, 0.2) 100%)',
                              boxShadow: '0 0 30px rgba(168, 85, 247, 0.6), inset 0 0 20px rgba(168, 85, 247, 0.3)',
                              animation: 'pulse 2s infinite'
                            }}
                          />
                        );
                      })}
                    </>
                  )}

                  {filteredNodes.map((n) => (
                    <NodeCard
                      key={n.id}
                      node={n}
                      pos={positions[n.id]}
                      selected={selected?.id === n.id}
                      onSelect={setSelected}
                    />)
                  )}
                </div>
              </div>

              <div className="grid md:grid-cols-1 gap-4">
                <div className="rounded-2xl border border-slate-800 bg-slate-900/40 p-4">
                  <div className="flex items-center gap-2 mb-1">
                    <ServerCog className="w-4 h-4 text-fuchsia-300" />
                    <div className="font-semibold">Inspector de nodo</div>
                  </div>
                  {selected ? (
                    <div>
                      <div className="text-teal-200 font-semibold">{selected.title}</div>
                      <div className="text-slate-300/80 text-sm mb-4">{selected.subtitle}</div>
                      
                      {selected.ficha && (
                        <div className="space-y-3 text-sm">
                          <div>
                            <div className="uppercase tracking-wide text-[10px] text-slate-400">Proceso Involucrado</div>
                            <div className="text-slate-200">{selected.ficha.proceso}</div>
                          </div>
                          <div>
                            <div className="uppercase tracking-wide text-[10px] text-slate-400">Costo Estimado (Proxy)</div>
                            <div className="text-slate-200">{selected.ficha.costo}</div>
                          </div>
                          <div>
                            <div className="uppercase tracking-wide text-[10px] text-slate-400">Justificaci√≥n</div>
                            <div className="text-slate-300/90">{selected.ficha.justificacion}</div>
                          </div>
                        </div>
                      )}

                      <div className="grid grid-cols-2 gap-4 mt-4 pt-4 border-t border-slate-800">
                        <div>
                          <div className="uppercase tracking-wide text-[10px] text-slate-400">Entradas</div>
                          <ul className="mt-1 text-sm list-disc pl-4 space-y-1">
                            {selected.io.in.map((t, i) => (
                              <li key={i}>{t}</li>
                            ))}
                          </ul>
                        </div>
                        <div>
                          <div className="uppercase tracking-wide text-[10px] text-slate-400">Salidas</div>
                          <ul className="mt-1 text-sm list-disc pl-4 space-y-1">
                            {selected.io.out.map((t, i) => (
                              <li key={i}>{t}</li>
                            ))}
                          </ul>
                        </div>
                      </div>

                    </div>
                  ) : (
                    <div className="text-slate-400 text-sm">
                      Selecciona un nodo en el mapa para ver detalles de entradas/salidas.
                    </div>
                  )}
                </div>
              </div>

              <div className="rounded-2xl border border-slate-800 bg-slate-900/40 p-4">
                <div className="flex items-center gap-2 mb-2">
                  <AlertTriangle className="w-4 h-4 text-amber-300" />
                  <div className="font-semibold">Notas de dise√±o y siguientes pasos</div>
                </div>
                <ul className="text-sm space-y-1 text-slate-300/90">
                  <li>‚Ä¢ <b>Contrato de datos</b> del flujo Onboarding: Portal ‚áÑ Metamap ‚áÑ KIBAN ‚áÑ HASE ‚áÑ Odoo. (Si quieres, te genero el JSON OpenAPI por endpoint.)</li>
                  <li>‚Ä¢ <b>Webhooks cr√≠ticos</b>: Mifiel (firma), Conekta (pagos), Samsara (eventos/DT C), Asistente (mensajer√≠a).</li>
                  <li>‚Ä¢ <b>Historificaci√≥n</b>: Telemetr√≠a y consumo GNV van a Warehouse para BI, XAI y pruebas de estr√©s.</li>
                  <li>‚Ä¢ <b>Seguridad</b>: OAuth/token por partner, aislamiento por rutas (tags) y colas idempotentes en iPaaS.</li>
                  <li>‚Ä¢ <b>Escala</b>: La misma arquitectura soporta 17 ‚Üí 1000 unidades con colas y backfill a Warehouse.</li>
                </ul>
              </div>
            </main>
          </div>

          {showTimeline && (
            <div className="fixed bottom-4 left-1/2 transform -translate-x-1/2 
                            bg-slate-900/95 border border-purple-400/50 rounded-full 
                            px-6 py-3 backdrop-blur-xl z-50 shadow-2xl shadow-purple-500/20">
              <div className="flex items-center gap-4">
                <div className="flex items-center gap-2">
                  <span className="text-2xl animate-pulse">üöÄ</span>
                  <span className="text-sm font-bold text-purple-200">Fast Track</span>
                </div>
                <div className="flex items-center gap-3">
                  <button 
                    onClick={() => setCurrentWeek(Math.max(1, currentWeek - 1))}
                    className="text-purple-300 hover:text-purple-100 transition"
                  >
                    ‚Üê
                  </button>
                  <div className="w-48 h-2 bg-slate-700 rounded-full overflow-hidden">
                    <div 
                      className="h-full bg-gradient-to-r from-purple-500 via-blue-500 to-green-500 transition-all duration-500"
                      style={{ width: `${(currentWeek / 12) * 100}%` }}
                    />
                  </div>
                  <button 
                    onClick={() => setCurrentWeek(Math.min(12, currentWeek + 1))}
                    className="text-purple-300 hover:text-purple-100 transition"
                  >
                    ‚Üí
                  </button>
                </div>
                <div className="text-sm">
                  <span className="text-purple-300">Semana</span>
                  <span className="font-bold text-purple-100 ml-1">{currentWeek}</span>
                  <span className="text-purple-400"> / 12</span>
                </div>
                <div className="text-xs text-slate-400 ml-2">
                  {currentWeek <= 4 && "Ignici√≥n"}
                  {currentWeek > 4 && currentWeek <= 8 && "Validaci√≥n"}
                  {currentWeek > 8 && "Despliegue"}
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.render(<ConductoresIntegrationsMap />, document.getElementById('root'));
  </script>
</body>
</html>
